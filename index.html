<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hemp Life Farmers | Federally Compliant Wholesale</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/favicon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Outfit:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
/* ========== CSS VARIABLES — Organic Earth-Tone Design ========== */
:root {
  /* Primary — deep forest & warm earth */
  --clr-primary: #2C4A1A;
  --clr-primary-hover: #3A5E24;
  --clr-secondary: #B8963A;
  --clr-secondary-hover: #CCAE5C;
  --clr-bg-light: #FAF8F3;
  --clr-surface: #FFFEF9;
  --clr-text-main: #2A1F12;
  --clr-text-muted: #6B5D4D;
  --clr-border: #E5DDD0;
  --shadow-sm: 0 4px 12px rgba(42,31,18,0.06);
  --shadow-md: 0 12px 32px rgba(42,31,18,0.08);
  --shadow-lg: 0 24px 48px rgba(42,31,18,0.12);
  --transition: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1);

  /* Earth-tone aliases */
  --green-dark: #2C4A1A;
  --green-mid: #3A5E24;
  --green-light: #5A8235;
  --green-pale: #EDF5E4;
  --gold: #B8963A;
  --gold-light: #CCAE5C;
  --gold-pale: #FBF6EA;
  --cream: #FAF8F3;
  --bg: #FAF8F3;
  --soil: #5C3D2E;
  --soil-light: #7A5841;
  --soil-pale: #F5EDE6;
  --bark: #3E2A1A;
  --barn-red: #8B3A2A;
  --barn-red-pale: #FDF0EC;
  --text: #2A1F12;
  --text-muted: #6B5D4D;
  --border: #E5DDD0;
  --border-dark: #C9BFA8;
  --surface: #FFFEF9;
}

/* ========== RESETS & BASE ========== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  font-family: 'DM Sans', sans-serif;
  font-weight: 400;
  background-color: var(--clr-bg-light);
  color: var(--clr-text-muted);
  line-height: 1.7;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}
h1, h2, h3, h4, h5, h6 {
  font-family: 'Outfit', sans-serif;
  color: var(--clr-text-main);
  line-height: 1.1;
  margin-bottom: 15px;
  font-weight: 800;
  letter-spacing: -0.02em;
}
h1 { font-size: clamp(48px, 6vw, 84px); color: white; }
h2 { font-size: clamp(32px, 4vw, 56px); }
h3 { font-size: 24px; }
a { color: var(--clr-primary); text-decoration: none; transition: var(--transition); }
a:hover { color: var(--clr-secondary); }
img { max-width: 100%; display: block; }
ul, ol { list-style: none; }

/* ========== LAYOUT ========== */
.container { width: 100%; max-width: 1300px; margin: 0 auto; padding: 0 24px; }
.section { padding: 120px 0; }
.section-sm { padding: 60px 0; }
.bg-light { background-color: var(--clr-surface); }
.sec-title { margin-bottom: 60px; }
.sec-title .subtitle {
  font-family: 'Outfit', sans-serif; color: var(--clr-secondary); font-size: 14px;
  font-weight: 800; text-transform: uppercase; letter-spacing: 0.15em; display: block; margin-bottom: 12px;
}

/* ========== PAGES (SPA) ========== */
.page { display: none; animation: fadeIn 0.4s ease forwards; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

/* ========== BUTTONS ========== */
.btn {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 18px 40px; font-family: 'Outfit', sans-serif; font-weight: 800;
  font-size: 15px; text-transform: uppercase; letter-spacing: 0.08em;
  border: none; border-radius: 4px; cursor: pointer; transition: var(--transition);
  text-decoration: none; position: relative; overflow: hidden; z-index: 1;
}
.btn-primary { background-color: var(--clr-primary); color: #fff; }
.btn-primary:hover { background-color: var(--clr-secondary); color: var(--clr-primary); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(31,59,14,.25); }
.btn-dark { background-color: var(--clr-primary); color: #fff; }
.btn-dark:hover { background-color: var(--clr-secondary); color: var(--clr-primary); }
.btn-gold { background-color: var(--clr-secondary); color: var(--clr-primary); }
.btn-gold:hover { background-color: var(--gold-light); color: var(--clr-primary); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(197,165,90,.3); }
.btn-secondary { background-color: rgba(255,255,255,0.1); color: white; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
.btn-secondary:hover { background-color: white; color: var(--clr-primary); transform: translateY(-2px); }
.btn-danger { background: var(--barn-red); color: #fff; }
.btn-danger:hover { background: #a04432; }
.btn-soil { background-color: var(--soil); color: #fff; }
.btn-soil:hover { background-color: var(--soil-light); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(92,61,46,.25); }
.btn-text { background: none; color: var(--soil); font-weight: 800; padding: 0; text-transform: uppercase; letter-spacing: 0.08em; border-bottom: 2px solid var(--clr-secondary); border-radius: 0; padding-bottom: 4px; }
.btn-text:hover { color: var(--clr-primary); border-bottom-color: var(--clr-primary); }
.btn-outline-light { background: rgba(255,255,255,.12); color: #fff; border: 1px solid rgba(255,255,255,.3); backdrop-filter: blur(6px); }
.btn-outline-light:hover { background: #fff; color: var(--clr-primary); }
.btn-sm { padding: 8px 18px; font-size: 12px; }
.btn-lg { padding: 18px 42px; font-size: 15px; }

/* ========== INFO BOXES ========== */
.gold-box { background: var(--gold-pale); border: 1px solid var(--gold-light); border-left: 4px solid var(--gold); border-radius: 10px; padding: 24px 28px; margin: 24px 0; }
.red-box { background: var(--barn-red-pale); border: 1px solid #e8c4bc; border-left: 4px solid var(--barn-red); border-radius: 10px; padding: 24px 28px; margin: 24px 0; }
.green-box { background: var(--green-pale); border: 1px solid #c8ddb8; border-left: 4px solid var(--green-mid); border-radius: 10px; padding: 24px 28px; margin: 24px 0; }

/* ========== BADGES & PILLS ========== */
.badge {
  display: inline-block; padding: 4px 12px; font-family: 'DM Sans', sans-serif;
  font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em;
  border-radius: 4px;
}
.badge-green { background: var(--green-pale); color: var(--green-dark); }
.badge-gold { background: var(--gold-pale); color: #8a7a3a; }
.badge-red { background: var(--barn-red-pale); color: var(--barn-red); }
.badge-blue { background: #e8f0fa; color: #2a5080; }
.pill {
  display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px;
  background: rgba(255,255,255,.15); border: 1px solid rgba(255,255,255,.25);
  border-radius: 100px; font-size: 13px; color: rgba(255,255,255,.9); backdrop-filter: blur(4px);
}
.tag {
  display: inline-block; padding: 4px 10px; background: var(--barn-red-pale);
  color: var(--barn-red); font-size: 12px; font-weight: 700; border-radius: 4px; margin: 3px;
}

/* ========== GRIDS ========== */
.grid { display: grid; gap: 24px; }
.grid-2 { grid-template-columns: 1fr; }
.grid-3 { grid-template-columns: 1fr; }
.grid-4 { grid-template-columns: 1fr 1fr; }
@media (min-width: 768px) {
  .grid-2 { grid-template-columns: repeat(2, 1fr); }
  .grid-3 { grid-template-columns: repeat(3, 1fr); }
  .grid-4 { grid-template-columns: repeat(4, 1fr); }
}

/* ========== CARDS ========== */
.card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 14px;
  padding: 28px; box-shadow: 0 2px 8px rgba(42,31,18,.05); transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(42,31,18,.08); }
.card-flat { box-shadow: none; }
.card-flat:hover { transform: none; }

/* ========== AGE GATE ========== */
#age-gate {
  position: fixed; inset: 0; background: rgba(11, 18, 6, 0.9);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;
}
.age-gate-modal {
  background: var(--clr-surface); border-radius: 16px; padding: 60px; max-width: 540px;
  width: 100%; text-align: center; box-shadow: 0 40px 80px rgba(0,0,0,0.4);
}
.age-gate-modal img { width: 140px; margin: 0 auto 30px; }
.age-gate-modal h2 { color: var(--clr-primary); font-size: 40px; margin-bottom: 12px; }
.age-gate-modal p { color: var(--clr-text-muted); font-size: 16px; font-weight: 500; margin-bottom: 40px; line-height: 1.6; }
.age-gate-btns { display: flex; gap: 20px; justify-content: center; }
.age-gate-fine { font-size: 11px; color: var(--clr-text-muted); margin-top: 20px; line-height: 1.5; }

/* ========== REFERRAL BANNER ========== */
#referral-banner {
  background-color: var(--clr-secondary); color: var(--clr-primary);
  font-size: 13px; font-family: 'Outfit', sans-serif; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.1em;
  padding: 12px 0; text-align: center;
}

/* ========== NAV ========== */
.header {
  background-color: rgba(255, 254, 249, 0.97);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  box-shadow: 0 2px 16px rgba(42,31,18,0.05);
  position: sticky; top: 0; z-index: 100;
  border-bottom: 1px solid var(--clr-border);
}
.nav-container { display: flex; align-items: center; justify-content: space-between; height: 120px; }
.brand { display: flex; align-items: center; gap: 16px; cursor: pointer; margin-right: 48px; }
.brand img { height: 100px; width: auto; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
.brand-text { display: flex; flex-direction: column; }
.brand-name { font-family: 'Outfit', sans-serif; color: var(--clr-primary); font-size: 26px; font-weight: 900; letter-spacing: -0.02em; }
.brand-sub { font-family: 'Outfit', sans-serif; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.15em; color: var(--clr-secondary); margin-top: 2px; }
.nav-links { display: none; gap: 35px; align-items: center; }
.nav-link {
  font-family: 'Outfit', sans-serif; font-size: 14px; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.05em; color: var(--clr-text-main); cursor: pointer;
  position: relative;
}
.nav-link:hover, .nav-link.active { color: var(--clr-secondary); }
.header-btn { display: none; }
@media (min-width: 992px) { .nav-links { display: flex; } .mobile-menu-btn { display: none !important; } }
@media (min-width: 1024px) { .header-btn { display: block; margin-left: 20px; } }
.mobile-menu-btn { background: none; border: none; font-size: 28px; cursor: pointer; color: var(--clr-primary); }
.mobile-menu {
  display: none; position: absolute; top: 100px; left: 0; right: 0; background: var(--clr-surface);
  border-top: 1px solid var(--clr-border); padding: 30px; box-shadow: var(--shadow-md);
  z-index: 999;
}
.mobile-menu.open { display: flex; flex-direction: column; gap: 20px; }
.mobile-menu .nav-link { font-size: 15px; padding: 8px 0; display: block; }

/* ========== HERO ========== */
.hero {
  position: relative;
  background:
    linear-gradient(rgba(30, 22, 12, 0.85), rgba(44, 74, 26, 0.75)),
    url('images/hero-bg.jpg') center/cover no-repeat;
  background-color: #2C4A1A;
  min-height: 85vh; display: flex; align-items: center; justify-content: center;
  padding: 140px 0 100px; text-align: center;
}
.hero-content { max-width: 760px; margin: 0 auto; }
.hero p {
  color: rgba(255, 255, 255, 0.8); font-size: 20px; font-weight: 500;
  margin-bottom: 40px; max-width: 620px; margin-left: auto; margin-right: auto; line-height: 1.7;
}
.hero-btns { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 50px; justify-content: center; }
.hero-trust-line {
  display: flex; align-items: center; gap: 20px; flex-wrap: wrap; justify-content: center;
  padding-top: 40px; border-top: 1px solid rgba(255,255,255,0.12);
}
.hero-trust-line span {
  font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 14px;
  text-transform: uppercase; letter-spacing: 0.1em; color: var(--clr-secondary);
}
.hero-divider {
  width: 4px; height: 4px; border-radius: 50%;
  background: rgba(255,255,255,0.3); flex-shrink: 0;
}

/* ========== TRUST BANNER BAR ========== */
.trust-banner {
  background: linear-gradient(135deg, var(--soil) 0%, var(--soil-light) 100%);
  color: rgba(255,255,255,0.9); padding: 28px 0;
  border-bottom: 3px solid var(--clr-secondary);
}
.trust-banner-grid { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 0; }
.trust-banner-item {
  font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 14px;
  text-transform: uppercase; letter-spacing: 0.1em; padding: 0 28px;
  display: flex; align-items: center; gap: 10px;
}
.trust-banner-item::before {
  content: ''; display: inline-block; width: 8px; height: 8px;
  background: var(--clr-secondary); border-radius: 50%;
}
.trust-banner-divider {
  width: 1px; height: 18px; background: rgba(255,255,255,0.15); flex-shrink: 0;
}

/* ========== FULL-WIDTH BANNER ========== */
.full-banner {
  background: linear-gradient(135deg, #1A3409 0%, var(--clr-primary) 50%, #2C4A1A 100%);
  color: #fff; padding: 80px 0; position: relative;
  border-top: 3px solid var(--clr-secondary);
  border-bottom: 3px solid var(--clr-secondary);
}
.full-banner::before {
  content: ''; position: absolute; inset: 0;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  pointer-events: none;
}
.full-banner h3 {
  font-family: 'Outfit', sans-serif; font-size: 32px; font-weight: 900;
  color: var(--clr-secondary); margin-bottom: 0; position: relative;
}

/* ========== ABOUT / COMPLIANCE SECTION ========== */
.about-wrap { display: flex; flex-wrap: wrap; align-items: center; gap: 60px; }
.about-image { flex: 1; min-width: 300px; border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-lg); position: relative; }
.about-content { flex: 1.2; min-width: 300px; }
.list-style-one { list-style: none; padding: 0; margin: 0; }
.list-style-one li {
  position: relative; padding-left: 24px; margin-bottom: 16px;
  font-weight: 700; font-size: 18px; color: var(--clr-text-main);
}
.list-style-one li::before {
  content: ''; position: absolute; left: 0; top: 10px;
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--clr-secondary);
}

/* ========== STEP CARDS (How It Works) ========== */
.steps-row { position: relative; }
.steps-row::before {
  content: ''; position: absolute; top: 56px; left: 15%; right: 15%;
  height: 2px; background: repeating-linear-gradient(90deg, var(--clr-border) 0, var(--clr-border) 8px, transparent 8px, transparent 16px);
  z-index: 0;
}
@media (max-width: 767px) { .steps-row::before { display: none; } }
.step-card { text-align: center; padding: 20px 16px; position: relative; z-index: 1; }
.step-icon {
  width: 96px; height: 96px; margin: 0 auto 20px;
  background: var(--soil-pale); border: 2px solid var(--clr-border);
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  color: var(--soil); transition: var(--transition);
}
.step-card:hover .step-icon { background: var(--green-pale); border-color: var(--clr-primary); color: var(--clr-primary); transform: scale(1.08); }
.step-icon svg { width: 44px; height: 44px; }
.step-num {
  display: inline-block; font-family: 'Outfit', sans-serif; font-weight: 800;
  font-size: 11px; color: var(--clr-surface); background: var(--clr-secondary);
  padding: 3px 14px; border-radius: 20px; letter-spacing: 0.15em;
  text-transform: uppercase; margin-bottom: 12px;
}
.step-card h4 {
  color: var(--clr-text-main); font-size: 18px; margin-bottom: 10px;
}
.step-card p {
  color: var(--clr-text-muted); font-size: 14px; line-height: 1.7; margin: 0;
  max-width: 240px; margin-left: auto; margin-right: auto;
}

/* ========== PRODUCT CARDS ========== */
.product-card {
  background: var(--clr-surface); border: 1px solid var(--clr-border);
  border-radius: 16px; overflow: hidden; transition: var(--transition);
  display: flex; flex-direction: column;
}
.product-card:hover { box-shadow: 0 16px 40px rgba(42,31,18,0.12); transform: translateY(-6px); border-color: var(--clr-secondary); }
.product-img {
  height: var(--product-img-height, 260px); display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, var(--soil-pale) 0%, var(--clr-border) 100%);
  position: relative; font-size: 48px; font-weight: 700; color: rgba(255,255,255,.6);
  transition: height 0.3s ease;
}
.product-desc-toggle { cursor: pointer; color: var(--green-mid); font-size: 13px; font-weight: 600; border: none; background: none; padding: 0; margin-top: 4px; }
.product-desc-toggle:hover { text-decoration: underline; }
.product-long-desc { display: none; font-size: 13px; color: var(--text-muted); line-height: 1.6; margin-top: 8px; padding-top: 8px; border-top: 1px dashed var(--border); }
.product-long-desc.show { display: block; }
.product-img.flower-bg { background: linear-gradient(160deg, #3A5E24 0%, #5A8235 40%, #2C4A1A 100%); }
.product-img.extract-bg { background: linear-gradient(160deg, var(--soil-light) 0%, var(--gold) 40%, var(--soil) 100%); }
.product-badge {
  position: absolute; top: 20px; left: 20px;
  background: var(--clr-primary); color: white;
  font-size: 11px; font-family: 'Outfit'; font-weight: 900;
  padding: 6px 16px; border-radius: 4px;
  letter-spacing: 0.1em; text-transform: uppercase;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
.product-body { padding: 24px; }
.product-body h3 { font-size: 18px; margin-bottom: 4px; color: var(--clr-text-main); }
.product-meta { font-size: 12px; color: var(--clr-text-muted); margin-bottom: 12px; }
.product-badges { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px; }
.product-desc { font-size: 14px; color: var(--clr-text-muted); margin-bottom: 16px; line-height: 1.6; }
.product-prices { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
.price-tag { padding: 5px 12px; background: var(--soil-pale); border-radius: 6px; font-size: 12px; font-weight: 700; color: var(--soil); border: 1px solid var(--clr-border); }
.product-safety { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }
.safety-badge { font-size: 11px; padding: 3px 8px; border-radius: 3px; font-weight: 600; }
.safety-pass { background: var(--green-pale); color: var(--green-dark); }
.safety-fail { background: var(--barn-red-pale); color: var(--barn-red); }
.product-compliance { font-size: 11px; color: var(--text-muted); padding-top: 12px; border-top: 1px solid var(--border); margin-top: 12px; font-style: italic; }
.product-actions { display: flex; gap: 8px; margin-top: 16px; }
.product-terpenes { font-size: 13px; color: var(--text-muted); margin-bottom: 12px; }
.product-details { font-size: 13px; color: var(--text-muted); margin-bottom: 12px; }

/* ========== TABLES ========== */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; font-size: 14px; }
thead { background: var(--green-pale); }
th { font-family: 'DM Sans', sans-serif; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; font-size: 11px; padding: 12px 16px; text-align: left; color: var(--green-dark); }
td { padding: 12px 16px; border-bottom: 1px solid var(--border); }
tr:hover { background: var(--cream); }
.thc-pass { color: var(--green-mid); font-weight: 700; }
.thc-fail { color: var(--barn-red); font-weight: 700; }

/* ========== FORMS ========== */
.form-group { margin-bottom: 25px; }
.form-group label { display: block; font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 6px; color: var(--clr-text-main); }
.form-group input, .form-group select, .form-group textarea {
  width: 100%; padding: 18px; border: 2px solid var(--clr-border); border-radius: 10px;
  font-family: inherit; font-size: 16px; font-weight: 500;
  background: var(--clr-surface); color: var(--clr-text-main); transition: var(--transition);
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--soil); box-shadow: 0 0 0 4px rgba(92,61,46,0.1); }
.form-group textarea { height: 160px; resize: vertical; }
.form-row { display: grid; grid-template-columns: 1fr; gap: 16px; }
@media (min-width: 768px) { .form-row { grid-template-columns: 1fr 1fr; } }
.checkbox-group { display: flex; align-items: flex-start; gap: 16px; margin-bottom: 20px; }
.checkbox-group input[type="checkbox"] { width: 20px; height: 20px; margin-top: 4px; flex-shrink: 0; accent-color: var(--clr-primary); cursor: pointer; }
.checkbox-group label { font-size: 15px; font-weight: 600; text-transform: none; letter-spacing: 0; cursor: pointer; color: var(--clr-text-main); line-height: 1.5; }
.form-section { margin-bottom: 36px; }
.form-section h3 { font-size: 18px; padding-bottom: 8px; border-bottom: 2px solid var(--border); margin-bottom: 20px; }

/* ========== MEMBERSHIP ========== */
.steps-grid { display: grid; grid-template-columns: 1fr; gap: 24px; margin: 40px 0; }
@media (min-width: 768px) { .steps-grid { grid-template-columns: repeat(3, 1fr); } }
.step-card { text-align: center; padding: 32px 24px; }
.step-num { display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; background: var(--green-dark); color: #fff; border-radius: 50%; font-size: 20px; font-weight: 700; margin-bottom: 16px; }
.pricing-card {
  max-width: 560px; margin: 48px auto; background: var(--surface); border: 2px solid var(--gold);
  border-radius: 14px; padding: 40px; text-align: center; box-shadow: 0 8px 32px rgba(197,165,90,.15);
}
.pricing-card h3 { font-size: 22px; }
.pricing-amount { font-size: 36px; font-weight: 700; color: var(--green-dark); margin: 12px 0; }
.pricing-card ul { text-align: left; margin: 20px 0; }
.pricing-card ul li { padding: 6px 0; font-size: 15px; }
.pricing-card ul li::before { content: '✓ '; color: var(--green-mid); font-weight: 700; }
.payment-grid { display: grid; grid-template-columns: 1fr; gap: 16px; margin: 32px 0; }
@media (min-width: 768px) { .payment-grid { grid-template-columns: repeat(2, 1fr); } }
@media (min-width: 1024px) { .payment-grid { grid-template-columns: repeat(3, 1fr); } }
.payment-card { padding: 20px; text-align: center; }
.payment-card .payment-icon { font-size: 28px; margin-bottom: 8px; }
.payment-card h4 { font-size: 15px; }
.payment-card p { font-size: 13px; color: var(--text-muted); }

/* ========== INVITATION GATE ========== */
.invite-gate {
  max-width: 480px; margin: 60px auto; background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 48px; text-align: center; box-shadow: 0 8px 32px rgba(42,42,34,.1);
}
.invite-gate .lock-icon { font-size: 48px; margin-bottom: 16px; }

/* ========== LOGIN ========== */
.login-card {
  max-width: 440px; margin: 60px auto; background: var(--surface); border: 1px solid var(--border);
  border-radius: 14px; padding: 48px; text-align: center; box-shadow: 0 8px 32px rgba(42,42,34,.1);
}
.login-card img { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 24px; }

/* ========== DASHBOARD ========== */
.dash-status {
  background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
  padding: 24px; margin-bottom: 28px; display: grid; grid-template-columns: 1fr; gap: 12px;
}
@media (min-width: 768px) { .dash-status { grid-template-columns: repeat(3, 1fr); } }
.dash-status-item { font-size: 14px; }
.dash-status-item strong { display: block; font-size: 12px; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-muted); margin-bottom: 2px; }
.status-active { color: var(--green-mid); font-weight: 700; }
.status-pending { color: var(--gold); font-weight: 700; }
.status-suspended { color: var(--barn-red); font-weight: 700; }
.dash-tabs { display: flex; gap: 0; border-bottom: 2px solid var(--border); margin-bottom: 28px; overflow-x: auto; }
.dash-tab-btn {
  padding: 12px 24px; font-family: 'Outfit', sans-serif; font-size: 13px; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.06em; background: none; border: none;
  border-bottom: 2px solid transparent; cursor: pointer; color: var(--clr-text-muted);
  white-space: nowrap; transition: var(--transition); margin-bottom: -2px;
}
.dash-tab-btn:hover { color: var(--clr-primary-hover); }
.dash-tab-btn.active { color: var(--clr-primary); border-bottom-color: var(--clr-primary); }
.dash-tab-content { display: none; }
.dash-tab-content.active { display: block; }

/* ========== ADMIN ========== */
.upload-zone {
  border: 2px dashed var(--border-dark); border-radius: 10px; padding: 40px;
  text-align: center; background: var(--cream); cursor: pointer; transition: border-color 0.2s;
}
.upload-zone:hover { border-color: var(--green-mid); }
.upload-zone input[type="file"] { display: none; }

/* ========== LEGAL PAGES ========== */
.legal-card { max-width: 760px; margin: 40px auto; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 40px; }
.legal-card h1 { margin-bottom: 4px; }
.legal-date { font-size: 13px; color: var(--text-muted); margin-bottom: 32px; }
.legal-section { margin-bottom: 28px; }
.legal-section h3 { font-size: 17px; margin-bottom: 8px; color: var(--green-dark); }
.legal-section p, .legal-section ul { font-size: 15px; line-height: 1.7; color: var(--text-muted); }
.legal-section ul { padding-left: 20px; list-style: disc; }
.legal-section ul li { margin-bottom: 4px; }

/* ========== CONTACT ========== */
.contact-grid { display: grid; grid-template-columns: 1fr; gap: 32px; }
@media (min-width: 768px) { .contact-grid { grid-template-columns: 1fr 1.2fr; } }
.contact-info-card { padding: 24px; margin-bottom: 16px; }
.contact-info-card h4 { font-size: 16px; margin-bottom: 6px; }
.contact-info-card p { font-size: 14px; color: var(--text-muted); }

/* ========== FOOTER ========== */
.footer {
  background-color: #2A1A0E; color: rgba(255,255,255,0.7);
  padding: 80px 0 0; border-top: 4px solid var(--clr-secondary);
  background-image: linear-gradient(180deg, #2A1A0E 0%, #1F1209 100%);
  position: relative;
}
.footer::before {
  content: ''; position: absolute; inset: 0;
  background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath fill-rule='evenodd' d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/svg%3E");
  pointer-events: none;
}
.footer-grid { display: grid; grid-template-columns: 1fr; gap: 32px; padding-bottom: 40px; }
@media (min-width: 768px) { .footer-grid { grid-template-columns: repeat(2, 1fr); } }
@media (min-width: 1024px) { .footer-grid { grid-template-columns: 1.5fr 1fr 1fr 1fr; } }
.footer h4 { color: var(--clr-secondary); font-family: 'Outfit'; font-size: 18px; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 0.1em; }
.footer-brand img { width: 120px; margin-bottom: 25px; filter: brightness(0) invert(1); }
.footer-brand p { font-size: 15px; line-height: 1.7; font-weight: 500; }
.footer a { color: rgba(255,255,255,0.65); font-weight: 600; font-size: 15px; transition: all .2s; }
.footer a:hover { color: var(--clr-secondary); padding-left: 5px; }
.footer ul li { margin-bottom: 14px; }
.footer-bottom {
  background-color: #170D05; padding: 25px 0; margin-top: 60px;
  text-align: center; font-size: 13px; font-weight: 500;
  border-top: 1px solid rgba(255,255,255,0.08); position: relative;
}

/* ========== UTILITIES ========== */
.text-center { text-align: center; }
.text-muted { color: var(--text-muted); }
.mb-0 { margin-bottom: 0; }
.mb-1 { margin-bottom: 8px; }
.mb-2 { margin-bottom: 16px; }
.mb-3 { margin-bottom: 24px; }
.mb-4 { margin-bottom: 32px; }
.mt-2 { margin-top: 16px; }
.mt-3 { margin-top: 24px; }
.mt-4 { margin-top: 32px; }
.hidden { display: none; }
.flex-center { display: flex; align-items: center; justify-content: center; }
.gap-2 { gap: 16px; }
.gap-3 { gap: 24px; }
.w-full { width: 100%; }
.page-header { padding: 48px 0 32px; text-align: center; }
.page-header p { color: rgba(255,255,255,0.8); max-width: 600px; margin: 0 auto; font-size: 16px; }
.compliance-alert { background: var(--barn-red); color: #fff; padding: 8px 16px; font-weight: 700; font-size: 13px; border-radius: 6px 6px 0 0; }
.referral-link-box { background: var(--cream); border: 1px solid var(--border); border-radius: 8px; padding: 16px; display: flex; align-items: center; gap: 12px; margin: 12px 0; }
.referral-link-box code { flex: 1; font-size: 13px; word-break: break-all; }

/* ========== ADMIN TABS ========== */
.admin-tab-content { display: none; }
.admin-product-card {
  background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
  padding: 20px; margin-bottom: 16px; display: grid; grid-template-columns: 1fr;
  gap: 16px; align-items: start;
}
@media (min-width: 768px) {
  .admin-product-card { grid-template-columns: 100px 1fr auto; }
}
.admin-product-thumb {
  width: 100px; height: 80px; border-radius: 6px; display: flex; align-items: center;
  justify-content: center; font-size: 24px; color: rgba(255,255,255,.7);
}
.admin-product-info h4 { margin-bottom: 4px; }
.admin-product-info p { font-size: 13px; color: var(--text-muted); margin-bottom: 2px; }
.admin-product-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-start; }
.admin-status-select {
  padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px;
  font-size: 12px; font-weight: 600;
}
.order-product-row {
  display: grid; grid-template-columns: 1fr 100px 100px auto; gap: 12px;
  align-items: end; margin-bottom: 12px;
}
@media (max-width: 640px) {
  .order-product-row { grid-template-columns: 1fr; }
}

/* ========== PAGE HEADERS ========== */
.page-header {
  background: linear-gradient(135deg, rgba(30, 22, 12, 0.88), rgba(44, 74, 26, 0.85)),
    url('images/hero-bg.jpg') center/cover;
  padding: 120px 0; text-align: center; margin-bottom: 80px;
  border-bottom: 4px solid var(--clr-secondary);
}
.page-header h1 { margin-bottom: 0; font-size: clamp(40px, 5vw, 60px); }

/* Secure checkout style for order form */
.secure-header {
  display: flex; align-items: center; gap: 8px; font-size: 12px;
  color: var(--green-dark); font-weight: 700; margin-bottom: 12px;
  padding: 8px 14px; background: var(--green-pale); border-radius: 6px;
  text-transform: uppercase; letter-spacing: .04em;
}

/* SSL/Security notice */
.security-notice {
  display: flex; align-items: center; gap: 6px; font-size: 11px;
  color: var(--text-muted); padding: 8px 0;
}

/* Verified banner for compliance pages */
.verified-banner {
  background: linear-gradient(90deg, var(--clr-primary), var(--clr-primary-hover));
  color: #fff; border-radius: 10px; padding: 20px 28px; display: flex;
  align-items: center; gap: 16px; margin-bottom: 28px;
}
.verified-banner p { font-size: 14px; line-height: 1.5; }

/* Geo-block overlay */
#geo-block-overlay {
  display: none; position: fixed; inset: 0; background: rgba(20,20,16,.95);
  z-index: 10001; align-items: center; justify-content: center; padding: 24px;
}
.geo-block-modal {
  background: var(--surface); border-radius: 14px; padding: 48px;
  max-width: 520px; width: 100%; text-align: center;
  box-shadow: 0 24px 80px rgba(0,0,0,.5);
}
.geo-block-modal .geo-icon { font-size: 48px; color: var(--barn-red); margin-bottom: 16px; display: block; }

/* Info boxes for original design */
.info-box { padding: 30px; border-radius: 8px; margin-bottom: 30px; font-size: 16px; font-weight: 500; }
.info-box-primary { background-color: rgba(45, 80, 22, 0.05); border-left: 4px solid var(--clr-primary); }
.info-box-warning { background-color: rgba(139, 58, 42, 0.05); border-left: 4px solid #8B3A2A; color: #8B3A2A; }

/* Legal content for original design */
.legal-content h3 { color: var(--clr-primary); margin-top: 40px; font-size: 28px; }
.legal-content p { margin-bottom: 20px; font-size: 16px; font-weight: 500; }

/* Table responsive for original design */
.table-responsive { overflow-x: auto; margin-bottom: 40px; background: var(--clr-surface); border-radius: 12px; box-shadow: var(--shadow-md); border: 1px solid var(--clr-border); }
    </style>
</head>
<body>

<!-- ==================== AGE GATE ==================== -->
<div id="age-gate">
  <div class="age-gate-modal">
    <img src="images/logo.png?v=2" alt="Hemp Life Farmers">
    <h2>Welcome to Hemp Life Farmers</h2>
    <p>You must be 21 or older to enter this website. By proceeding, you confirm your age and that hemp products are legal in your jurisdiction.</p>
    <div class="age-gate-btns">
      <button class="btn btn-dark" style="padding:18px 40px;" onclick="verifyAge()">I Am 21+ &mdash; Enter</button>
      <button class="btn" style="border:2px solid var(--clr-border);color:var(--clr-text-main);padding:18px 40px;" onclick="window.location.href='https://google.com'">Under 21</button>
    </div>
    <p class="age-gate-fine">All products sold on this website comply with the Agriculture Improvement Act of 2018 (Farm Bill) and contain no more than 0.3% &Delta;9-THC on a dry-weight basis.</p>
  </div>
</div>

<!-- ==================== REFERRAL BANNER ==================== -->
<div id="referral-banner" style="display:none">
  <div class="container">Invited by: <span id="ref-name"></span> &mdash; Code: <span id="ref-code"></span></div>
</div>

<!-- ==================== NAVIGATION ==================== -->
<header class="header">
  <div class="container nav-container">
    <div class="brand" onclick="navigate('home')">
      <img src="images/logo.png?v=2" alt="Hemp Life Farmers Supply">
    </div>
    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">&#9776;</button>
    <nav class="nav-links" id="desktop-nav">
      <a href="#" class="nav-link active" data-page="home" onclick="navigate('home'); return false;">Home</a>
      <a href="#" class="nav-link" data-page="products" onclick="navigate('products'); return false;">Products</a>
      <a href="#" class="nav-link" data-page="compliance" onclick="navigate('compliance'); return false;">Compliance</a>
      <a href="#" class="nav-link" data-page="shipping" onclick="navigate('shipping'); return false;">Shipping</a>
      <a href="#" class="nav-link" data-page="membership" onclick="navigate('membership'); return false;">Membership</a>
      <a href="#" class="nav-link" id="nav-login-link" data-page="login" onclick="navigate('login'); return false;">Login</a>
      <div class="header-btn">
        <button class="btn btn-dark" onclick="navigate('invite')">Enter Invite Code</button>
      </div>
    </nav>
    <nav class="mobile-menu" id="mobile-menu">
      <a href="#" class="nav-link" onclick="navigate('home');closeMobileMenu(); return false;">Home</a>
      <a href="#" class="nav-link" onclick="navigate('products');closeMobileMenu(); return false;">Products</a>
      <a href="#" class="nav-link" onclick="navigate('compliance');closeMobileMenu(); return false;">Compliance</a>
      <a href="#" class="nav-link" onclick="navigate('shipping');closeMobileMenu(); return false;">Shipping</a>
      <a href="#" class="nav-link" onclick="navigate('membership');closeMobileMenu(); return false;">Membership</a>
      <a href="#" class="nav-link" id="mobile-login-link" onclick="navigate('login');closeMobileMenu(); return false;">Login</a>
      <a href="#" class="nav-link" onclick="navigate('invite');closeMobileMenu(); return false;">Enter Invite Code</a>
    </nav>
  </div>
</header>

<!-- Geo-Block Overlay -->
<div id="geo-block-overlay">
  <div class="geo-block-modal">
    <span class="geo-icon">&#128683;</span>
    <h2 style="color:var(--barn-red);">Service Unavailable in Your Area</h2>
    <p class="text-muted mt-2 mb-3">Hemp Life Farmers does not service your location. We are unable to accept orders or memberships from your area due to regional regulations.</p>
    <div class="red-box" style="text-align:left;">
      <strong>Why am I seeing this?</strong>
      <p style="font-size:13px;margin-top:6px;">Your detected location falls within a restricted service area. This may be due to state or local hemp regulations.</p>
    </div>
    <p class="text-muted mt-3" style="font-size:12px;">If you believe this is an error, please contact us at <strong>support@hemplifefarmers.com</strong></p>
  </div>
</div>

<!-- ==================== PAGE: HOME ==================== -->
<div id="page-home" class="page active">

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <h1>Grown From <br><span style="color: var(--clr-secondary);">the Earth.</span></h1>
        <p>Sun-grown, hand-cured, lab-verified hemp — cultivated in Maryland soil and delivered with complete chain-of-custody to licensed wholesale partners.</p>
        <div class="hero-btns">
          <button class="btn btn-gold" onclick="navigate('products')">Explore the Harvest</button>
          <button class="btn btn-secondary" onclick="navigate('invite')">Enter Your Invite Code Here</button>
        </div>
        <div class="hero-trust-line">
          <span>Farm Bill Compliant</span>
          <span class="hero-divider"></span>
          <span>&Delta;9-THC &le; 0.3%</span>
          <span class="hero-divider"></span>
          <span>Seed-to-Sale Documented</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Trust Banner Bar -->
  <div class="trust-banner">
    <div class="container">
      <div class="trust-banner-grid">
        <span class="trust-banner-item">Harvest-Fresh Quantities</span>
        <span class="trust-banner-divider"></span>
        <span class="trust-banner-item">Rooted Partnerships</span>
        <span class="trust-banner-divider"></span>
        <span class="trust-banner-item">Farm-to-Door Delivery</span>
      </div>
    </div>
  </div>

  <!-- About / Compliance Section -->
  <section class="section bg-light">
    <div class="container">
      <div class="about-wrap">
        <div class="about-image">
          <img src="images/home-image.jpg" alt="Commercial Agriculture" style="width:100%;height:480px;object-fit:cover;background:linear-gradient(135deg,#2D5016,#4A7C28);">
        </div>
        <div class="about-content">
          <div class="sec-title" style="margin-bottom: 30px;">
            <span class="subtitle">From Our Soil to Your Shelves</span>
            <h2>Cultivated with Care.<br>Documented with Integrity.</h2>
          </div>
          <p style="margin-bottom: 40px; font-size: 18px; line-height: 1.8;">Every harvest begins in Maryland soil — fed by sun, cured by hand, and verified by independent labs. We grow hemp the way nature intended and document every step from seed to shipment.</p>
          <ul class="list-style-one">
            <li>100% 2018 Farm Bill Compliant</li>
            <li>Wholesale Quantities (1lb &ndash; 50lb+)</li>
            <li>Full Seed-to-Sale Chain of Custody</li>
          </ul>
          <button class="btn btn-soil" style="margin-top: 40px;" onclick="navigate('apply')">Begin Your Journey</button>
        </div>
      </div>
    </div>
  </section>

  <!-- How It Works -->
  <section class="section-sm" style="background:var(--clr-surface);">
    <div class="container">
      <div class="text-center mb-4">
        <div class="sec-title" style="margin-bottom:40px;">
          <span class="subtitle">From Seed to Sale</span>
          <h2>How It Works</h2>
        </div>
      </div>
      <div class="grid grid-4 steps-row">
        <div class="step-card">
          <div class="step-icon">
            <!-- Hemp leaf icon (line art) -->
            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M32 58V30"/>
              <path d="M32 30c-4-8-16-14-24-14 0 10 8 20 24 22"/>
              <path d="M32 30c4-8 16-14 24-14 0 10-8 20-24 22"/>
              <path d="M32 22c-3-6-12-12-20-12 1 8 8 16 20 18"/>
              <path d="M32 22c3-6 12-12 20-12-1 8-8 16-20 18"/>
              <path d="M32 14c-2-5-8-10-14-10 1 6 6 12 14 14"/>
              <path d="M32 14c2-5 8-10 14-10-1 6-6 12-14 14"/>
            </svg>
          </div>
          <h4>Plant the Seed</h4>
          <p>Get an invitation from a trusted member. Every partnership starts with a personal connection — roots before branches.</p>
        </div>
        <div class="step-card">
          <div class="step-icon">
            <!-- Clipboard/document icon (line art) -->
            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="14" y="8" width="36" height="48" rx="3"/>
              <path d="M24 4h16v8H24z"/>
              <rect x="24" y="4" width="16" height="8" rx="2"/>
              <line x1="22" y1="24" x2="42" y2="24"/>
              <line x1="22" y1="32" x2="42" y2="32"/>
              <line x1="22" y1="40" x2="34" y2="40"/>
              <path d="M28 48l4 4 8-10"/>
            </svg>
          </div>
          <h4>Put Down Roots</h4>
          <p>Submit your application and $100 non-refundable fee. We review your credentials and verify compliance within 24&ndash;48 hours.</p>
        </div>
        <div class="step-card">
          <div class="step-icon">
            <!-- CBD dropper icon (line art) -->
            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M26 8h12v10l4 6v24a6 6 0 01-6 6h-8a6 6 0 01-6-6V24l4-6V8z"/>
              <line x1="26" y1="14" x2="38" y2="14"/>
              <path d="M22 30h20"/>
              <ellipse cx="32" cy="42" rx="4" ry="5"/>
              <path d="M32 37v-4"/>
            </svg>
          </div>
          <h4>Choose Your Crop</h4>
          <p>Browse the harvest catalog. Hand-pick your strains, set your quantities, and submit your order for fulfillment.</p>
        </div>
        <div class="step-card">
          <div class="step-icon">
            <!-- Delivery truck icon (line art) -->
            <svg viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <rect x="4" y="16" width="36" height="28" rx="2"/>
              <path d="M40 28h12l8 10v6H40V28z"/>
              <circle cx="16" cy="48" r="5"/>
              <circle cx="50" cy="48" r="5"/>
              <line x1="21" y1="48" x2="45" y2="48"/>
              <path d="M12 24h16M12 32h10"/>
            </svg>
          </div>
          <h4>Harvest Delivered</h4>
          <p>Your order ships with full COA documentation and chain of custody. Tracked, insured, straight from Maryland soil to your door.</p>
        </div>
      </div>
      <div class="text-center mt-3">
        <button class="btn btn-text" onclick="navigate('apply')">Start Your Application &rarr;</button>
      </div>
    </div>
  </section>


  <!-- Membership Banner (Full-Width Separator) -->
  <section class="full-banner">
    <div class="container" style="text-align:center;position:relative;">
      <h3>Rooted in Trust, Grown by Invitation</h3>
      <p style="max-width:700px;margin:16px auto 30px;color:rgba(255,255,255,.8);font-size:17px;line-height:1.7;">Hemp Life Farmers is a private growers circle — invitation-only. A trusted member must vouch for you before you can join. $100 non-refundable application fee + $50/month keeps the roots strong. No refunds.</p>
      <button class="btn btn-gold" onclick="navigate('membership')">Join the Circle</button>
    </div>
  </section>

  <!-- Compliance Block -->
  <section class="section-sm" style="background:var(--clr-surface);">
    <div class="container" style="text-align:center;max-width:800px;">
      <div class="sec-title" style="margin-bottom:20px;">
        <span class="subtitle">Purity From the Ground Up</span>
        <h2>Grown Clean, Tested Pure</h2>
      </div>
      <p style="font-size:17px;color:var(--clr-text-muted);line-height:1.8;margin-bottom:30px;">Every plant we grow honors the land it comes from. All products contain no more than 0.3% &Delta;9-THC on a dry-weight basis — fully compliant under the 2018 Farm Bill. Each harvest is tested by independent, ISO 17025 accredited labs with complete chain-of-custody documentation.</p>
      <button class="btn btn-text" onclick="navigate('compliance')">View Lab Reports &rarr;</button>
    </div>
  </section>

</div>

<!-- ==================== PAGE: PRODUCTS ==================== -->
<div id="page-products" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Wholesale Catalog</h1>
      <p>All products loaded from verified product data. COAs available for every batch.</p>
    </div>
  </div>
  <div class="container">

    <!-- Membership Wall — shown to non-members -->
    <div id="products-wall" style="display:none;">
      <div class="invite-gate">
        <img src="images/logo.png?v=2" alt="Hemp Life Farmers" style="width:100px;border-radius:50%;margin:0 auto 24px;display:block;">
        <h2 style="color:var(--clr-text-main);">Members Only Catalog</h2>
        <p class="text-muted mt-2 mb-3">Enter your invitation code to access wholesale products and pricing. No code, no access.</p>
        <div class="form-group">
          <input type="text" id="products-invite-input" placeholder="Enter Invitation Code" style="text-align:center;text-transform:uppercase;font-size:18px;letter-spacing:0.1em;">
        </div>
        <button class="btn btn-soil w-full" onclick="validateProductsInvite()">Verify &amp; View Catalog &rarr;</button>
        <p id="products-invite-error" style="color:var(--barn-red);font-size:13px;margin-top:12px;display:none;">Invalid invitation code. Please try again.</p>
        <div style="margin-top:24px;padding-top:20px;border-top:1px solid var(--border);">
          <p class="text-muted" style="font-size:13px;">Already a member? <a href="#" onclick="navigate('login');return false;">Log in here</a></p>
          <p class="text-muted" style="font-size:13px;">Don't have a code? You must be invited by an existing member.</p>
        </div>
      </div>
    </div>

    <!-- Catalog — shown only to logged-in members -->
    <div id="products-catalog-section" style="display:none;">
      <div class="gold-box mb-4">
        <strong>Members Only:</strong> You are viewing the wholesale catalog. All orders require admin approval before processing.
      </div>
      <div id="product-catalog" class="grid grid-2">
        <p class="text-muted text-center">Loading products...</p>
      </div>
    </div>

  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: COMPLIANCE ==================== -->
<div id="page-compliance" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Compliance &amp; Certificates of Analysis</h1>
      <p>Transparency and compliance documentation for all products.</p>
    </div>
  </div>
  <div class="container" style="max-width:960px;">

    <!-- Lab Testing Intro -->
    <section style="margin-bottom:60px;">
      <div class="sec-title" style="margin-bottom:24px;">
        <span class="subtitle">Third-Party Verified</span>
        <h2>Independent Lab Testing</h2>
      </div>
      <p style="font-size:17px;line-height:1.8;color:var(--clr-text-muted);margin-bottom:24px;">Every product we sell is tested by independent, <strong style="color:var(--clr-text-main);">ISO 17025 accredited laboratories</strong>. We never test in-house — your trust demands outside eyes.</p>
      <div class="grid grid-3" style="gap:16px;">
        <div style="padding:20px;background:var(--green-pale);border-radius:12px;border-left:4px solid var(--green-mid);">
          <h4 style="font-size:15px;margin-bottom:6px;">Potency Profiling</h4>
          <p style="font-size:13px;color:var(--clr-text-muted);margin:0;line-height:1.6;">Cannabinoid breakdown including &Delta;9-THC, THCA, CBD, CBG, and total cannabinoids.</p>
        </div>
        <div style="padding:20px;background:var(--gold-pale);border-radius:12px;border-left:4px solid var(--gold);">
          <h4 style="font-size:15px;margin-bottom:6px;">Terpene Analysis</h4>
          <p style="font-size:13px;color:var(--clr-text-muted);margin:0;line-height:1.6;">Full terpene profiling to verify strain identity, aroma, and therapeutic properties.</p>
        </div>
        <div style="padding:20px;background:var(--soil-pale);border-radius:12px;border-left:4px solid var(--soil);">
          <h4 style="font-size:15px;margin-bottom:6px;">Safety Screening</h4>
          <p style="font-size:13px;color:var(--clr-text-muted);margin:0;line-height:1.6;">Heavy metals, pesticides, microbials, mycotoxins, residual solvents, and foreign matter.</p>
        </div>
      </div>
    </section>

    <!-- COA Table -->
    <section style="margin-bottom:60px;">
      <div class="sec-title" style="margin-bottom:24px;">
        <span class="subtitle">Batch Documentation</span>
        <h2>Certificates of Analysis</h2>
      </div>
      <p style="font-size:15px;color:var(--clr-text-muted);margin-bottom:24px;line-height:1.7;">Every batch ships with a downloadable COA. Click any row to view or download the full lab report.</p>
      <div class="table-wrap" id="coa-table-container">
        <p class="text-muted">Loading COA data...</p>
      </div>
    </section>

    <!-- Chain of Custody -->
    <section style="margin-bottom:60px;">
      <div class="sec-title" style="margin-bottom:24px;">
        <span class="subtitle">Seed to Sale</span>
        <h2>Chain of Custody</h2>
      </div>
      <p style="font-size:15px;color:var(--clr-text-muted);margin-bottom:24px;line-height:1.7;">We document every hand that touches your product — from the field where it grew to the facility where it ships. Full transparency, no gaps.</p>
      <div id="coc-info" class="grid grid-2">
        <p class="text-muted">Loading chain of custody data...</p>
      </div>
    </section>

  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: SHIPPING ==================== -->
<div id="page-shipping" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Shipping &amp; Restricted States</h1>
      <p>Important shipping policies and state-level restrictions.</p>
    </div>
  </div>
  <div class="container">
    <div class="card card-flat mb-4">
      <h3>Shipping Policy</h3>
      <p class="mt-2 text-muted">All orders are shipped to the verified business address on file. The shipping address must match the address provided during the membership application. All shipments include tracking and require signature confirmation. Hemp Life Farmers ships via licensed carriers in compliance with federal and state regulations.</p>
    </div>

    <div class="red-box mb-4">
      <h3 style="color:var(--barn-red);">Restricted States Warning</h3>
      <p class="mt-2">We do not ship to restricted states. Orders placed from or shipping to restricted states will be canceled. It is the buyer's responsibility to verify that hemp products are legal in their jurisdiction before ordering.</p>
    </div>

    <div class="mb-4">
      <h3 class="mb-2">Restricted States</h3>
      <div id="restricted-states-tags">
        <span class="tag">Idaho</span>
        <span class="tag">Oregon (review pending)</span>
        <span class="tag">South Dakota (varies by county)</span>
      </div>
      <p class="text-muted mt-2" style="font-size:13px;">Also auto-populated per product from verified product data.</p>
    </div>

    <div class="gold-box mb-4">
      <p><strong>Note:</strong> Restricted states are subject to change as laws evolve. Buyer is responsible for verifying legality in their jurisdiction before placing orders.</p>
    </div>

    <div class="card card-flat mb-4">
      <h3>Order Processing</h3>
      <ul style="list-style:disc;padding-left:20px;margin-top:12px;" class="text-muted">
        <li>All orders are invoice-based and require manual approval</li>
        <li>IP address and state are logged for every order</li>
        <li>COA documentation is tied to each order</li>
        <li>Shipments are tracked and require signature</li>
      </ul>
    </div>

    <div class="card card-flat">
      <h3>Checkout Requirements</h3>
      <ul style="list-style:disc;padding-left:20px;margin-top:12px;" class="text-muted">
        <li>Active membership required</li>
        <li>Verified business address on file</li>
        <li>State not in restricted list</li>
        <li>Payment received and verified before shipment</li>
        <li>Signed buyer agreement on file</li>
      </ul>
    </div>
  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: MEMBERSHIP ==================== -->
<div id="page-membership" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Invitation-Only Wholesale Buyers Club</h1>
      <p>Exclusive access to federally compliant wholesale hemp products.</p>
    </div>
  </div>
  <div class="container">

    <!-- Invite Code Gate for Membership -->
    <div id="membership-invite-gate" class="invite-gate">
      <img src="images/logo.png?v=2" alt="Hemp Life Farmers" style="width:100px;border-radius:50%;margin:0 auto 24px;display:block;">
      <h2 style="color:var(--clr-text-main);">Enter Your Invitation Code</h2>
      <p class="text-muted mt-2 mb-3">Membership details are only visible to invited partners. Enter your code below to view pricing and apply.</p>
      <div class="form-group">
        <input type="text" id="membership-invite-input" placeholder="Enter Invitation Code" style="text-align:center;text-transform:uppercase;font-size:18px;letter-spacing:0.1em;">
      </div>
      <button class="btn btn-soil w-full" onclick="validateMembershipInvite()">Verify &amp; Continue &rarr;</button>
      <p id="membership-invite-error" style="color:var(--barn-red);font-size:13px;margin-top:12px;display:none;">Invalid invitation code. Please try again.</p>
      <p class="text-muted mt-3" style="font-size:13px;">Don't have a code? You must be invited by an existing member. <a href="#" onclick="navigate('contact');return false;">Contact us</a></p>
    </div>

    <!-- Membership Content (hidden until code verified) -->
    <div id="membership-content" style="display:none;">

    <!-- 3 Steps -->
    <div class="steps-grid">
      <div class="card text-center">
        <div class="step-num">1</div>
        <h3>Get Invited</h3>
        <p class="text-muted mt-2">You must receive a valid invitation code from an existing member to apply for membership.</p>
      </div>
      <div class="card text-center">
        <div class="step-num">2</div>
        <h3>Apply + Pay</h3>
        <p class="text-muted mt-2">Submit your membership application with your invitation code and pay the $100 non-refundable application fee.</p>
      </div>
      <div class="card text-center">
        <div class="step-num">3</div>
        <h3>Access</h3>
        <p class="text-muted mt-2">Once approved, your $50/month membership begins. Place wholesale orders and invite others.</p>
      </div>
    </div>

    <!-- Pricing Card -->
    <div class="pricing-card">
      <div class="badge badge-gold mb-2">HEMP LIFE FARMERS</div>
      <h3>Wholesale Buyers Club</h3>
      <p class="text-muted mt-2" style="font-weight:700;text-transform:uppercase;letter-spacing:0.06em;font-size:13px;">Invitation Code Required</p>
      <p class="text-muted" style="font-size:14px;">Must be referred by an existing member</p>

      <div style="margin:24px 0;padding:20px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);">
        <p style="font-size:14px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.06em;font-weight:700;">One-Time Application Fee</p>
        <div class="pricing-amount">$100</div>
        <p class="text-muted" style="font-size:14px;">Non-refundable. Covers verification and onboarding.</p>
        <div style="margin-top:20px;">
          <p style="font-size:14px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.06em;font-weight:700;">Monthly Membership</p>
          <div class="pricing-amount">$50<span style="font-size:16px;font-weight:400;">/month</span></div>
          <p class="text-muted" style="font-size:14px;">Billed monthly after approval.</p>
        </div>
      </div>

      <ul>
        <li>Wholesale pricing access</li>
        <li>Invoice-based ordering (1&ndash;10+ lbs)</li>
        <li>COA &amp; chain-of-custody documentation</li>
        <li>Priority fulfillment</li>
        <li>Direct communication channel</li>
        <li>New product early access</li>
        <li>Personal referral codes to invite others</li>
      </ul>
      <button class="btn btn-soil btn-lg w-full mt-3" onclick="navigate('apply')">Apply Now &mdash; Invitation Code Required &rarr;</button>
    </div>

    <!-- No Refunds -->
    <div class="red-box" style="max-width:700px;margin:32px auto;">
      <h3 style="color:var(--barn-red);">&#9888; All Fees Are Non-Refundable</h3>
      <p class="mt-2">The $100 application fee and all $50 monthly membership payments are non-refundable under any circumstances. By applying, you acknowledge and accept this policy. There are no exceptions.</p>
    </div>

    <!-- Payment Methods -->
    <div style="max-width:560px;margin:40px auto 0;">
      <h3 style="margin-bottom:20px;">Accepted Payment Methods</h3>
      <ul style="list-style:none;padding:0;margin:0;">
        <li style="display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border);"><strong>ACH Bank Transfer</strong><span class="text-muted" style="font-size:14px;">Preferred method</span></li>
        <li style="display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border);"><strong>Wire Transfer</strong><span class="text-muted" style="font-size:14px;">Domestic wire</span></li>
        <li style="display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border);"><strong>CashApp</strong><span class="text-muted" style="font-size:14px;">$HempLifeFarmers</span></li>
        <li style="display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border);"><strong>Zelle</strong><span class="text-muted" style="font-size:14px;">payments@hemplifefarmers.com</span></li>
        <li style="display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border);"><strong>Money Order / Cashier's Check</strong><span class="text-muted" style="font-size:14px;">Mail to business address</span></li>
      </ul>
      <p class="text-muted mt-3" style="font-size:13px;font-weight:700;">NO PayPal &middot; NO Venmo &middot; NO credit cards &middot; NO crypto</p>
    </div>

    </div><!-- close membership-content -->
  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: APPLY ==================== -->
<div id="page-apply" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Membership Application</h1>
      <p>Invitation code required to proceed.</p>
    </div>
  </div>
  <div class="container">

    <!-- Invitation Gate -->
    <div id="invitation-gate" class="invite-gate">
      <div class="lock-icon">&#128274;</div>
      <h2>Invitation Required</h2>
      <p class="text-muted mt-2 mb-3">Hemp Life Farmers is invitation-only. Enter your invitation code to proceed with your application.</p>
      <div class="form-group">
        <input type="text" id="invite-code-input" placeholder="HLF-INV-XXXX" style="text-align:center;text-transform:uppercase;font-size:18px;letter-spacing:0.1em;">
      </div>
      <button class="btn btn-primary w-full" onclick="validateInviteCode()">Verify Code &amp; Continue &rarr;</button>
      <p class="text-muted mt-3" style="font-size:13px;">Don't have a code? You must be invited by an existing member. <a href="#" onclick="navigate('contact');return false;">Contact us</a> for more info.</p>
    </div>

    <!-- Application Form (hidden until code verified) -->
    <div id="application-form" style="display:none;max-width:720px;margin:0 auto;">

      <!-- Section A: Applicant Info -->
      <div class="form-section">
        <h3>A. Applicant Information</h3>
        <div class="form-row">
          <div class="form-group"><label>Full Legal Name *</label><input type="text" id="app-name" required></div>
          <div class="form-group"><label>Business Name / DBA *</label><input type="text" id="app-business" required></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Business Type *</label>
            <select id="app-biz-type">
              <option value="">Select...</option>
              <option>Licensed Retailer</option>
              <option>Distributor</option>
              <option>Manufacturer</option>
              <option>Registered Hemp Business</option>
              <option>Other</option>
            </select>
          </div>
          <div class="form-group"><label>Business License # (optional)</label><input type="text" id="app-license"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>EIN / Tax ID (optional)</label><input type="text" id="app-ein"></div>
          <div class="form-group"><label>Email Address *</label><input type="email" id="app-email" required></div>
        </div>
        <div class="form-group"><label>Phone Number *</label><input type="tel" id="app-phone" required></div>
      </div>

      <!-- Section B: Location -->
      <div class="form-section">
        <h3>B. Location</h3>
        <div class="form-group"><label>Street Address *</label><input type="text" id="app-street" required></div>
        <div class="form-row">
          <div class="form-group"><label>City *</label><input type="text" id="app-city" required></div>
          <div class="form-group">
            <label>State *</label>
            <select id="app-state" onchange="checkStateRestriction()">
              <option value="">Select State...</option>
              <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
            </select>
            <span id="state-warning" style="display:none;color:#fff;background:var(--barn-red);font-size:13px;font-weight:700;padding:8px 12px;border-radius:6px;margin-top:6px;">
              &#10007; APPLICATION BLOCKED — We cannot accept applications from this state. Hemp product restrictions prevent us from doing business in your state.
            </span>
          </div>
        </div>
        <div class="form-group"><label>ZIP Code *</label><input type="text" id="app-zip" required></div>
        <div class="red-box mt-2">
          <strong>States We Cannot Deliver To:</strong>
          <p style="margin-top:6px;font-size:13px;">We are unable to ship or accept applications from the following states due to state-level hemp restrictions:</p>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;" id="apply-restricted-states-tags">
            <span style="background:var(--barn-red);color:#fff;padding:4px 14px;border-radius:14px;font-size:13px;font-weight:600;">Idaho (ID)</span>
            <span style="background:var(--barn-red);color:#fff;padding:4px 14px;border-radius:14px;font-size:13px;font-weight:600;">Oregon (OR)</span>
            <span style="background:var(--barn-red);color:#fff;padding:4px 14px;border-radius:14px;font-size:13px;font-weight:600;">South Dakota (SD)</span>
          </div>
          <p style="margin-top:8px;font-size:12px;color:var(--text-muted);">If your state is listed above, your application will be automatically rejected. This list is updated based on current state legislation.</p>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="app-billing-same" checked onchange="toggleShippingFields()">
          <label for="app-billing-same">Billing address is the same as shipping address</label>
        </div>
        <div id="shipping-fields" style="display:none;" class="mt-2">
          <h4 class="mb-2">Shipping Address</h4>
          <div class="form-group"><label>Street Address</label><input type="text" id="app-ship-street"></div>
          <div class="form-row">
            <div class="form-group"><label>City</label><input type="text" id="app-ship-city"></div>
            <div class="form-group"><label>State</label><input type="text" id="app-ship-state"></div>
          </div>
          <div class="form-group"><label>ZIP Code</label><input type="text" id="app-ship-zip"></div>
        </div>
      </div>

      <!-- Section C: Invitation & Referral -->
      <div class="form-section">
        <h3>C. Invitation &amp; Referral</h3>
        <div class="form-row">
          <div class="form-group"><label>Invitation Code *</label><input type="text" id="app-invite-code" readonly style="background:var(--green-pale);font-weight:700;"></div>
          <div class="form-group"><label>Invited By (Full Name) *</label><input type="text" id="app-invited-by" required></div>
        </div>
        <div class="form-group">
          <label>How did you hear about us?</label>
          <select id="app-how-heard">
            <option value="">Select...</option>
            <option>Existing Member Referral</option>
            <option>Industry Event</option>
            <option>Business Contact</option>
            <option>Online Search</option>
            <option>Other</option>
          </select>
        </div>
      </div>

      <!-- Section D: Product Interest -->
      <div class="form-section">
        <h3>D. Product Interest</h3>
        <div id="product-interest-checks" class="mb-3">
          <p class="text-muted">Loading products...</p>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Estimated Monthly Volume</label>
            <select id="app-volume">
              <option value="">Select...</option>
              <option>1-5 lbs</option>
              <option>5-10 lbs</option>
              <option>10-25 lbs</option>
              <option>25+ lbs</option>
            </select>
          </div>
          <div class="form-group">
            <label>Preferred Payment Method</label>
            <select id="app-payment">
              <option value="">Select...</option>
              <option>ACH Bank Transfer</option>
              <option>Wire Transfer</option>
              <option>CashApp</option>
              <option>Zelle</option>
              <option>Money Order</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Section E: Agreements -->
      <div class="form-section">
        <h3>E. Agreements</h3>
        <p class="text-muted mb-3" style="font-size:14px;">All checkboxes must be checked to submit your application.</p>
        <div class="checkbox-group"><input type="checkbox" id="agree-age" required><label for="agree-age">I confirm I am at least 21 years of age.</label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-terms" required><label for="agree-terms">I have reviewed and agree to the <a href="#" onclick="navigate('terms');return false;">Terms of Service</a>.</label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-disclaimer" required><label for="agree-disclaimer">I have reviewed and agree to the <a href="#" onclick="navigate('disclaimer');return false;">Legal Disclaimer</a>.</label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-privacy" required><label for="agree-privacy">I have reviewed the <a href="#" onclick="navigate('privacy');return false;">Privacy Policy</a>.</label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-compliance" required><label for="agree-compliance">I understand all products are federally compliant hemp and I am responsible for verifying legality in my jurisdiction.</label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-app-fee" required><label for="agree-app-fee"><strong>I understand the $100 application fee is NON-REFUNDABLE.</strong></label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-monthly-fee" required><label for="agree-monthly-fee"><strong>I understand the $50/month membership fee is NON-REFUNDABLE.</strong></label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-no-refunds" required><label for="agree-no-refunds"><strong>I understand there are NO REFUNDS of any kind on fees, memberships, or product orders.</strong></label></div>
        <div class="checkbox-group"><input type="checkbox" id="agree-no-minors" required><label for="agree-no-minors">I agree not to resell to minors, prohibited parties, or in restricted jurisdictions.</label></div>
      </div>

      <button class="btn btn-primary btn-lg w-full" onclick="submitApplication()">Submit Application &rarr;</button>
    </div>

    <!-- Payment Instructions (shown after submit) -->
    <div id="payment-instructions" style="display:none;max-width:720px;margin:0 auto;">
      <div class="green-box text-center mb-4">
        <h3>Application Recorded</h3>
        <p class="mt-2">Your reference number: <strong id="app-ref">HLF-APP-0000</strong></p>
        <p class="text-muted">Please save this reference number. Include it with your payment.</p>
      </div>

      <h3 class="mb-3">Send Your $100 Application Fee</h3>
      <p class="text-muted mb-3">Choose one of the following payment methods. Include your reference number as the memo/note.</p>

      <div class="grid grid-2 mb-4">
        <div class="card">
          <h4>&#127974; ACH / Wire Transfer</h4>
          <p class="text-muted mt-2" style="font-size:14px;">Bank details will be provided via email.<br>Memo: <strong id="pay-ref-ach">HLF-APP-0000</strong></p>
        </div>
        <div class="card">
          <h4>&#128241; CashApp</h4>
          <p class="text-muted mt-2" style="font-size:14px;">Send to: <strong>$HempLifeFarmers</strong><br>Note: <strong id="pay-ref-cash">HLF-APP-0000</strong></p>
        </div>
        <div class="card">
          <h4>&#128241; Zelle</h4>
          <p class="text-muted mt-2" style="font-size:14px;">Send to: <strong>payments@hemplifefarmers.com</strong><br>Memo: <strong id="pay-ref-zelle">HLF-APP-0000</strong></p>
        </div>
        <div class="card">
          <h4>&#9993; Money Order</h4>
          <p class="text-muted mt-2" style="font-size:14px;">Payable to: <strong>Hemp Life Farmers</strong><br>Memo: <strong id="pay-ref-mo">HLF-APP-0000</strong></p>
        </div>
      </div>

      <div class="card card-flat mb-4">
        <h4>What Happens Next</h4>
        <ol style="list-style:decimal;padding-left:20px;margin-top:12px;" class="text-muted">
          <li>Send payment using one of the methods above (include reference number)</li>
          <li>Payment verified within 1&ndash;2 business days</li>
          <li>Application reviewed within 2&ndash;3 business days</li>
          <li>Approval email sent with login credentials</li>
          <li>First $50 monthly billing begins upon approval</li>
        </ol>
      </div>

      <div class="text-center">
        <button class="btn btn-text" onclick="navigate('home')">Return to Home &rarr;</button>
        <button class="btn btn-secondary" onclick="navigate('products')" style="margin-left:12px;">View Products</button>
      </div>
    </div>

  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: LOGIN ==================== -->
<div id="page-login" class="page">
  <div class="container" style="padding-top:40px;">
    <div class="login-card">
      <img src="images/logo.png?v=2" alt="Hemp Life Farmers">
      <h2>Member Login</h2>
      <p class="text-muted mb-3">Access your wholesale account.</p>
      <div class="form-group"><label>Email Address</label><input type="email" id="login-email" placeholder="you@business.com"></div>
      <div class="form-group"><label>Password</label><input type="password" id="login-password" placeholder="Enter password"></div>
      <div class="checkbox-group mb-3"><input type="checkbox" id="login-remember"><label for="login-remember">Remember me</label></div>
      <button class="btn btn-primary w-full" onclick="memberLogin()">Log In &rarr;</button>
      <p class="text-muted mt-3" style="font-size:13px;"><a href="#">Forgot password?</a></p>
      <p class="text-muted mt-2" style="font-size:13px;">Don't have an account? <a href="#" onclick="navigate('apply');return false;">Apply for membership</a></p>
      <div style="border-top:1px solid var(--border);margin-top:20px;padding-top:16px;">
        <p class="text-muted" style="font-size:11px;">Demo Logins:</p>
        <p class="text-muted" style="font-size:11px;">Member: demo@hemplifefarmers.com / demo2025</p>
        <p class="text-muted" style="font-size:11px;">Admin: admin@hemplifefarmers.com / admin2025</p>
      </div>
    </div>
  </div>
</div>

<!-- ==================== PAGE: DASHBOARD ==================== -->
<div id="page-dashboard" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Welcome back, <span id="member-name-display">Member</span></h1>
      <p>Manage your wholesale account, orders, and referrals. <button class="btn btn-sm btn-secondary" onclick="memberLogout()" style="margin-left:12px;">Log Out</button></p>
    </div>
  </div>
  <div class="container">

    <!-- Status Card -->
    <div class="dash-status">
      <div class="dash-status-item"><strong>Status</strong><span id="dash-status" class="status-active">Active</span></div>
      <div class="dash-status-item"><strong>Member Since</strong><span id="dash-since">January 15, 2025</span></div>
      <div class="dash-status-item"><strong>Invitation Code Used</strong><span id="dash-invite-code">HLF-INV-DEMO</span></div>
      <div class="dash-status-item"><strong>Personal Referral Code</strong><span id="dash-ref-code">HLF-INV-DEMO</span></div>
      <div class="dash-status-item"><strong>Next Billing</strong><span id="dash-next-bill">March 1, 2025 &mdash; $50.00</span></div>
      <div class="dash-status-item"><strong>Payment Method</strong><span id="dash-pay-method">ACH Bank Transfer</span></div>
    </div>

    <!-- Tab Navigation -->
    <div class="dash-tabs">
      <button class="dash-tab-btn active" onclick="switchDashTab('orders', this)">Orders</button>
      <button class="dash-tab-btn" onclick="switchDashTab('billing', this)">Billing &amp; Payments</button>
      <button class="dash-tab-btn" onclick="switchDashTab('account', this)">Account Settings</button>
      <button class="dash-tab-btn" onclick="switchDashTab('invite', this)">Invite Members</button>
    </div>

    <!-- Tab: Orders -->
    <div id="tab-orders" class="dash-tab-content active">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;" class="mb-3">
        <h3 style="margin:0;">My Orders</h3>
        <button class="btn btn-sm btn-primary" onclick="showPlaceOrderForm()">+ Place New Order</button>
      </div>

      <!-- Order History Table -->
      <div class="table-wrap" id="client-orders-table">
        <table>
          <thead><tr><th>Order #</th><th>Date</th><th>Products</th><th>Qty</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody id="orders-tbody">
            <tr><td>HLF-0001</td><td>Feb 15, 2025</td><td>Premium THCA Flower (Indoor)</td><td>5 lb</td><td>$8,250.00</td><td><span class="badge badge-green">Shipped</span></td><td><a href="#">&#128229; COA</a></td></tr>
            <tr><td>HLF-0002</td><td>Mar 1, 2025</td><td>CBD Hemp Flower (Outdoor)</td><td>10 lb</td><td>$5,000.00</td><td><span class="badge badge-gold">Processing</span></td><td><a href="#">&#128229; COA</a></td></tr>
            <tr><td>HLF-0003</td><td>Mar 10, 2025</td><td>THCA Flower (Greenhouse)</td><td>3 lb</td><td>$3,600.00</td><td><span class="badge badge-blue">Pending Review</span></td><td><button class="btn btn-sm btn-danger" onclick="cancelClientOrder('HLF-0003', this)">Cancel</button></td></tr>
          </tbody>
        </table>
      </div>

      <!-- Place Order Form (hidden by default) -->
      <div id="place-order-form" style="display:none;" class="mt-3">
        <div class="card" style="border:2px solid var(--gold);">
          <div class="secure-header"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Secure Order Form &mdash; Encrypted &amp; Protected</div>
          <div style="display:flex;justify-content:space-between;align-items:center;" class="mb-3">
            <h3 style="margin:0;">Place New Order</h3>
            <button class="btn btn-sm btn-secondary" onclick="hidePlaceOrderForm()">&times; Cancel</button>
          </div>
          <p class="text-muted mb-3">Select products and quantities. All orders are invoice-based and require admin approval. Payment instructions will be provided after order submission.</p>

          <div id="order-product-rows"></div>
          <button class="btn btn-sm btn-secondary mt-2 mb-3" onclick="addOrderProductRow()">+ Add Another Product</button>

          <div class="form-row">
            <div class="form-group">
              <label>Preferred Payment Method</label>
              <select id="order-payment-method">
                <option>ACH Bank Transfer</option>
                <option>Wire Transfer</option>
                <option>CashApp</option>
                <option>Zelle</option>
                <option>Money Order</option>
              </select>
            </div>
            <div class="form-group">
              <label>Shipping State</label>
              <input type="text" id="order-ship-state" readonly style="background:var(--green-pale);">
            </div>
          </div>
          <div class="form-group"><label>Order Notes (optional)</label><textarea id="order-notes" style="min-height:60px;" placeholder="Special instructions, preferred ship date, etc."></textarea></div>

          <div class="gold-box mb-3">
            <strong>Order Summary</strong>
            <div id="order-summary-lines" class="mt-2"></div>
            <div style="border-top:1px solid var(--gold-light);margin-top:8px;padding-top:8px;font-weight:700;font-size:18px;" id="order-total-display">Total: $0.00</div>
          </div>

          <div class="red-box mb-3">
            <strong>No Refunds:</strong> All product orders are final once approved and shipped. No refunds, credits, or chargebacks.
          </div>

          <div class="checkbox-group mb-3">
            <input type="checkbox" id="order-agree-terms">
            <label for="order-agree-terms">I understand this order is subject to admin approval, all sales are final, and no refunds will be issued.</label>
          </div>

          <button class="btn btn-primary btn-lg w-full" onclick="submitClientOrder()">Submit Order for Review &rarr;</button>
        </div>
      </div>
    </div>

    <!-- Tab: Billing -->
    <div id="tab-billing" class="dash-tab-content">
      <div class="red-box mb-3">
        <strong>No Refunds Policy:</strong> All fees and payments are non-refundable. This includes application fees, monthly membership fees, and product orders.
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Method</th><th>Status</th><th>Reference</th></tr></thead>
          <tbody id="billing-tbody">
            <tr><td>Jan 10, 2025</td><td>Application Fee</td><td>$100.00</td><td>CashApp</td><td><span class="badge badge-green">Verified</span></td><td>HLF-APP-1234</td></tr>
            <tr><td>Feb 1, 2025</td><td>Monthly Membership</td><td>$50.00</td><td>ACH</td><td><span class="badge badge-green">Paid</span></td><td>HLF-MEM-0201</td></tr>
            <tr><td>Mar 1, 2025</td><td>Monthly Membership</td><td>$50.00</td><td>ACH</td><td><span class="badge badge-gold">Upcoming</span></td><td>&mdash;</td></tr>
          </tbody>
        </table>
      </div>
      <div class="card card-flat mt-4">
        <h4>Update Payment Method</h4>
        <p class="text-muted mt-2 mb-2">Current method on file: <strong>ACH Bank Transfer</strong></p>
        <div class="form-group">
          <select id="update-payment-method">
            <option>ACH Bank Transfer</option>
            <option>Wire Transfer</option>
            <option>CashApp</option>
            <option>Zelle</option>
            <option>Money Order</option>
          </select>
        </div>
        <button class="btn btn-sm btn-primary">Update Payment Method</button>
      </div>
    </div>

    <!-- Tab: Account -->
    <div id="tab-account" class="dash-tab-content">
      <div class="card card-flat mb-4" style="max-width:600px;">
        <h4 class="mb-3">Edit Profile</h4>
        <div class="form-row">
          <div class="form-group"><label>Full Name</label><input type="text" value="Demo Member"></div>
          <div class="form-group"><label>Business Name</label><input type="text" value="Demo Business LLC"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Email</label><input type="email" value="demo@hemplifefarmers.com"></div>
          <div class="form-group"><label>Phone</label><input type="tel" value="(555) 123-4567"></div>
        </div>
        <div class="form-group"><label>Shipping Address</label><input type="text" value="123 Business St, Baltimore, MD 21201"></div>
        <div class="form-group"><label>Billing Address</label><input type="text" value="Same as shipping"></div>
        <button class="btn btn-sm btn-primary">Save Changes</button>
      </div>
      <div class="card card-flat mb-4" style="max-width:600px;">
        <h4 class="mb-3">Change Password</h4>
        <div class="form-group"><label>Current Password</label><input type="password"></div>
        <div class="form-group"><label>New Password</label><input type="password"></div>
        <div class="form-group"><label>Confirm New Password</label><input type="password"></div>
        <button class="btn btn-sm btn-primary">Update Password</button>
      </div>
      <div class="card card-flat mb-4" style="max-width:600px;">
        <button class="btn btn-sm btn-secondary">Download My Data</button>
      </div>
      <div class="red-box" style="max-width:600px;">
        <h4 style="color:var(--barn-red);">Cancel Membership</h4>
        <p class="text-muted mt-2" style="font-size:14px;">Canceling your membership will immediately revoke access to wholesale ordering. Your current billing period will NOT be refunded. You will need to re-apply and pay a new $100 application fee to rejoin.</p>
        <div class="mt-3">
          <button class="btn btn-sm btn-danger" onclick="cancelMembership()">Cancel Membership</button>
          <button class="btn btn-sm btn-secondary" style="margin-left:8px;">Keep Membership</button>
        </div>
      </div>
    </div>

    <!-- Tab: Invite Members -->
    <div id="tab-invite" class="dash-tab-content">
      <div class="card card-flat mb-4">
        <h4>Your Referral Link</h4>
        <p class="text-muted mt-2" style="font-size:14px;">Share this link with potential buyers. Your invitation code will be pre-filled.</p>
        <div class="referral-link-box">
          <code id="referral-link-text">hemplifefarmers.com?invite=HLF-INV-DEMO&ref=Demo+Member</code>
          <button class="btn btn-sm btn-gold" onclick="copyReferralLink()">Copy</button>
        </div>
      </div>

      <div class="card card-flat mb-4">
        <h4>Generate Invitation Codes</h4>
        <p class="text-muted mt-2 mb-3" style="font-size:14px;">Create new invitation codes to share with potential members.</p>
        <button class="btn btn-sm btn-primary" onclick="generateInviteCode()">Generate New Code &rarr;</button>
      </div>

      <div class="mb-4">
        <h4 class="mb-2">Active Invitation Codes</h4>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Code</th><th>Created</th><th>Used By</th><th>Status</th></tr></thead>
            <tbody id="invite-codes-tbody">
              <tr><td>HLF-INV-8821</td><td>Feb 15, 2025</td><td>John Smith</td><td><span class="badge badge-green">Redeemed</span></td></tr>
              <tr><td>HLF-INV-9934</td><td>Mar 1, 2025</td><td>&mdash;</td><td><span class="badge badge-gold">Active</span></td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card card-flat">
        <h4>Referral Stats</h4>
        <div class="grid grid-3 mt-3">
          <div class="text-center"><div style="font-size:28px;font-weight:700;color:var(--green-dark);" id="stat-invites">3</div><p class="text-muted" style="font-size:13px;">Total Invites Sent</p></div>
          <div class="text-center"><div style="font-size:28px;font-weight:700;color:var(--green-dark);" id="stat-signups">1</div><p class="text-muted" style="font-size:13px;">Successful Sign-ups</p></div>
          <div class="text-center"><div style="font-size:28px;font-weight:700;color:var(--green-dark);" id="stat-active">1</div><p class="text-muted" style="font-size:13px;">Active Members</p></div>
        </div>
      </div>
    </div>

  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: ADMIN ==================== -->
<div id="page-admin" class="page">
  <div class="page-header" style="background:var(--green-dark);padding:32px 0;">
    <div class="container">
      <h1 style="color:#fff;">Super Admin Dashboard</h1>
      <p style="color:rgba(255,255,255,.7);">Manage members, orders, products, and site operations. <button class="btn btn-sm btn-outline-light" onclick="adminLogout()" style="margin-left:12px;">Log Out Admin</button></p>
    </div>
  </div>
  <div class="container">

    <!-- Admin Tabs -->
    <div class="dash-tabs" style="margin-top:24px;">
      <button class="dash-tab-btn active" onclick="switchAdminTab('members', this)">Members</button>
      <button class="dash-tab-btn" onclick="switchAdminTab('orders', this)">Orders</button>
      <button class="dash-tab-btn" onclick="switchAdminTab('products', this)">Products</button>
      <button class="dash-tab-btn" onclick="switchAdminTab('csv', this)">CSV Upload</button>
    </div>

    <!-- Admin Tab: Members Management -->
    <div id="admin-tab-members" class="admin-tab-content">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;" class="mb-3">
        <h3>Member Management</h3>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <input type="text" id="admin-member-search" placeholder="Search members..." style="padding:8px 14px;border:1px solid var(--border);border-radius:6px;font-size:13px;width:220px;" oninput="filterAdminMembers()">
          <select id="admin-member-filter" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;" onchange="filterAdminMembers()">
            <option value="all">All Status</option>
            <option value="pending">Pending</option>
            <option value="active">Active</option>
            <option value="suspended">Suspended</option>
            <option value="denied">Denied</option>
          </select>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Name</th><th>Business</th><th>Email</th><th>State</th><th>Invite Code</th><th>Applied</th><th>Status</th><th>Actions</th></tr>
          </thead>
          <tbody id="admin-members-tbody"></tbody>
        </table>
      </div>
      <p class="text-muted mt-2" style="font-size:12px;">Total: <span id="admin-members-count">0</span> members</p>

      <!-- Admin Invite Code Generator -->
      <div class="card card-flat mt-4" style="border:2px solid var(--gold);">
        <h4 style="margin-bottom:12px;">Generate Invitation Codes</h4>
        <p class="text-muted mb-3" style="font-size:13px;">Create invitation codes to give to prospective members. Only users with a valid code can apply.</p>
        <div style="display:flex;gap:12px;align-items:end;flex-wrap:wrap;">
          <div class="form-group" style="margin:0;">
            <label style="font-size:12px;">Number of codes</label>
            <select id="admin-code-qty" style="padding:8px;width:80px;">
              <option>1</option><option>3</option><option>5</option><option>10</option>
            </select>
          </div>
          <button class="btn btn-sm btn-gold" onclick="adminGenerateCodes()">Generate Codes</button>
        </div>
        <div id="admin-generated-codes" class="mt-3"></div>
        <div class="mt-3">
          <h5 style="margin-bottom:8px;">All Invitation Codes</h5>
          <div class="table-wrap">
            <table>
              <thead><tr><th>Code</th><th>Created</th><th>Status</th><th>Used By</th></tr></thead>
              <tbody id="admin-invite-codes-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Tab: Orders Management -->
    <div id="admin-tab-orders" class="admin-tab-content" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;" class="mb-3">
        <h3>Order Management</h3>
        <div style="display:flex;gap:8px;align-items:center;">
          <input type="text" id="admin-order-search" placeholder="Search orders..." style="padding:8px 14px;border:1px solid var(--border);border-radius:6px;font-size:13px;width:220px;" oninput="filterAdminOrders()">
          <select id="admin-order-filter" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;" onchange="filterAdminOrders()">
            <option value="all">All Status</option>
            <option value="pending_review">Pending Review</option>
            <option value="approved">Approved</option>
            <option value="processing">Processing</option>
            <option value="shipped">Shipped</option>
            <option value="delivered">Delivered</option>
            <option value="canceled">Canceled</option>
          </select>
        </div>
      </div>
      <div class="table-wrap">
        <table>
          <thead>
            <tr><th>Order #</th><th>Member</th><th>Products</th><th>Qty</th><th>Total</th><th>Payment</th><th>Date</th><th>Status</th><th>Actions</th></tr>
          </thead>
          <tbody id="admin-orders-tbody"></tbody>
        </table>
      </div>
      <p class="text-muted mt-2" style="font-size:12px;">Total: <span id="admin-orders-count">0</span> orders</p>
    </div>

    <!-- Admin Tab: Products Management -->
    <div id="admin-tab-products" class="admin-tab-content" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;" class="mb-3">
        <h3>Product Management</h3>
        <button class="btn btn-sm btn-primary" onclick="showAddProductModal()">+ Add Product</button>
      </div>

      <!-- Admin: Display Settings -->
      <div class="card card-flat mb-4" style="border:2px solid var(--gold);">
        <h4 style="margin-bottom:12px;">Catalog Display Settings</h4>
        <p class="text-muted mb-3" style="font-size:13px;">Control how products appear to members in the catalog.</p>
        <div style="display:flex;gap:24px;align-items:end;flex-wrap:wrap;">
          <div class="form-group" style="margin:0;">
            <label style="font-size:12px;font-weight:700;">Product Image Size</label>
            <select id="admin-img-size" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;" onchange="applyDisplaySettings()">
              <option value="180">Small (180px)</option>
              <option value="220">Medium (220px)</option>
              <option value="260" selected>Default (260px)</option>
              <option value="320">Large (320px)</option>
              <option value="400">Extra Large (400px)</option>
            </select>
          </div>
          <div class="form-group" style="margin:0;">
            <label style="font-size:12px;font-weight:700;">Description Display</label>
            <select id="admin-desc-mode" style="padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;" onchange="applyDisplaySettings()">
              <option value="short" selected>Brief Description Only</option>
              <option value="both">Brief + Expandable Full</option>
              <option value="long">Full Description Only</option>
              <option value="none">No Description</option>
            </select>
          </div>
        </div>
        <p class="text-muted mt-2" style="font-size:11px;">Changes apply instantly to the product catalog view.</p>
      </div>

      <div id="admin-products-list"></div>
    </div>

    <!-- Admin Tab: CSV Upload -->
    <div id="admin-tab-csv" class="admin-tab-content" style="display:none;">
      <h3 class="mb-3">CSV Product Import</h3>
      <div class="card card-flat mb-4">
        <p class="text-muted mb-3">Upload a CSV file with product data. The file will be validated before import. Max 5MB, UTF-8 encoded.</p>
        <div class="upload-zone" onclick="document.getElementById('csv-file-input').click()">
          <input type="file" id="csv-file-input" accept=".csv" onchange="handleCSVUpload(event)">
          <p style="font-size:36px;margin-bottom:12px;">&#128194;</p>
          <p style="font-weight:700;">Click to Choose CSV File</p>
          <p class="text-muted" style="font-size:13px;">.csv files only, max 5MB</p>
        </div>
      </div>
      <div id="csv-preview" class="card card-flat mb-4" style="display:none;">
        <h4 class="mb-2">Preview (first 5 rows)</h4>
        <div class="table-wrap" id="csv-preview-table"></div>
      </div>
      <div id="csv-validation" style="display:none;" class="mb-4"></div>
      <button id="csv-import-btn" class="btn btn-primary w-full mb-4" disabled onclick="importCSVProducts()">Import Products</button>
      <div id="csv-results" style="display:none;" class="mb-4"></div>
      <details class="mt-2">
        <summary style="cursor:pointer;font-weight:700;font-size:14px;color:var(--green-dark);">CSV Schema Reference (66 columns)</summary>
        <p class="text-muted mt-2" style="font-size:12px;line-height:1.8;">
          <strong>Core:</strong> sku, product_name, product_type, product_category, status<br>
          <strong>Cultivation:</strong> cultivation_method, cultivation_location, harvest_date, strain_name_internal<br>
          <strong>Cannabinoids:</strong> delta9_thc_pct, thca_pct, cbd_pct, cbg_pct, cbn_pct, total_cannabinoids_pct<br>
          <strong>Terpenes:</strong> terpene_1_name/pct, terpene_2_name/pct, terpene_3_name/pct, total_terpenes_pct<br>
          <strong>Physical:</strong> appearance, aroma_profile, moisture_content_pct, trim_type, density<br>
          <strong>Lab:</strong> coa_batch_number, coa_test_date, coa_lab_name, coa_lab_accreditation, coa_pdf_filename, 6 safety passes, farm_bill_compliant<br>
          <strong>Pricing:</strong> price_per_lb, price_5lb, price_10lb, min_order_lbs, inventory_lbs_available, inventory_status<br>
          <strong>Display:</strong> display_order, featured, short_description, long_description, product_image_filename, compliance_statement<br>
          <strong>Chain of Custody:</strong> coc_cultivation_origin, coc_processor, coc_handler, coc_storage_facility, coc_last_audit_date<br>
          <strong>Shipping:</strong> restricted_states &middot; <strong>Tracking:</strong> date_added, last_updated, added_by, notes_internal
        </p>
      </details>
    </div>

  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== ADMIN: EDIT PRODUCT MODAL ==================== -->
<div id="edit-product-modal" style="display:none;position:fixed;inset:0;background:rgba(20,20,16,.75);z-index:9999;overflow-y:auto;padding:24px;">
  <div style="max-width:720px;margin:40px auto;background:var(--surface);border-radius:14px;padding:36px;box-shadow:0 24px 80px rgba(0,0,0,.3);">
    <div style="display:flex;justify-content:space-between;align-items:center;" class="mb-3">
      <h2 id="edit-product-title">Edit Product</h2>
      <button class="btn btn-sm btn-secondary" onclick="closeEditProductModal()">&times; Close</button>
    </div>
    <div class="form-row">
      <div class="form-group"><label>SKU *</label><input type="text" id="edit-sku"></div>
      <div class="form-group"><label>Product Name *</label><input type="text" id="edit-product-name"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Product Type</label><input type="text" id="edit-product-type" placeholder="e.g. THCA Flower"></div>
      <div class="form-group"><label>Category</label><input type="text" id="edit-product-category" placeholder="e.g. Flower"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Status</label>
        <select id="edit-status"><option value="active">Active</option><option value="inactive">Inactive</option><option value="out_of_stock">Out of Stock</option></select>
      </div>
      <div class="form-group"><label>Featured</label>
        <select id="edit-featured"><option value="TRUE">Yes</option><option value="FALSE">No</option></select>
      </div>
    </div>
    <h4 class="mt-3 mb-2">Pricing &amp; Inventory</h4>
    <div class="form-row">
      <div class="form-group"><label>Price per lb ($)</label><input type="number" id="edit-price-lb" step="0.01"></div>
      <div class="form-group"><label>Price 5 lb ($)</label><input type="number" id="edit-price-5lb" step="0.01"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Price 10 lb ($)</label><input type="number" id="edit-price-10lb" step="0.01"></div>
      <div class="form-group"><label>Inventory (lbs available)</label><input type="number" id="edit-inventory" step="0.01"></div>
    </div>
    <h4 class="mt-3 mb-2">Image</h4>
    <div class="form-row">
      <div class="form-group"><label>Product Image Filename</label><input type="text" id="edit-product-image" placeholder="e.g. product-photo.jpg"></div>
      <div class="form-group"><label>Image Display Size</label>
        <select id="edit-img-size">
          <option value="">Use Catalog Default</option>
          <option value="180">Small (180px)</option>
          <option value="220">Medium (220px)</option>
          <option value="260">Default (260px)</option>
          <option value="320">Large (320px)</option>
          <option value="400">Extra Large (400px)</option>
        </select>
      </div>
    </div>
    <p class="text-muted" style="font-size:12px;">In production, this would be a file upload. For demo, enter a filename. Image size overrides the global catalog setting for this product only.</p>
    <h4 class="mt-3 mb-2">Description</h4>
    <div class="form-group"><label>Brief Description</label><textarea id="edit-short-desc" style="min-height:60px;" placeholder="Short summary shown on product cards (1-2 sentences)"></textarea></div>
    <div class="form-group"><label>Full Description</label><textarea id="edit-long-desc" style="min-height:80px;" placeholder="Detailed product description shown when expanded"></textarea></div>
    <h4 class="mt-3 mb-2">Compliance</h4>
    <div class="form-row">
      <div class="form-group"><label>&Delta;9 THC %</label><input type="number" id="edit-thc" step="0.01"></div>
      <div class="form-group"><label>THCA %</label><input type="number" id="edit-thca" step="0.01"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>CBD %</label><input type="number" id="edit-cbd" step="0.01"></div>
      <div class="form-group"><label>COA Batch #</label><input type="text" id="edit-coa-batch"></div>
    </div>
    <div class="form-group"><label>Restricted States (comma-separated codes)</label><input type="text" id="edit-restricted" placeholder="e.g. ID,OR,SD"></div>
    <input type="hidden" id="edit-product-index" value="-1">
    <div class="mt-3" style="display:flex;gap:12px;">
      <button class="btn btn-primary" onclick="saveProductEdit()">Save Changes</button>
      <button class="btn btn-secondary" onclick="closeEditProductModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- ==================== PAGE: DISCLAIMER ==================== -->
<div id="page-disclaimer" class="page">
  <div class="container">
    <div class="legal-card">
      <h1>Legal Disclaimer</h1>
      <p class="legal-date">Last updated: February 2026</p>

      <div class="legal-section">
        <h3>1. Product Compliance</h3>
        <p>Products sold on this website are derived from hemp and are federally legal under the Agriculture Improvement Act of 2018 (2018 Farm Bill). All products contain no more than 0.3% &Delta;9-THC on a dry-weight basis as verified by independent, ISO-accredited laboratories.</p>
      </div>

      <div class="legal-section">
        <h3>2. FDA Disclaimer</h3>
        <div class="red-box">
          <p><strong>These products have not been evaluated by the Food and Drug Administration (FDA) and are not intended to diagnose, treat, cure, or prevent any disease.</strong></p>
        </div>
      </div>

      <div class="legal-section">
        <h3>3. Buyer Responsibility</h3>
        <p>Buyer assumes all responsibility for compliance with local, state, and federal laws regarding the possession, transport, and resale of hemp-derived products.</p>
      </div>

      <div class="legal-section">
        <h3>4. No Representation of Legality</h3>
        <p>Seller makes no representation regarding the legality of these products in the buyer's jurisdiction.</p>
      </div>

      <div class="legal-section">
        <h3>5. No Medical Claims</h3>
        <p>Hemp Life Farmers does not make any medical, therapeutic, or health claims about any products sold on this website.</p>
      </div>

      <div class="legal-section">
        <h3>6. No Intoxicating Claims</h3>
        <p>Hemp Life Farmers does not market, promote, or represent its products as having intoxicating effects.</p>
      </div>

      <div class="legal-section">
        <h3>7. Assumption of Risk</h3>
        <p>By purchasing products from Hemp Life Farmers, buyer acknowledges and accepts all risks associated with the purchase, possession, transport, and use of hemp-derived products.</p>
      </div>

      <div class="legal-section">
        <h3>8. Limitation of Liability</h3>
        <p>In no event shall Hemp Life Farmers be liable for any indirect, incidental, special, consequential, or punitive damages.</p>
      </div>
    </div>
  </div>
</div>

<!-- ==================== PAGE: TERMS ==================== -->
<div id="page-terms" class="page">
  <div class="container">
    <div class="legal-card">
      <h1>Terms of Service</h1>
      <p class="legal-date">Last updated: February 2026</p>

      <div class="legal-section">
        <h3>1. Acceptance of Terms</h3>
        <p>By accessing or using the Hemp Life Farmers website and services, you agree to be bound by these Terms of Service. If you do not agree to these terms, you must not use this website or purchase any products.</p>
      </div>

      <div class="legal-section">
        <h3>2. Eligibility</h3>
        <p>You must be at least 21 years of age to access this website, create an account, or purchase products. By using this site, you represent and warrant that you are at least 21 years old.</p>
      </div>

      <div class="legal-section">
        <h3>3. Invitation-Only Access</h3>
        <p>Access to Hemp Life Farmers requires a valid invitation code from an existing member. Invitation codes are non-transferable. Sharing or selling invitation codes is grounds for immediate membership termination.</p>
      </div>

      <div class="legal-section">
        <h3>4. Membership Terms</h3>
        <p>Membership requires a $100 non-refundable application fee and $50/month recurring membership fee. Membership may be canceled at any time but no refunds will be issued for the current billing period or the application fee. Hemp Life Farmers reserves the right to revoke membership at its sole discretion.</p>
      </div>

      <div class="legal-section">
        <h3>5. No Refunds Policy</h3>
        <div class="red-box">
          <p><strong>ALL FEES ARE NON-REFUNDABLE.</strong> This includes but is not limited to: the $100 application fee, all $50 monthly membership payments, and all product order payments. There are no exceptions, no credits, and no chargebacks. By using this site and placing orders, you acknowledge and accept this policy in its entirety.</p>
        </div>
      </div>

      <div class="legal-section">
        <h3>6. Products and Compliance</h3>
        <p>All products sold are derived from hemp and comply with the Agriculture Improvement Act of 2018 (Farm Bill). All products contain no more than 0.3% &Delta;9-THC on a dry-weight basis. Products are tested by independent, ISO-accredited laboratories.</p>
      </div>

      <div class="legal-section">
        <h3>7. Wholesale Terms</h3>
        <p>Minimum order quantity is 1 pound. All sales are final once shipped. Hemp Life Farmers reserves the right to refuse or cancel any order at its sole discretion.</p>
      </div>

      <div class="legal-section">
        <h3>8. Buyer Responsibilities</h3>
        <p>Buyers are responsible for verifying the legality of hemp products in their jurisdiction. Buyers agree not to resell products to minors or prohibited parties. Buyers must maintain all compliance documentation provided with orders.</p>
      </div>

      <div class="legal-section">
        <h3>9. Invitation &amp; Referral Code Requirement</h3>
        <p>All buyers must have a valid invitation code. Codes are tracked by member name. Orders without valid codes will not be processed.</p>
      </div>

      <div class="legal-section">
        <h3>10. Payment Terms</h3>
        <p>$100 application fee must be paid before application review. $50/month membership begins upon approval. Accepted payment methods: ACH, wire transfer, CashApp, Zelle, money order. Late or missed payments will result in membership suspension. Reinstatement requires a new $100 application fee.</p>
      </div>

      <div class="legal-section">
        <h3>11. Indemnification</h3>
        <p>You agree to indemnify, defend, and hold harmless Hemp Life Farmers, its officers, directors, employees, and agents from and against any claims, liabilities, damages, losses, and expenses arising out of your use of the website or products, violation of these terms, or violation of any third-party rights.</p>
      </div>

      <div class="legal-section">
        <h3>12. Limitation of Liability</h3>
        <p>In no event shall Hemp Life Farmers be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses.</p>
      </div>

      <div class="legal-section">
        <h3>13. Right to Refuse Service</h3>
        <p>Hemp Life Farmers reserves the right to refuse, cancel, or revoke service to any person or entity at its sole discretion, without explanation or liability.</p>
      </div>

      <div class="legal-section">
        <h3>14. Governing Law</h3>
        <p>These Terms shall be governed by and construed in accordance with the laws of the State of Maryland and applicable federal law, without regard to conflict of law provisions.</p>
      </div>

      <div class="legal-section">
        <h3>15. Contact</h3>
        <p>Questions about these Terms of Service may be directed to us via our <a href="#" onclick="navigate('contact');return false;">Wholesale Inquiry</a> page.</p>
      </div>
    </div>
  </div>
</div>

<!-- ==================== PAGE: PRIVACY ==================== -->
<div id="page-privacy" class="page">
  <div class="container">
    <div class="legal-card">
      <h1>Privacy Policy</h1>
      <p class="legal-date">Last updated: February 2026</p>

      <div class="legal-section">
        <h3>1. Information We Collect</h3>
        <p>We collect the following information from members and applicants:</p>
        <ul>
          <li>Full name and business information</li>
          <li>Business license number and EIN/Tax ID</li>
          <li>Billing and shipping addresses</li>
          <li>Invitation code and referrer information</li>
          <li>IP address and geographic location data</li>
          <li>Order history and transaction records</li>
          <li>Payment details and method preferences</li>
          <li>Age verification confirmation</li>
          <li>Login credentials (encrypted)</li>
          <li>Membership and billing records</li>
        </ul>
      </div>

      <div class="legal-section">
        <h3>2. How We Use Information</h3>
        <ul>
          <li>Process membership applications</li>
          <li>Fulfill and track wholesale orders</li>
          <li>Bill monthly membership fees</li>
          <li>Verify regulatory compliance</li>
          <li>Track invitation codes and referrals</li>
          <li>Communicate about orders, billing, and membership</li>
          <li>Comply with federal and state law</li>
        </ul>
      </div>

      <div class="legal-section">
        <h3>3. Information Sharing</h3>
        <p>We do not sell your personal information to third parties. We may share information with: payment processors (for transaction processing), shipping carriers (for order fulfillment), law enforcement (when required by law), and legal counsel (for compliance and legal matters).</p>
      </div>

      <div class="legal-section">
        <h3>4. Data Retention</h3>
        <p>Hemp commerce records are retained for a minimum of 7 years in compliance with federal and state record-keeping requirements for hemp businesses.</p>
      </div>

      <div class="legal-section">
        <h3>5. Security</h3>
        <p>We implement reasonable security measures to protect your personal information. However, no method of electronic transmission or storage is 100% secure, and we cannot guarantee absolute security.</p>
      </div>

      <div class="legal-section">
        <h3>6. Your Rights</h3>
        <p>You may request access to, correction of, or deletion of your personal information. Please note that some records must be retained for compliance purposes and cannot be deleted upon request. To exercise your rights, contact us via our Wholesale Inquiry page.</p>
      </div>

      <div class="legal-section">
        <h3>7. Contact</h3>
        <p>Questions about this Privacy Policy may be directed to us via our <a href="#" onclick="navigate('contact');return false;">Wholesale Inquiry</a> page.</p>
      </div>
    </div>
  </div>
</div>

<!-- ==================== PAGE: CONTACT ==================== -->
<div id="page-contact" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Contact / Wholesale Inquiry</h1>
      <p>Get in touch with our wholesale team.</p>
    </div>
  </div>
  <div class="container">
    <div class="contact-grid">
      <!-- Left: Info Cards -->
      <div>
        <div class="card contact-info-card mb-3">
          <h4>&#128230; Wholesale Inquiries</h4>
          <p>Product availability, pricing, and bulk orders. We respond within 1&ndash;2 business days.</p>
        </div>
        <div class="card contact-info-card mb-3">
          <h4>&#128203; Compliance Requests</h4>
          <p>COAs, chain-of-custody docs, and compliance questions. Please include your order number or membership ID.</p>
        </div>
        <div class="card contact-info-card">
          <h4>&#128179; Payment Methods</h4>
          <p>We accept ACH, wire transfer, CashApp, Zelle, and money order. No PayPal, Venmo, or credit cards.</p>
        </div>
      </div>

      <!-- Right: Form -->
      <div class="card card-flat">
        <div class="form-row">
          <div class="form-group"><label>Full Name *</label><input type="text" id="contact-name" required></div>
          <div class="form-group"><label>Business Name *</label><input type="text" id="contact-business" required></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Email *</label><input type="email" id="contact-email" required></div>
          <div class="form-group"><label>Phone</label><input type="tel" id="contact-phone"></div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>State *</label>
            <select id="contact-state">
              <option value="">Select State...</option>
              <option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option>
            </select>
          </div>
          <div class="form-group"><label>Member ID (if applicable)</label><input type="text" id="contact-member-id"></div>
        </div>
        <div class="form-group">
          <label>Inquiry Type *</label>
          <select id="contact-type">
            <option value="">Select...</option>
            <option>General Inquiry</option>
            <option>Membership Question</option>
            <option>Order Inquiry</option>
            <option>COA / Lab Results</option>
            <option>Compliance Question</option>
            <option>Payment Question</option>
            <option>Invitation Code Request</option>
          </select>
        </div>
        <div class="form-group"><label>Message *</label><textarea id="contact-message" placeholder="How can we help?"></textarea></div>
        <div class="checkbox-group"><input type="checkbox" id="contact-age" required><label for="contact-age">I am 21 years of age or older.</label></div>
        <div class="checkbox-group"><input type="checkbox" id="contact-terms" required><label for="contact-terms">I agree to the <a href="#" onclick="navigate('terms');return false;">Terms of Service</a> and <a href="#" onclick="navigate('disclaimer');return false;">Legal Disclaimer</a>.</label></div>
        <button class="btn btn-soil w-full mt-2" onclick="submitContactForm()">Send Inquiry &rarr;</button>
      </div>
    </div>
    <div class="gold-box mt-4 text-center">All buyers are tracked by invitation code and name. No unverified customers.</div>
  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: THANK YOU ==================== -->
<div id="page-thankyou" class="page">
  <div class="container" style="padding-top:60px;">
    <div style="max-width:640px;margin:0 auto;text-align:center;">
      <img src="images/logo.png?v=2" alt="Hemp Life Farmers" style="width:80px;height:80px;border-radius:50%;margin:0 auto 24px;">
      <h1>Thank You</h1>
      <p class="text-muted mb-4" style="font-size:18px;">Your inquiry has been received. We will respond within 1&ndash;2 business days.</p>

      <div class="green-box mb-4">
        <p>If you submitted a membership application, your reference number was provided on the application confirmation page. Please include it with your payment.</p>
      </div>

      <div class="card card-flat mb-4 text-left">
        <h4>Payment Methods Reminder</h4>
        <ul style="list-style:disc;padding-left:20px;margin-top:12px;" class="text-muted">
          <li><strong>ACH / Wire:</strong> Bank details provided via email</li>
          <li><strong>CashApp:</strong> $HempLifeFarmers</li>
          <li><strong>Zelle:</strong> payments@hemplifefarmers.com</li>
          <li><strong>Money Order:</strong> Payable to Hemp Life Farmers</li>
        </ul>
      </div>

      <div class="card card-flat mb-4 text-left">
        <h4>Application Timeline</h4>
        <ol style="list-style:decimal;padding-left:20px;margin-top:12px;" class="text-muted">
          <li>Send payment with reference number</li>
          <li>Payment verified (1&ndash;2 business days)</li>
          <li>Application reviewed (2&ndash;3 business days)</li>
          <li>Approval email with login credentials</li>
          <li>First $50 monthly billing upon approval</li>
        </ol>
      </div>

      <div>
        <button class="btn btn-text" onclick="navigate('home')">Return to Home &rarr;</button>
        <button class="btn btn-secondary" onclick="navigate('products')" style="margin-left:12px;">View Products</button>
      </div>
    </div>
  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== PAGE: INVITE CODE ==================== -->
<div id="page-invite" class="page">
  <div class="page-header">
    <div class="container">
      <h1>Invitation Code</h1>
      <p>How to get in — and what happens if you don't have one.</p>
    </div>
  </div>
  <div class="container" style="max-width:800px;">

    <!-- The Gate -->
    <section style="text-align:center;margin-bottom:60px;">
      <div class="sec-title" style="margin-bottom:20px;">
        <span class="subtitle">Private Access Only</span>
        <h2>No Code, No Entry.</h2>
      </div>
      <p style="font-size:18px;color:var(--clr-text-muted);line-height:1.8;max-width:640px;margin:0 auto;">Hemp Life Farmers is a closed wholesale network. Every door — products, pricing, membership, ordering — requires a valid invitation code. There are no exceptions and no workarounds. If you don't have a code, you cannot get in.</p>
    </section>

    <!-- What Is It -->
    <section style="margin-bottom:50px;">
      <h3 style="margin-bottom:16px;">What Is an Invitation Code?</h3>
      <p style="font-size:16px;color:var(--clr-text-muted);line-height:1.8;">An invitation code is a unique key in the format <strong style="color:var(--clr-text-main);font-family:monospace;font-size:17px;">HLF-INV-XXXX</strong> assigned to each verified member. It's the only way to unlock access to our wholesale catalog, membership details, and application process. Codes are non-transferable and tracked to the member who issued them.</p>
    </section>

    <!-- How to Get One -->
    <section style="margin-bottom:50px;">
      <h3 style="margin-bottom:16px;">How Do I Get a Code?</h3>
      <div style="background:var(--clr-surface);border:1px solid var(--clr-border);border-radius:14px;padding:32px;">
        <ol style="list-style:none;padding:0;margin:0;counter-reset:steps;">
          <li style="display:flex;gap:20px;align-items:flex-start;margin-bottom:24px;">
            <span style="flex-shrink:0;width:40px;height:40px;background:var(--green-pale);color:var(--green-dark);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:Outfit,sans-serif;font-weight:800;font-size:16px;">1</span>
            <div><strong style="display:block;margin-bottom:4px;font-size:16px;">Know an existing member</strong><span style="color:var(--clr-text-muted);font-size:15px;line-height:1.7;">Codes are only given out by current, active Hemp Life Farmers members. You need a real relationship with someone already inside.</span></div>
          </li>
          <li style="display:flex;gap:20px;align-items:flex-start;margin-bottom:24px;">
            <span style="flex-shrink:0;width:40px;height:40px;background:var(--gold-pale);color:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:Outfit,sans-serif;font-weight:800;font-size:16px;">2</span>
            <div><strong style="display:block;margin-bottom:4px;font-size:16px;">They share their invite code with you</strong><span style="color:var(--clr-text-muted);font-size:15px;line-height:1.7;">Each member receives a limited number of codes. When they vouch for you, they give you their code directly.</span></div>
          </li>
          <li style="display:flex;gap:20px;align-items:flex-start;">
            <span style="flex-shrink:0;width:40px;height:40px;background:var(--soil-pale);color:var(--soil);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:Outfit,sans-serif;font-weight:800;font-size:16px;">3</span>
            <div><strong style="display:block;margin-bottom:4px;font-size:16px;">Enter it anywhere on our site</strong><span style="color:var(--clr-text-muted);font-size:15px;line-height:1.7;">Use the code on the Products page, Membership page, or Application page to unlock access. One code opens all doors.</span></div>
          </li>
        </ol>
      </div>
    </section>

    <!-- What If I Don't Have One -->
    <section style="margin-bottom:50px;">
      <h3 style="margin-bottom:16px;">What If I Don't Have a Code?</h3>
      <div class="red-box">
        <p style="font-size:16px;line-height:1.8;margin:0;"><strong>You cannot access Hemp Life Farmers without an invitation code.</strong> We do not sell codes. We do not accept cold inquiries. We do not have a waitlist. This is by design — our network is built on trust between partners who know and vouch for each other.</p>
      </div>
    </section>

    <!-- Enter Code CTA -->
    <section style="text-align:center;margin-bottom:60px;">
      <div style="background:var(--clr-surface);border:2px solid var(--clr-secondary);border-radius:16px;padding:40px;">
        <h3 style="margin-bottom:8px;">Already Have a Code?</h3>
        <p class="text-muted" style="margin-bottom:24px;">Enter it below to unlock full access.</p>
        <div style="max-width:360px;margin:0 auto;">
          <div class="form-group" style="margin-bottom:16px;">
            <input type="text" id="invite-page-input" placeholder="HLF-INV-XXXX" style="text-align:center;text-transform:uppercase;font-size:20px;letter-spacing:0.12em;">
          </div>
          <button class="btn btn-soil w-full" onclick="validateInvitePageCode()">Verify Code &amp; Enter &rarr;</button>
          <p id="invite-page-error" style="color:var(--barn-red);font-size:13px;margin-top:12px;display:none;">Invalid code. Format: HLF-INV-XXXX</p>
        </div>
      </div>
    </section>

  </div>
  <div style="height:60px"></div>
</div>

<!-- ==================== FOOTER ==================== -->
<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <!-- Brand -->
      <div class="footer-brand">
        <img src="images/logo.png?v=2" alt="Hemp Life Farmers">
        <p>Grown from the earth, delivered with integrity. Premium hemp cultivated in Maryland soil for licensed wholesale partners.</p>
      </div>
      <!-- Explore -->
      <div>
        <h4>Explore</h4>
        <ul class="footer-links">
          <li><a href="#" onclick="navigate('home');return false;">Home</a></li>
          <li><a href="#" onclick="navigate('products');return false;">Wholesale Catalog</a></li>
          <li><a href="#" onclick="navigate('apply');return false;">Apply for Account</a></li>
          <li><a href="#" onclick="navigate('membership');return false;">Membership</a></li>
        </ul>
      </div>
      <!-- Compliance -->
      <div>
        <h4>Compliance</h4>
        <ul class="footer-links">
          <li><a href="#" onclick="navigate('compliance');return false;">Lab Reports &amp; COAs</a></li>
          <li><a href="#" onclick="navigate('shipping');return false;">Shipping Restrictions</a></li>
          <li><a href="#" onclick="navigate('disclaimer');return false;">Legal Disclaimer</a></li>
        </ul>
      </div>
      <!-- Legal -->
      <div>
        <h4>Legal</h4>
        <ul class="footer-links">
          <li><a href="#" onclick="navigate('terms');return false;">Terms of Service</a></li>
          <li><a href="#" onclick="navigate('privacy');return false;">Privacy Policy</a></li>
          <li><a href="#" onclick="navigate('contact');return false;">Contact</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="container">
      &copy; 2026 Hemp Life Farmers &mdash; Rooted in Maryland Soil. Wholesale Only. 21+ to enter.
    </div>
  </div>
</footer>

<script>
/* ============================================================
   Hemp Life Farmers — Single-Page Application JavaScript
   Complete client-side routing, product engine, membership,
   admin tools, and all interactivity.
   ============================================================ */

/* ----------------------------------------------------------
   GLOBAL STATE
   ---------------------------------------------------------- */
let productData = [];
let restrictedStatesSet = new Set();

/* ----------------------------------------------------------
   1. CLIENT-SIDE ROUTING
   ---------------------------------------------------------- */
function navigate(pageName) {
  var validPages = [
    'home','products','compliance','shipping','membership',
    'apply','login','dashboard','admin','disclaimer',
    'terms','privacy','contact','thankyou','invite'
  ];

  if (validPages.indexOf(pageName) === -1) {
    pageName = 'home';
  }

  /* Guard: dashboard requires login */
  if (pageName === 'dashboard' && !sessionStorage.getItem('memberLoggedIn')) {
    pageName = 'login';
  }

  /* Guard: admin requires admin flag */
  if (pageName === 'admin' && !sessionStorage.getItem('isAdmin')) {
    pageName = sessionStorage.getItem('memberLoggedIn') ? 'dashboard' : 'login';
  }

  /* Ensure product data is loaded for data-driven pages */
  if (['products','compliance','shipping'].indexOf(pageName) !== -1 && productData.length === 0) {
    loadProducts();
  }

  /* Hide every .page, show the target */
  var pages = document.querySelectorAll('.page');
  for (var i = 0; i < pages.length; i++) {
    pages[i].classList.remove('active');
  }
  var target = document.getElementById('page-' + pageName);
  if (target) {
    target.classList.add('active');
  }

  /* Update nav active state */
  var navLinks = document.querySelectorAll('nav a, .nav-links a, #main-nav a');
  for (var j = 0; j < navLinks.length; j++) {
    navLinks[j].classList.remove('active');
    var onclick = navLinks[j].getAttribute('onclick') || '';
    if (onclick.indexOf("'" + pageName + "'") !== -1 || onclick.indexOf('"' + pageName + '"') !== -1) {
      navLinks[j].classList.add('active');
    }
  }

  /* Scroll to top */
  window.scrollTo(0, 0);

  /* Update document title */
  var titles = {
    home: 'Hemp Life Farmers — Wholesale Hemp Marketplace',
    products: 'Products — Hemp Life Farmers',
    compliance: 'Compliance & COAs — Hemp Life Farmers',
    shipping: 'Shipping & Logistics — Hemp Life Farmers',
    membership: 'Membership — Hemp Life Farmers',
    apply: 'Apply for Membership — Hemp Life Farmers',
    login: 'Member Login — Hemp Life Farmers',
    dashboard: 'Member Dashboard — Hemp Life Farmers',
    admin: 'Admin — Hemp Life Farmers',
    disclaimer: 'Disclaimer — Hemp Life Farmers',
    terms: 'Terms & Conditions — Hemp Life Farmers',
    privacy: 'Privacy Policy — Hemp Life Farmers',
    contact: 'Contact — Hemp Life Farmers',
    thankyou: 'Thank You — Hemp Life Farmers'
  };
  document.title = titles[pageName] || 'Hemp Life Farmers';

  /* Update hash without triggering hashchange re-entry */
  if (window.location.hash !== '#' + pageName) {
    history.pushState(null, '', '#' + pageName);
  }

  /* Page-specific init */
  if (pageName === 'dashboard') {
    populateDashboard();
  }
  if (pageName === 'admin') {
    populateAdminDashboard();
  }
  if (pageName === 'products') {
    updateProductsWall();
  }
  if (pageName === 'apply') {
    autoFillInviteCode();
  }

  /* Close mobile menu if open */
  closeMobileMenu();
}

/* Hash-based routing listeners */
window.addEventListener('hashchange', function() {
  var hash = window.location.hash.replace('#', '');
  if (hash) {
    navigate(hash);
  }
});

window.addEventListener('popstate', function() {
  var hash = window.location.hash.replace('#', '');
  if (hash) {
    navigate(hash);
  }
});

/* ----------------------------------------------------------
   2. AGE VERIFICATION
   ---------------------------------------------------------- */
function verifyAge() {
  sessionStorage.setItem('ageVerified', 'true');
  var gate = document.getElementById('age-gate');
  if (gate) {
    gate.style.display = 'none';
  }
}

function checkAge() {
  var gate = document.getElementById('age-gate');
  if (!gate) return;
  if (!sessionStorage.getItem('ageVerified')) {
    gate.style.display = 'flex';
  } else {
    gate.style.display = 'none';
  }
}

/* ----------------------------------------------------------
   3. REFERRAL / INVITATION URL PARAMS
   ---------------------------------------------------------- */
function checkReferralParams() {
  var params = new URLSearchParams(window.location.search);
  var invite = params.get('invite');
  var ref = params.get('ref');
  if (invite) {
    sessionStorage.setItem('inviteCode', invite);
    sessionStorage.setItem('inviteRef', ref || '');
    var banner = document.getElementById('referral-banner');
    if (banner) {
      banner.style.display = 'block';
      var refName = document.getElementById('ref-name');
      var refCode = document.getElementById('ref-code');
      if (refName) refName.textContent = ref || 'A Member';
      if (refCode) refCode.textContent = invite;
    }
  }
}

/* ----------------------------------------------------------
   4. CSV PRODUCT DATA ENGINE
   ---------------------------------------------------------- */
async function loadProducts() {
  try {
    var response = await fetch('products.csv');
    if (!response.ok) throw new Error('HTTP ' + response.status);
    var text = await response.text();
    productData = parseCSV(text);
    renderAllProductViews();
  } catch(e) {
    console.warn('Failed to load products.csv — using fallback data:', e);
    productData = getFallbackProducts();
    renderAllProductViews();
  }
}

/**
 * Robust CSV parser.
 * Handles: quoted fields with commas, quoted fields with newlines,
 * double-quote escaping (""), and mixed line-endings.
 * Returns an array of objects keyed by the header row.
 */
function parseCSV(text) {
  var rows = [];
  var headers = [];
  var row = [];
  var field = '';
  var inQuotes = false;
  var i = 0;
  var len = text.length;

  while (i < len) {
    var ch = text[i];

    if (inQuotes) {
      if (ch === '"') {
        /* Look ahead for escaped quote */
        if (i + 1 < len && text[i + 1] === '"') {
          field += '"';
          i += 2;
          continue;
        } else {
          /* End of quoted field */
          inQuotes = false;
          i++;
          continue;
        }
      } else {
        field += ch;
        i++;
        continue;
      }
    }

    /* Not in quotes */
    if (ch === '"') {
      inQuotes = true;
      i++;
      continue;
    }

    if (ch === ',') {
      row.push(field.trim());
      field = '';
      i++;
      continue;
    }

    if (ch === '\r') {
      /* Handle \r\n or bare \r */
      row.push(field.trim());
      field = '';
      if (i + 1 < len && text[i + 1] === '\n') {
        i++;
      }
      /* Commit row */
      if (headers.length === 0) {
        headers = row;
      } else if (row.length > 0) {
        rows.push(row);
      }
      row = [];
      i++;
      continue;
    }

    if (ch === '\n') {
      row.push(field.trim());
      field = '';
      if (headers.length === 0) {
        headers = row;
      } else if (row.length > 0) {
        rows.push(row);
      }
      row = [];
      i++;
      continue;
    }

    field += ch;
    i++;
  }

  /* Handle last field / row if file doesn't end with newline */
  if (field.length > 0 || row.length > 0) {
    row.push(field.trim());
    if (headers.length === 0) {
      headers = row;
    } else if (row.length > 0) {
      rows.push(row);
    }
  }

  /* Convert to array of objects */
  var result = [];
  for (var r = 0; r < rows.length; r++) {
    var obj = {};
    for (var c = 0; c < headers.length; c++) {
      obj[headers[c]] = (c < rows[r].length) ? rows[r][c] : '';
    }
    result.push(obj);
  }
  return result;
}

/* --- Display settings (admin-controlled) --- */
var catalogDisplaySettings = { imgHeight: 260, descMode: 'short' };

function applyDisplaySettings() {
  var sizeEl = document.getElementById('admin-img-size');
  var modeEl = document.getElementById('admin-desc-mode');
  if (sizeEl) catalogDisplaySettings.imgHeight = parseInt(sizeEl.value) || 260;
  if (modeEl) catalogDisplaySettings.descMode = modeEl.value || 'short';
  document.documentElement.style.setProperty('--product-img-height', catalogDisplaySettings.imgHeight + 'px');
  renderProductCatalog();
  renderHomeFeatured();
}

function toggleLongDesc(btn) {
  var desc = btn.previousElementSibling;
  if (desc) {
    desc.classList.toggle('show');
    btn.textContent = desc.classList.contains('show') ? 'Show less' : 'Read more';
  }
}

function renderAllProductViews() {
  buildRestrictedStatesSet();
  renderHomeFeatured();
  renderProductCatalog();
  renderCOATable();
  renderRestrictedStates();
  renderProductInterestChecks();
  renderChainOfCustody();
}

/* buildRestrictedStatesSet is defined in section 23 (Restricted States) */

/* ----------------------------------------------------------
   5. PRODUCT RENDERING
   ---------------------------------------------------------- */

/* --- Home page featured products --- */
function renderHomeFeatured() {
  var container = document.getElementById('home-featured-products');
  if (!container) return;
  var featured = productData.filter(function(p) {
    return p.featured === 'TRUE' && p.farm_bill_compliant === 'TRUE';
  });
  if (featured.length === 0) {
    container.innerHTML = '<p>No featured products available at this time.</p>';
    return;
  }
  var html = '';
  for (var i = 0; i < featured.length; i++) {
    var p = featured[i];
    var featGrad = getProductGradient(p.product_type, p.product_category);
    var imgClass = p.product_type === 'Extract' ? 'extract-bg' : 'flower-bg';
    html += '<div class="product-card">';
    html += '<div class="product-img ' + imgClass + '">';
    html += '<img src="images/logo.png?v=2" alt="" style="width:80px;opacity:.2;">';
    html += '<span class="product-badge">' + escHtml(p.product_type) + '</span>';
    html += '<span class="product-badge" style="left:auto;right:20px;background:var(--clr-secondary);color:var(--clr-primary);">' + escHtml(p.cultivation_method) + '</span>';
    html += '</div>';
    html += '<div class="product-body">';
    html += '<h3>' + escHtml(p.product_name) + '</h3>';
    html += '<p class="product-meta">' + escHtml(p.sku) + '</p>';
    html += '<p class="product-desc">' + escHtml(p.short_description) + '</p>';
    html += '<p style="font-family:Outfit,sans-serif;font-weight:800;font-size:18px;color:var(--clr-primary);margin-bottom:16px;">From ' + formatCurrency(p.price_per_lb) + '/lb</p>';
    html += '<button class="btn btn-soil" style="width:100%;padding:14px;" onclick="navigate(\'products\')">View Details</button>';
    html += '</div></div>';
  }
  container.innerHTML = html;
}

/* --- Full product catalog --- */
function renderProductCatalog() {
  var container = document.getElementById('product-catalog');
  if (!container) return;
  var html = '';
  for (var i = 0; i < productData.length; i++) {
    var p = productData[i];
    if (p.farm_bill_compliant !== 'TRUE') continue;

    var thcVal = parseFloat(p.delta9_thc_pct) || 0;
    var compliant = thcVal <= 0.3;
    var imgClass = p.product_type === 'Extract' ? 'extract-bg' : 'flower-bg';
    var perProductImgStyle = p.product_img_size ? ' style="height:' + parseInt(p.product_img_size) + 'px;"' : '';

    html += '<div class="product-card">';

    /* Compliance alert */
    if (!compliant) {
      html += '<div style="background:var(--barn-red);color:#fff;padding:10px 20px;font-weight:700;font-size:13px;font-family:Outfit,sans-serif;letter-spacing:.05em;">COMPLIANCE ALERT — &Delta;9-THC exceeds 0.3%</div>';
    }

    /* Image */
    html += '<div class="product-img ' + imgClass + '"' + perProductImgStyle + '>';
    html += '<img src="images/logo.png?v=2" alt="" style="width:80px;opacity:.2;">';
    html += '<span class="product-badge">' + escHtml(p.product_type || p.product_category) + '</span>';
    html += '<span class="product-badge" style="left:auto;right:20px;background:var(--clr-secondary);color:var(--clr-primary);">' + escHtml(p.cultivation_method) + '</span>';
    if (p.featured === 'TRUE') html += '<span class="product-badge" style="top:auto;bottom:20px;background:var(--clr-secondary);color:var(--clr-primary);">Featured</span>';
    html += '</div>';

    html += '<div class="product-body">';

    /* Name & meta */
    html += '<h3>' + escHtml(p.product_name) + '</h3>';
    html += '<p class="product-meta">' + escHtml(p.sku) + ' &middot; ' + escHtml(p.cultivation_method) + ' &middot; Harvest: ' + formatDate(p.harvest_date) + '</p>';

    /* Cannabinoid badges */
    html += '<div class="product-badges">';
    var thcBadge = compliant ? 'safety-pass' : 'safety-fail';
    html += '<span class="safety-badge ' + thcBadge + '">&Delta;9 THC ' + p.delta9_thc_pct + '%</span>';
    if (p.thca_pct) html += '<span class="safety-badge" style="background:#EEF2FF;color:#4338CA;">THCA ' + p.thca_pct + '%</span>';
    if (p.cbd_pct) html += '<span class="safety-badge" style="background:#ECFDF5;color:#065F46;">CBD ' + p.cbd_pct + '%</span>';
    if (p.total_cannabinoids_pct) html += '<span class="safety-badge" style="background:#F3F4F6;color:#374151;">Total ' + p.total_cannabinoids_pct + '%</span>';
    html += '</div>';

    /* Terpenes */
    if (p.terpene_1_name) {
      html += '<p class="product-terpenes"><strong>Terpenes:</strong> ';
      html += escHtml(p.terpene_1_name) + ' ' + p.terpene_1_pct + '%';
      if (p.terpene_2_name) html += ', ' + escHtml(p.terpene_2_name) + ' ' + p.terpene_2_pct + '%';
      if (p.terpene_3_name) html += ', ' + escHtml(p.terpene_3_name) + ' ' + p.terpene_3_pct + '%';
      if (p.total_terpenes_pct) html += ' &middot; Total: ' + p.total_terpenes_pct + '%';
      html += '</p>';
    }

    /* Description — controlled by admin display settings */
    var dMode = catalogDisplaySettings.descMode;
    if (dMode === 'short' && p.short_description) {
      html += '<p class="product-desc">' + escHtml(p.short_description) + '</p>';
    } else if (dMode === 'long' && p.long_description) {
      html += '<p class="product-desc">' + escHtml(p.long_description) + '</p>';
    } else if (dMode === 'both') {
      if (p.short_description) html += '<p class="product-desc">' + escHtml(p.short_description) + '</p>';
      if (p.long_description) {
        html += '<div class="product-long-desc">' + escHtml(p.long_description) + '</div>';
        html += '<button class="product-desc-toggle" onclick="toggleLongDesc(this)">Read more</button>';
      }
    }
    /* dMode === 'none': skip description entirely */

    /* Appearance & Aroma */
    if (p.appearance) html += '<p class="product-details"><strong>Appearance:</strong> ' + escHtml(p.appearance) + '</p>';
    if (p.aroma_profile) html += '<p class="product-details"><strong>Aroma:</strong> ' + escHtml(p.aroma_profile) + '</p>';

    /* Price tiers */
    html += '<div class="product-prices">';
    if (p.price_per_lb) html += '<span class="price-tag">' + formatCurrency(p.price_per_lb) + '/lb</span>';
    if (p.price_5lb) html += '<span class="price-tag">' + formatCurrency(p.price_5lb) + '/5lb</span>';
    if (p.price_10lb) html += '<span class="price-tag">' + formatCurrency(p.price_10lb) + '/10lb</span>';
    if (p.min_order_lbs) html += '<span class="price-tag">Min: ' + p.min_order_lbs + ' lb</span>';
    html += '</div>';

    /* Inventory */
    if (p.inventory_lbs_available) {
      var invLabel = p.inventory_status === 'in_stock' ? 'In Stock' : (p.inventory_status || 'Unknown');
      var invBadge = parseFloat(p.inventory_lbs_available) > 0 ? 'safety-pass' : 'safety-fail';
      html += '<p class="product-details"><strong>Inventory:</strong> ' + parseFloat(p.inventory_lbs_available).toFixed(0) + ' lbs &mdash; <span class="safety-badge ' + invBadge + '">' + invLabel + '</span></p>';
    }

    /* Compliance statement */
    if (p.compliance_statement) {
      html += '<p class="product-compliance">' + escHtml(p.compliance_statement) + '</p>';
    }

    /* Safety test badges */
    var tests = [
      { key: 'heavy_metals_pass', label: 'Heavy Metals' },
      { key: 'pesticides_pass', label: 'Pesticides' },
      { key: 'microbials_pass', label: 'Microbials' },
      { key: 'mycotoxins_pass', label: 'Mycotoxins' },
      { key: 'residual_solvents_pass', label: 'Residual Solvents' },
      { key: 'foreign_matter_pass', label: 'Foreign Matter' }
    ];
    html += '<div class="product-safety">';
    for (var t = 0; t < tests.length; t++) {
      var pass = p[tests[t].key] === 'TRUE';
      var badgeClass = pass ? 'safety-pass' : 'safety-fail';
      var tIcon = pass ? '&#10003;' : '&#10007;';
      html += '<span class="safety-badge ' + badgeClass + '">' + tIcon + ' ' + tests[t].label + '</span>';
    }
    html += '</div>';

    /* Action buttons */
    html += '<div class="product-actions">';
    html += '<button class="btn btn-soil" onclick="navigate(\'compliance\')">View COA</button>';
    html += '<button class="btn" style="border:2px solid var(--clr-primary);color:var(--clr-primary);background:#fff;" onclick="requestInvoice(\'' + escAttr(p.sku) + '\')">Request Invoice</button>';
    html += '</div>';

    html += '</div></div>';
  }
  container.innerHTML = html;
}

/* ----------------------------------------------------------
   6. COA TABLE
   ---------------------------------------------------------- */
function renderCOATable() {
  var container = document.getElementById('coa-table-container');
  if (!container) return;
  var html = '<table style="width:100%;border-collapse:collapse;font-size:.85rem;">';
  html += '<thead><tr style="background:#f3f4f6;text-align:left;">';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">Product</th>';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">SKU</th>';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">Batch #</th>';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">Lab (Accreditation)</th>';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">Test Date</th>';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">&Delta;9 THC</th>';
  html += '<th style="padding:10px 12px;border-bottom:2px solid #d1d5db;">COA</th>';
  html += '</tr></thead><tbody>';

  for (var i = 0; i < productData.length; i++) {
    var p = productData[i];
    if (p.farm_bill_compliant !== 'TRUE') continue;
    var thcVal = parseFloat(p.delta9_thc_pct) || 0;
    var thcClass = thcVal <= 0.3 ? 'thc-pass' : 'thc-fail';
    var thcColor = thcVal <= 0.3 ? '#16a34a' : '#b91c1c';
    var thcIcon = thcVal <= 0.3 ? '&#10003;' : '&#10007;';
    html += '<tr style="border-bottom:1px solid #e5e7eb;">';
    html += '<td style="padding:10px 12px;">' + escHtml(p.product_name) + '</td>';
    html += '<td style="padding:10px 12px;">' + escHtml(p.sku) + '</td>';
    html += '<td style="padding:10px 12px;">' + escHtml(p.coa_batch_number) + '</td>';
    html += '<td style="padding:10px 12px;">' + escHtml(p.coa_lab_name) + ' (' + escHtml(p.coa_lab_accreditation) + ')</td>';
    html += '<td style="padding:10px 12px;">' + formatDate(p.coa_test_date) + '</td>';
    html += '<td style="padding:10px 12px;color:' + thcColor + ';font-weight:600;" class="' + thcClass + '">' + p.delta9_thc_pct + '% ' + thcIcon + '</td>';
    html += '<td style="padding:10px 12px;"><a href="#" style="color:#2d5016;text-decoration:none;">&#128229; Download</a></td>';
    html += '</tr>';
  }

  html += '</tbody></table>';
  container.innerHTML = html;
}

/* ----------------------------------------------------------
   Chain of Custody
   ---------------------------------------------------------- */
function renderChainOfCustody() {
  var container = document.getElementById('coc-info');
  if (!container) return;
  var html = '';
  for (var i = 0; i < productData.length; i++) {
    var p = productData[i];
    if (p.farm_bill_compliant !== 'TRUE') continue;
    if (!p.coc_cultivation_origin) continue;
    html += '<div style="border:1px solid #e5e5e5;border-radius:8px;padding:1rem;margin-bottom:1rem;background:#fafafa;">';
    html += '<h4 style="margin:0 0 .5rem;color:#2d5016;">' + escHtml(p.product_name) + ' <span style="font-weight:400;font-size:.8rem;color:#666;">(' + escHtml(p.sku) + ')</span></h4>';
    html += '<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;font-size:.85rem;">';
    html += '<div><strong>Cultivation Origin:</strong><br>' + escHtml(p.coc_cultivation_origin) + '</div>';
    if (p.coc_processor) html += '<div><strong>Processor:</strong><br>' + escHtml(p.coc_processor) + '</div>';
    if (p.coc_handler) html += '<div><strong>Handler:</strong><br>' + escHtml(p.coc_handler) + '</div>';
    if (p.coc_storage_facility) html += '<div><strong>Storage Facility:</strong><br>' + escHtml(p.coc_storage_facility) + '</div>';
    if (p.coc_last_audit_date) html += '<div><strong>Last Audit Date:</strong><br>' + formatDate(p.coc_last_audit_date) + '</div>';
    html += '</div></div>';
  }
  container.innerHTML = html || '<p>No chain of custody data available.</p>';
}

/* ----------------------------------------------------------
   7. RESTRICTED STATES
   ---------------------------------------------------------- */
function renderRestrictedStates() {
  var container = document.getElementById('restricted-states-tags');
  if (!container) return;
  var stateNames = {
    AL:'Alabama',AK:'Alaska',AZ:'Arizona',AR:'Arkansas',CA:'California',
    CO:'Colorado',CT:'Connecticut',DE:'Delaware',FL:'Florida',GA:'Georgia',
    HI:'Hawaii',ID:'Idaho',IL:'Illinois',IN:'Indiana',IA:'Iowa',KS:'Kansas',
    KY:'Kentucky',LA:'Louisiana',ME:'Maine',MD:'Maryland',MA:'Massachusetts',
    MI:'Michigan',MN:'Minnesota',MS:'Mississippi',MO:'Missouri',MT:'Montana',
    NE:'Nebraska',NV:'Nevada',NH:'New Hampshire',NJ:'New Jersey',NM:'New Mexico',
    NY:'New York',NC:'North Carolina',ND:'North Dakota',OH:'Ohio',OK:'Oklahoma',
    OR:'Oregon',PA:'Pennsylvania',RI:'Rhode Island',SC:'South Carolina',
    SD:'South Dakota',TN:'Tennessee',TX:'Texas',UT:'Utah',VT:'Vermont',
    VA:'Virginia',WA:'Washington',WV:'West Virginia',WI:'Wisconsin',WY:'Wyoming',
    DC:'District of Columbia'
  };
  var sorted = Array.from(restrictedStatesSet).sort();
  var html = '';
  for (var i = 0; i < sorted.length; i++) {
    var code = sorted[i];
    var name = stateNames[code] || code;
    html += '<span style="display:inline-block;background:#b91c1c;color:#fff;padding:4px 12px;border-radius:14px;font-size:.8rem;margin:3px 4px;">' + escHtml(name) + ' (' + code + ')</span>';
  }
  container.innerHTML = html || '<p>No restricted states listed.</p>';
}

/* ----------------------------------------------------------
   8. PRODUCT INTEREST CHECKBOXES (Apply Form)
   ---------------------------------------------------------- */
function renderProductInterestChecks() {
  var container = document.getElementById('product-interest-checks');
  if (!container) return;
  var html = '';
  for (var i = 0; i < productData.length; i++) {
    var p = productData[i];
    if (p.farm_bill_compliant !== 'TRUE') continue;
    html += '<label style="display:block;margin-bottom:6px;font-size:.9rem;">';
    html += '<input type="checkbox" name="product_interest" value="' + escAttr(p.sku) + '" style="margin-right:8px;">';
    html += escHtml(p.product_name) + ' (' + escHtml(p.sku) + ') &mdash; from ' + formatCurrency(p.price_per_lb) + '/lb';
    html += '</label>';
  }
  container.innerHTML = html || '<p>Products loading...</p>';
}

/* ----------------------------------------------------------
   9. INVITATION CODE VALIDATION
   ---------------------------------------------------------- */
function validateInviteCode() {
  var input = document.getElementById('invite-code-input');
  if (!input) return;
  var code = input.value.trim().toUpperCase();
  var pattern = /^HLF-INV-[A-Z0-9]{4}$/;
  if (pattern.test(code)) {
    var gate = document.getElementById('invitation-gate');
    var form = document.getElementById('application-form');
    if (gate) gate.style.display = 'none';
    if (form) form.style.display = 'block';
    var codeField = document.getElementById('app-invite-code');
    if (codeField) {
      codeField.value = code;
      codeField.readOnly = true;
    }
    var ref = sessionStorage.getItem('inviteRef');
    if (ref) {
      var refField = document.getElementById('app-invited-by');
      if (refField) refField.value = ref;
    }
  } else {
    alert('Invalid invitation code. Codes follow the format: HLF-INV-XXXX');
  }
}

function validateProductsInvite() {
  var input = document.getElementById('products-invite-input');
  var err = document.getElementById('products-invite-error');
  if (!input) return;
  var code = input.value.trim().toUpperCase();
  var pattern = /^HLF-INV-[A-Z0-9]{4}$/;
  if (pattern.test(code)) {
    if (err) err.style.display = 'none';
    sessionStorage.setItem('inviteCode', code);
    var wall = document.getElementById('products-wall');
    var catalog = document.getElementById('products-catalog-section');
    if (wall) wall.style.display = 'none';
    if (catalog) catalog.style.display = 'block';
  } else {
    if (err) err.style.display = 'block';
  }
}

function validateMembershipInvite() {
  var input = document.getElementById('membership-invite-input');
  var err = document.getElementById('membership-invite-error');
  if (!input) return;
  var code = input.value.trim().toUpperCase();
  var pattern = /^HLF-INV-[A-Z0-9]{4}$/;
  if (pattern.test(code)) {
    if (err) err.style.display = 'none';
    sessionStorage.setItem('inviteCode', code);
    var gate = document.getElementById('membership-invite-gate');
    var content = document.getElementById('membership-content');
    if (gate) gate.style.display = 'none';
    if (content) content.style.display = 'block';
  } else {
    if (err) err.style.display = 'block';
  }
}

function validateInvitePageCode() {
  var input = document.getElementById('invite-page-input');
  var err = document.getElementById('invite-page-error');
  if (!input) return;
  var code = input.value.trim().toUpperCase();
  var pattern = /^HLF-INV-[A-Z0-9]{4}$/;
  if (pattern.test(code)) {
    if (err) err.style.display = 'none';
    sessionStorage.setItem('inviteCode', code);
    navigate('apply');
  } else {
    if (err) err.style.display = 'block';
  }
}

function autoFillInviteCode() {
  var stored = sessionStorage.getItem('inviteCode');
  if (stored) {
    var input = document.getElementById('invite-code-input');
    if (input) {
      input.value = stored;
      validateInviteCode();
    }
  }
}

/* ----------------------------------------------------------
   10. APPLICATION FORM
   ---------------------------------------------------------- */
function submitApplication() {
  /* Required text fields — match actual HTML form IDs */
  var requiredFields = [
    'app-name', 'app-business', 'app-email', 'app-phone',
    'app-street', 'app-city', 'app-state', 'app-zip',
    'app-invite-code', 'app-invited-by'
  ];
  for (var i = 0; i < requiredFields.length; i++) {
    var el = document.getElementById(requiredFields[i]);
    if (!el || !el.value.trim()) {
      alert('Please complete all required fields. Missing: ' + requiredFields[i].replace('app-', '').replace(/-/g, ' '));
      if (el) el.focus();
      return;
    }
  }

  /* Validate the 9 required agreement checkboxes */
  var agreeIds = ['agree-age','agree-terms','agree-disclaimer','agree-privacy','agree-compliance','agree-app-fee','agree-monthly-fee','agree-no-refunds','agree-no-minors'];
  for (var c = 0; c < agreeIds.length; c++) {
    var cb = document.getElementById(agreeIds[c]);
    if (!cb || !cb.checked) {
      alert('You must agree to all terms and conditions before submitting. Please check: ' + agreeIds[c].replace('agree-', '').replace(/-/g, ' '));
      if (cb) cb.focus();
      return;
    }
  }

  /* State restriction check */
  var stateEl = document.getElementById('app-state');
  var selectedState = stateEl ? stateEl.value.trim().toUpperCase() : '';
  if (restrictedStatesSet.has(selectedState)) {
    var warning = document.getElementById('state-warning');
    if (warning) {
      warning.style.display = 'block';
      warning.textContent = 'We cannot accept applications from ' + selectedState + '. This state has restrictions on hemp products.';
    }
    alert('We cannot accept applications from restricted states (' + selectedState + ').');
    return;
  }

  /* Generate application reference */
  var refNum = 'HLF-APP-' + Math.floor(1000 + Math.random() * 9000);

  /* Store in session */
  sessionStorage.setItem('appReference', refNum);
  sessionStorage.setItem('appName', document.getElementById('app-name').value);
  sessionStorage.setItem('appEmail', document.getElementById('app-email').value);
  sessionStorage.setItem('appBusiness', document.getElementById('app-business').value);

  /* Update ref number displays in payment instructions */
  var refSpans = ['app-ref','pay-ref-ach','pay-ref-cash','pay-ref-zelle','pay-ref-mo'];
  for (var r = 0; r < refSpans.length; r++) {
    var span = document.getElementById(refSpans[r]);
    if (span) span.textContent = refNum;
  }

  /* Add to admin members list as pending */
  adminMembers.push({
    id: 'MEM-' + String(Math.floor(100 + Math.random() * 900)),
    name: document.getElementById('app-name').value,
    business: document.getElementById('app-business').value,
    email: document.getElementById('app-email').value,
    state: selectedState,
    inviteCode: document.getElementById('app-invite-code').value,
    applied: new Date().toISOString().slice(0,10),
    status: 'pending',
    appFeePaid: false,
    monthlyActive: false
  });

  /* Show payment instructions, hide form */
  var form = document.getElementById('application-form');
  var payment = document.getElementById('payment-instructions');
  if (form) form.style.display = 'none';
  if (payment) payment.style.display = 'block';

  window.scrollTo(0, 0);
}

/* Billing / shipping toggle */
function toggleShippingFields() {
  var cb = document.getElementById('app-billing-same');
  var shippingDiv = document.getElementById('shipping-fields');
  if (!cb || !shippingDiv) return;
  shippingDiv.style.display = cb.checked ? 'none' : 'block';
}

/* State restriction live check on dropdown change */
function checkStateRestriction() {
  var stateEl = document.getElementById('app-state');
  var warning = document.getElementById('state-warning');
  if (!stateEl || !warning) return;
  var val = stateEl.value.trim().toUpperCase();
  /* Use hard-coded list + any from products */
  var blocked = RESTRICTED_STATES.indexOf(val) !== -1 || restrictedStatesSet.has(val);
  if (val && blocked) {
    warning.style.display = 'block';
    var submitBtn = document.querySelector('#application-form .btn-primary');
    if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Application Blocked — Restricted State'; }
  } else {
    warning.style.display = 'none';
    var submitBtn2 = document.querySelector('#application-form .btn-primary');
    if (submitBtn2) { submitBtn2.disabled = false; submitBtn2.textContent = 'Submit Application & View Payment Instructions'; }
  }
}

/* ----------------------------------------------------------
   11. MEMBER LOGIN
   ---------------------------------------------------------- */
function memberLogin() {
  var email = document.getElementById('login-email');
  var password = document.getElementById('login-password');
  if (!email || !password) return;
  var e = email.value.trim();
  var p = password.value;

  /* Admin login */
  if (e === 'admin@hemplifefarmers.com' && p === 'admin2025') {
    sessionStorage.setItem('memberLoggedIn', 'true');
    sessionStorage.setItem('isAdmin', 'true');
    sessionStorage.setItem('memberName', 'Admin');
    sessionStorage.setItem('memberEmail', e);
    sessionStorage.setItem('memberSince', '2024-01-01');
    sessionStorage.setItem('memberStatus', 'active');
    sessionStorage.setItem('personalRefCode', 'HLF-INV-ADMIN');
    updateNavForMember();
    navigate('admin');
    return;
  }
  /* Member login */
  if (e === 'demo@hemplifefarmers.com' && p === 'demo2025') {
    sessionStorage.setItem('memberLoggedIn', 'true');
    sessionStorage.removeItem('isAdmin');
    sessionStorage.setItem('memberName', 'Demo Member');
    sessionStorage.setItem('memberEmail', e);
    sessionStorage.setItem('memberSince', '2025-01-15');
    sessionStorage.setItem('memberStatus', 'active');
    sessionStorage.setItem('personalRefCode', 'HLF-INV-DEMO');
    updateNavForMember();
    navigate('dashboard');
    return;
  }
  alert('Invalid credentials.\n\nDemo: demo@hemplifefarmers.com / demo2025\nAdmin: admin@hemplifefarmers.com / admin2025');
}

function updateNavForMember() {
  var loginLink = document.getElementById('nav-login-link');
  if (!loginLink) return;
  if (sessionStorage.getItem('memberLoggedIn')) {
    var isAdmin = sessionStorage.getItem('isAdmin');
    if (isAdmin) {
      loginLink.textContent = 'Admin';
      loginLink.setAttribute('onclick', "navigate('admin')");
    } else {
      loginLink.textContent = 'My Account';
      loginLink.setAttribute('onclick', "navigate('dashboard')");
    }
    var mobileLoginLink = document.getElementById('mobile-login-link');
    if (mobileLoginLink) {
      if (isAdmin) {
        mobileLoginLink.textContent = 'Admin';
        mobileLoginLink.setAttribute('onclick', "navigate('admin'); closeMobileMenu();");
      } else {
        mobileLoginLink.textContent = 'My Account';
        mobileLoginLink.setAttribute('onclick', "navigate('dashboard'); closeMobileMenu();");
      }
    }
  }
}

function memberLogout() {
  sessionStorage.removeItem('memberLoggedIn');
  sessionStorage.removeItem('isAdmin');
  sessionStorage.removeItem('memberName');
  sessionStorage.removeItem('memberEmail');
  sessionStorage.removeItem('memberSince');
  sessionStorage.removeItem('memberStatus');
  sessionStorage.removeItem('personalRefCode');

  var loginLink = document.getElementById('nav-login-link');
  if (loginLink) {
    loginLink.textContent = 'Login';
    loginLink.setAttribute('onclick', "navigate('login')");
  }
  var mobileLoginLink = document.getElementById('mobile-login-link');
  if (mobileLoginLink) {
    mobileLoginLink.textContent = 'Login';
    mobileLoginLink.setAttribute('onclick', "navigate('login'); closeMobileMenu();");
  }
  navigate('home');
}

/* ----------------------------------------------------------
   12. DASHBOARD
   ---------------------------------------------------------- */
function switchDashTab(tabName, btn) {
  var tabs = document.querySelectorAll('#page-dashboard .dash-tab-content');
  for (var i = 0; i < tabs.length; i++) {
    tabs[i].style.display = 'none';
  }
  var target = document.getElementById('tab-' + tabName);
  if (target) target.style.display = 'block';

  var btns = document.querySelectorAll('#page-dashboard .dash-tab-btn');
  for (var j = 0; j < btns.length; j++) {
    btns[j].classList.remove('active');
  }
  if (btn) btn.classList.add('active');
}

function populateDashboard() {
  /* Member info — use correct HTML element IDs */
  var nameEl = document.getElementById('member-name-display');
  if (nameEl) nameEl.textContent = sessionStorage.getItem('memberName') || 'Member';

  var sinceEl = document.getElementById('dash-since');
  if (sinceEl) sinceEl.textContent = formatDate(sessionStorage.getItem('memberSince'));

  var statusEl = document.getElementById('dash-status');
  if (statusEl) {
    var status = sessionStorage.getItem('memberStatus') || 'active';
    statusEl.textContent = status.charAt(0).toUpperCase() + status.slice(1);
    statusEl.className = status === 'active' ? 'status-active' : 'status-suspended';
  }

  /* Demo order history */
  var ordersBody = document.getElementById('orders-tbody');
  if (ordersBody) {
    var orders = [
      { id: 'ORD-2025-0042', date: '2025-11-15', items: 'Premium THCA Hemp Flower (5 lbs)', total: '$8,250.00', status: 'Delivered' },
      { id: 'ORD-2025-0038', date: '2025-10-28', items: 'CBD Hemp Flower (10 lbs)', total: '$5,000.00', status: 'Delivered' },
      { id: 'ORD-2025-0051', date: '2025-12-01', items: 'THCA Flower Greenhouse (2 lbs)', total: '$2,400.00', status: 'Processing' }
    ];
    var html = '';
    for (var o = 0; o < orders.length; o++) {
      var ord = orders[o];
      var sColor = ord.status === 'Delivered' ? '#16a34a' : '#d97706';
      html += '<tr style="border-bottom:1px solid #e5e7eb;">';
      html += '<td style="padding:10px 12px;">' + ord.id + '</td>';
      html += '<td style="padding:10px 12px;">' + formatDate(ord.date) + '</td>';
      html += '<td style="padding:10px 12px;">' + ord.items + '</td>';
      html += '<td style="padding:10px 12px;">' + ord.total + '</td>';
      html += '<td style="padding:10px 12px;color:' + sColor + ';font-weight:600;">' + ord.status + '</td>';
      html += '</tr>';
    }
    ordersBody.innerHTML = html;
  }

  /* Demo billing history */
  var billingBody = document.getElementById('billing-tbody');
  if (billingBody) {
    var billing = [
      { date: '2025-01-15', desc: 'Membership Application Fee', amount: '$100.00', status: 'Paid' },
      { date: '2025-02-15', desc: 'Monthly Membership Fee', amount: '$50.00', status: 'Paid' },
      { date: '2025-03-15', desc: 'Monthly Membership Fee', amount: '$50.00', status: 'Paid' }
    ];
    var bHtml = '';
    for (var b = 0; b < billing.length; b++) {
      var bill = billing[b];
      bHtml += '<tr style="border-bottom:1px solid #e5e7eb;">';
      bHtml += '<td style="padding:10px 12px;">' + formatDate(bill.date) + '</td>';
      bHtml += '<td style="padding:10px 12px;">' + bill.desc + '</td>';
      bHtml += '<td style="padding:10px 12px;">' + bill.amount + '</td>';
      bHtml += '<td style="padding:10px 12px;color:#16a34a;font-weight:600;">' + bill.status + '</td>';
      bHtml += '</tr>';
    }
    billingBody.innerHTML = bHtml;
  }

  /* Referral link */
  var refLinkEl = document.getElementById('referral-link-text');
  if (refLinkEl) {
    var personalCode = sessionStorage.getItem('personalRefCode') || 'HLF-INV-0000';
    var memberName = sessionStorage.getItem('memberName') || 'Member';
    var baseUrl = window.location.origin + window.location.pathname;
    refLinkEl.textContent = baseUrl + '?invite=' + personalCode + '&ref=' + encodeURIComponent(memberName);
  }

  /* Invitation codes table */
  var invBody = document.getElementById('invite-codes-tbody');
  if (invBody) {
    var codes = [
      { code: 'HLF-INV-7291', created: '2025-11-01', sentTo: 'john@example.com', status: 'Used', usedBy: 'John Doe' },
      { code: 'HLF-INV-8834', created: '2025-11-15', sentTo: 'jane@retailshop.com', status: 'Pending', usedBy: '—' },
      { code: 'HLF-INV-4502', created: '2025-12-01', sentTo: '—', status: 'Available', usedBy: '—' }
    ];
    var iHtml = '';
    for (var ic = 0; ic < codes.length; ic++) {
      var inv = codes[ic];
      var icColor = inv.status === 'Used' ? '#16a34a' : (inv.status === 'Pending' ? '#d97706' : '#2563eb');
      iHtml += '<tr style="border-bottom:1px solid #e5e7eb;">';
      iHtml += '<td style="padding:10px 12px;font-family:monospace;">' + inv.code + '</td>';
      iHtml += '<td style="padding:10px 12px;">' + formatDate(inv.created) + '</td>';
      iHtml += '<td style="padding:10px 12px;">' + inv.sentTo + '</td>';
      iHtml += '<td style="padding:10px 12px;color:' + icColor + ';font-weight:600;">' + inv.status + '</td>';
      iHtml += '<td style="padding:10px 12px;">' + inv.usedBy + '</td>';
      iHtml += '</tr>';
    }
    invBody.innerHTML = iHtml;
  }
}

/* Generate new invitation code */
function generateInviteCode() {
  var code = 'HLF-INV-' + Math.floor(1000 + Math.random() * 9000);
  var invBody = document.getElementById('invite-codes-tbody');
  if (invBody) {
    var today = new Date().toISOString().slice(0, 10);
    var newRow = '<tr style="border-bottom:1px solid #e5e7eb;background:#f0fdf4;">';
    newRow += '<td style="padding:10px 12px;font-family:monospace;">' + code + '</td>';
    newRow += '<td style="padding:10px 12px;">' + formatDate(today) + '</td>';
    newRow += '<td style="padding:10px 12px;">&mdash;</td>';
    newRow += '<td style="padding:10px 12px;color:#2563eb;font-weight:600;">Available</td>';
    newRow += '<td style="padding:10px 12px;">&mdash;</td>';
    newRow += '</tr>';
    invBody.insertAdjacentHTML('beforeend', newRow);
  }
  alert('New invitation code generated: ' + code);
}

/* Copy referral link */
function copyReferralLink() {
  var linkEl = document.getElementById('referral-link-text');
  if (!linkEl) return;
  var link = linkEl.textContent;
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(link).then(function() {
      showCopyFeedback();
    }).catch(function() {
      fallbackCopy(link);
    });
  } else {
    fallbackCopy(link);
  }
}

function fallbackCopy(text) {
  var ta = document.createElement('textarea');
  ta.value = text;
  ta.style.position = 'fixed';
  ta.style.left = '-9999px';
  document.body.appendChild(ta);
  ta.select();
  try {
    document.execCommand('copy');
    showCopyFeedback();
  } catch(e) {
    alert('Please copy the link manually.');
  }
  document.body.removeChild(ta);
}

function showCopyFeedback() {
  var btn = document.getElementById('copy-referral-btn');
  if (btn) {
    var orig = btn.textContent;
    btn.textContent = 'Copied!';
    btn.style.background = '#16a34a';
    setTimeout(function() {
      btn.textContent = orig;
      btn.style.background = '';
    }, 2000);
  }
}

/* Cancel membership */
function cancelMembership() {
  if (confirm('Are you sure? This will revoke wholesale access immediately. No refunds will be issued. You will need to re-apply with a new $100 fee to rejoin.')) {
    alert('Membership cancellation request submitted. You will receive confirmation via email.');
    memberLogout();
  }
}

/* ----------------------------------------------------------
   13. ADMIN CSV UPLOAD
   ---------------------------------------------------------- */
function handleCSVUpload(event) {
  var file = event.target.files[0];
  if (!file) return;
  if (!file.name.endsWith('.csv')) {
    alert('Please upload a .csv file');
    return;
  }
  if (file.size > 5 * 1024 * 1024) {
    alert('File must be under 5MB');
    return;
  }

  /* Reset previous results */
  var preview = document.getElementById('csv-preview');
  var validation = document.getElementById('csv-validation');
  var results = document.getElementById('csv-results');
  if (preview) preview.style.display = 'none';
  if (validation) validation.style.display = 'none';
  if (results) results.style.display = 'none';

  var reader = new FileReader();
  reader.onload = function(e) {
    var text = e.target.result;
    var data = parseCSV(text);
    showCSVPreview(data);
    validateCSVData(data);
  };
  reader.readAsText(file);
}

function showCSVPreview(data) {
  var container = document.getElementById('csv-preview');
  if (!container) return;
  container.style.display = 'block';

  var previewCount = Math.min(data.length, 5);
  if (data.length === 0) {
    container.innerHTML = '<p>No data rows found in CSV.</p>';
    return;
  }

  var keys = Object.keys(data[0]);
  var displayKeys = keys.slice(0, 8); /* Show first 8 columns in preview */

  var html = '<h3>CSV Preview (' + data.length + ' rows total, showing first ' + previewCount + ')</h3>';
  html += '<div style="overflow-x:auto;">';
  html += '<table style="width:100%;border-collapse:collapse;font-size:.8rem;">';
  html += '<thead><tr style="background:#f3f4f6;">';
  for (var h = 0; h < displayKeys.length; h++) {
    html += '<th style="padding:8px 10px;border-bottom:2px solid #d1d5db;text-align:left;white-space:nowrap;">' + escHtml(displayKeys[h]) + '</th>';
  }
  if (keys.length > displayKeys.length) {
    html += '<th style="padding:8px 10px;border-bottom:2px solid #d1d5db;">... +' + (keys.length - displayKeys.length) + ' cols</th>';
  }
  html += '</tr></thead><tbody>';

  for (var r = 0; r < previewCount; r++) {
    html += '<tr style="border-bottom:1px solid #e5e7eb;">';
    for (var c = 0; c < displayKeys.length; c++) {
      var val = data[r][displayKeys[c]] || '';
      if (val.length > 40) val = val.substring(0, 37) + '...';
      html += '<td style="padding:8px 10px;white-space:nowrap;">' + escHtml(val) + '</td>';
    }
    if (keys.length > displayKeys.length) {
      html += '<td style="padding:8px 10px;color:#999;">...</td>';
    }
    html += '</tr>';
  }

  html += '</tbody></table></div>';
  container.innerHTML = html;
}

function validateCSVData(data) {
  var blocks = [];
  var warnings = [];
  var seenSkus = {};

  for (var i = 0; i < data.length; i++) {
    var row = data[i];
    var rowLabel = 'Row ' + (i + 1) + ' (' + (row.sku || 'unknown') + ')';

    /* --- BLOCKS --- */

    /* Compliance: THC */
    var thc = parseFloat(row.delta9_thc_pct);
    if (!isNaN(thc) && thc > 0.3) {
      blocks.push(rowLabel + ': COMPLIANCE VIOLATION — Delta-9 THC ' + row.delta9_thc_pct + '% exceeds 0.3% limit');
    }

    /* Farm Bill compliance flag */
    if (row.farm_bill_compliant !== 'TRUE') {
      blocks.push(rowLabel + ': farm_bill_compliant is not TRUE');
    }

    /* Required fields */
    var required = [
      'sku','product_name','product_type','product_category',
      'delta9_thc_pct','coa_batch_number','coa_test_date',
      'coa_lab_name','coa_lab_accreditation','coa_pdf_filename',
      'short_description','compliance_statement','restricted_states'
    ];
    for (var rf = 0; rf < required.length; rf++) {
      if (!row[required[rf]] || row[required[rf]].trim() === '') {
        blocks.push(rowLabel + ': Missing required field "' + required[rf] + '"');
      }
    }

    /* Duplicate SKU check */
    if (row.sku) {
      if (seenSkus[row.sku]) {
        blocks.push('Duplicate SKU: ' + row.sku);
      }
      seenSkus[row.sku] = true;
    }

    /* --- WARNINGS --- */

    /* Safety test failures */
    var safetyTests = [
      'heavy_metals_pass','pesticides_pass','microbials_pass',
      'mycotoxins_pass','residual_solvents_pass','foreign_matter_pass'
    ];
    for (var st = 0; st < safetyTests.length; st++) {
      if (row[safetyTests[st]] === 'FALSE') {
        warnings.push(rowLabel + ': Safety test "' + safetyTests[st] + '" is FALSE');
      }
    }

    /* COA date age */
    if (row.coa_test_date) {
      var testDate = new Date(row.coa_test_date);
      if (!isNaN(testDate.getTime())) {
        var daysDiff = (new Date() - testDate) / (1000 * 60 * 60 * 24);
        if (daysDiff > 180) {
          warnings.push(rowLabel + ': COA test date is ' + Math.floor(daysDiff) + ' days old (>180 days)');
        }
      }
    }

    /* Missing price or inventory */
    if (!row.price_per_lb || row.price_per_lb.trim() === '') {
      warnings.push(rowLabel + ': Missing price_per_lb');
    }
    if (!row.inventory_lbs_available || row.inventory_lbs_available.trim() === '') {
      warnings.push(rowLabel + ': Missing inventory data');
    }
  }

  /* Deduplicate blocks */
  var uniqueBlocks = [];
  var blockSet = {};
  for (var ub = 0; ub < blocks.length; ub++) {
    if (!blockSet[blocks[ub]]) {
      uniqueBlocks.push(blocks[ub]);
      blockSet[blocks[ub]] = true;
    }
  }

  renderValidationResults(uniqueBlocks, warnings, data.length);

  /* Store parsed data for potential import */
  window._pendingCSVData = data;
}

function renderValidationResults(blocks, warnings, totalRows) {
  var container = document.getElementById('csv-validation');
  if (!container) return;
  container.style.display = 'block';

  var html = '<h3>Validation Results</h3>';

  if (blocks.length > 0) {
    html += '<div style="background:#fee2e2;border:1px solid #b91c1c;border-radius:8px;padding:1rem;margin-bottom:1rem;">';
    html += '<h4 style="color:#b91c1c;margin:0 0 .5rem;">BLOCKED (' + blocks.length + ' issues)</h4><ul style="margin:0;padding-left:1.25rem;">';
    for (var b = 0; b < blocks.length; b++) {
      html += '<li style="margin-bottom:4px;color:#7f1d1d;">&#10007; ' + escHtml(blocks[b]) + '</li>';
    }
    html += '</ul></div>';
    var importBtn = document.getElementById('csv-import-btn');
    if (importBtn) {
      importBtn.disabled = true;
      importBtn.textContent = 'Import Blocked';
    }
  } else {
    html += '<div style="background:#dcfce7;border:1px solid #16a34a;border-radius:8px;padding:1rem;margin-bottom:1rem;">';
    html += '<p style="color:#166534;margin:0;font-weight:600;">&#10003; No blocking issues found</p>';
    html += '</div>';
    var importBtn2 = document.getElementById('csv-import-btn');
    if (importBtn2) {
      importBtn2.disabled = false;
      importBtn2.textContent = 'Import ' + totalRows + ' Products';
      importBtn2.style.display = 'inline-block';
    }
  }

  if (warnings.length > 0) {
    html += '<div style="background:#fef9c3;border:1px solid #d97706;border-radius:8px;padding:1rem;">';
    html += '<h4 style="color:#92400e;margin:0 0 .5rem;">WARNINGS (' + warnings.length + ')</h4><ul style="margin:0;padding-left:1.25rem;">';
    for (var w = 0; w < warnings.length; w++) {
      html += '<li style="margin-bottom:4px;color:#78350f;">&#9888; ' + escHtml(warnings[w]) + '</li>';
    }
    html += '</ul></div>';
  }

  container.innerHTML = html;
}

function importCSVProducts() {
  if (!window._pendingCSVData || window._pendingCSVData.length === 0) {
    alert('No CSV data to import. Please upload a file first.');
    return;
  }
  productData = window._pendingCSVData;
  renderAllProductViews();
  renderAdminProducts();

  var resultsContainer = document.getElementById('csv-results');
  if (resultsContainer) {
    resultsContainer.style.display = 'block';
    resultsContainer.innerHTML = '<div style="background:#dcfce7;border:1px solid #16a34a;border-radius:8px;padding:1rem;">' +
      '<p style="color:#166534;margin:0;font-weight:600;">&#10003; Imported ' + productData.length + ' products successfully. All views updated.</p>' +
      '</div>';
  }

  window._pendingCSVData = null;
}

/* ----------------------------------------------------------
   14. MOBILE MENU
   ---------------------------------------------------------- */
function toggleMobileMenu() {
  var menu = document.getElementById('mobile-menu');
  if (menu) {
    menu.classList.toggle('open');
  }
}

function closeMobileMenu() {
  var menu = document.getElementById('mobile-menu');
  if (menu) {
    menu.classList.remove('open');
  }
}

/* ----------------------------------------------------------
   15. CONTACT FORM
   ---------------------------------------------------------- */
function submitContactForm() {
  var requiredFields = ['contact-name', 'contact-email', 'contact-type', 'contact-message'];
  for (var i = 0; i < requiredFields.length; i++) {
    var el = document.getElementById(requiredFields[i]);
    if (!el || !el.value.trim()) {
      alert('Please fill in all required fields.');
      if (el) el.focus();
      return;
    }
  }

  /* Validate email format */
  var emailEl = document.getElementById('contact-email');
  var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(emailEl.value.trim())) {
    alert('Please enter a valid email address.');
    emailEl.focus();
    return;
  }

  /* Check required agreement checkboxes */
  var checkboxes = document.querySelectorAll('#page-contact input[type="checkbox"][required]');
  for (var c = 0; c < checkboxes.length; c++) {
    if (!checkboxes[c].checked) {
      alert('Please agree to the required terms before submitting.');
      checkboxes[c].focus();
      return;
    }
  }

  navigate('thankyou');
}

/* ----------------------------------------------------------
   16. INITIALIZATION
   ---------------------------------------------------------- */
document.addEventListener('DOMContentLoaded', function() {
  /* Age verification gate */
  checkAge();

  /* Referral / invitation URL parameters */
  checkReferralParams();

  /* Load product data */
  loadProducts();

  /* Hash-based routing on initial load */
  var hash = window.location.hash.replace('#', '');
  if (hash) {
    navigate(hash);
  } else {
    navigate('home');
  }

  /* Restore logged-in state */
  if (sessionStorage.getItem('memberLoggedIn')) {
    updateNavForMember();
  }

  /* Auto-fill invitation code if stored */
  var storedInvite = sessionStorage.getItem('inviteCode');
  if (storedInvite) {
    var input = document.getElementById('invite-code-input');
    if (input) input.value = storedInvite;
  }

  /* Wire up state restriction live check */
  var stateSelect = document.getElementById('app-state');
  if (stateSelect) {
    stateSelect.addEventListener('change', checkStateRestriction);
  }

  /* Wire up billing/shipping toggle */
  var billShipCb = document.getElementById('app-billing-same');
  if (billShipCb) {
    billShipCb.addEventListener('change', toggleShippingFields);
  }
});

/* ----------------------------------------------------------
   17. FALLBACK PRODUCT DATA
   ---------------------------------------------------------- */
function getFallbackProducts() {
  return [
    {
      sku: 'HLF-TF-001',
      product_name: 'Premium THCA Hemp Flower',
      product_type: 'THCA Flower',
      product_category: 'Flower',
      status: 'active',
      cultivation_method: 'Indoor',
      cultivation_location: 'Eastern Shore MD',
      harvest_date: '2025-10-15',
      delta9_thc_pct: '0.18',
      thca_pct: '22.40',
      cbd_pct: '0.85',
      cbg_pct: '0.12',
      cbn_pct: '0.05',
      total_cannabinoids_pct: '23.60',
      terpene_1_name: 'Myrcene', terpene_1_pct: '0.82',
      terpene_2_name: 'Limonene', terpene_2_pct: '0.65',
      terpene_3_name: 'Caryophyllene', terpene_3_pct: '0.48',
      total_terpenes_pct: '2.45',
      appearance: 'Dense trichome-covered buds with vibrant green and purple hues',
      aroma_profile: 'Sweet cherry with earthy pine undertones',
      moisture_content_pct: '9.20',
      trim_type: 'Hand-trimmed',
      density: 'Medium-Dense',
      coa_batch_number: 'BN-TF001-20251101',
      coa_test_date: '2025-11-01',
      coa_lab_name: 'ProVerde Laboratories',
      coa_lab_accreditation: 'ISO 17025',
      coa_pdf_filename: 'HLF-TF-001-COA.pdf',
      heavy_metals_pass: 'TRUE', pesticides_pass: 'TRUE', microbials_pass: 'TRUE',
      mycotoxins_pass: 'TRUE', residual_solvents_pass: 'TRUE', foreign_matter_pass: 'TRUE',
      farm_bill_compliant: 'TRUE',
      price_per_lb: '1800.00', price_5lb: '1650.00', price_10lb: '1500.00',
      min_order_lbs: '1',
      inventory_lbs_available: '85.00', inventory_status: 'in_stock',
      packaging_type: 'Vacuum-sealed mylar', shelf_life_days: '365',
      storage_requirements: 'Cool dry place away from light',
      ships_from_state: 'MD',
      display_order: '1', featured: 'TRUE',
      short_description: 'Premium indoor THCA hemp flower. Dense trichome-rich buds with 22.4% THCA.',
      long_description: 'Our flagship Premium THCA Hemp Flower is cultivated indoors on Maryland Eastern Shore.',
      compliance_statement: 'All Hemp Life Farmers products are derived from hemp and contain \u22640.3% \u03949-THC on a dry-weight basis in compliance with the 2018 Farm Bill.',
      coc_cultivation_origin: 'Eastern Shore MD - Licensed Hemp Farm',
      coc_processor: 'HLF Processing Facility',
      coc_handler: 'Hemp Life Farmers Distribution',
      coc_storage_facility: 'Climate-controlled warehouse - Eastern Shore MD',
      coc_last_audit_date: '2025-10-20',
      restricted_states: 'ID,SD'
    },
    {
      sku: 'HLF-TF-002',
      product_name: 'THCA Hemp Flower \u2014 Greenhouse',
      product_type: 'THCA Flower',
      product_category: 'Flower',
      status: 'active',
      cultivation_method: 'Greenhouse',
      cultivation_location: 'Western MD Highlands',
      harvest_date: '2025-09-28',
      delta9_thc_pct: '0.22',
      thca_pct: '18.60',
      cbd_pct: '1.20',
      cbg_pct: '0.18',
      cbn_pct: '0.03',
      total_cannabinoids_pct: '20.23',
      terpene_1_name: 'Terpinolene', terpene_1_pct: '0.72',
      terpene_2_name: 'Pinene', terpene_2_pct: '0.55',
      terpene_3_name: 'Linalool', terpene_3_pct: '0.38',
      total_terpenes_pct: '1.98',
      appearance: 'Light green dense nugs with orange pistils',
      aroma_profile: 'Citrus-forward with herbal and floral notes',
      moisture_content_pct: '10.10',
      trim_type: 'Machine-trimmed',
      density: 'Medium',
      coa_batch_number: 'BN-TF002-20251015',
      coa_test_date: '2025-10-15',
      coa_lab_name: 'Kaycha Labs',
      coa_lab_accreditation: 'ISO 17025',
      coa_pdf_filename: 'HLF-TF-002-COA.pdf',
      heavy_metals_pass: 'TRUE', pesticides_pass: 'TRUE', microbials_pass: 'TRUE',
      mycotoxins_pass: 'TRUE', residual_solvents_pass: 'TRUE', foreign_matter_pass: 'TRUE',
      farm_bill_compliant: 'TRUE',
      price_per_lb: '1200.00', price_5lb: '1100.00', price_10lb: '1000.00',
      min_order_lbs: '1',
      inventory_lbs_available: '120.00', inventory_status: 'in_stock',
      packaging_type: 'Vacuum-sealed mylar', shelf_life_days: '365',
      storage_requirements: 'Cool dry place away from light',
      ships_from_state: 'MD',
      display_order: '2', featured: 'TRUE',
      short_description: 'Greenhouse-grown THCA hemp flower. 18.6% THCA with citrus-forward terpene profile.',
      long_description: 'Our Greenhouse THCA Hemp Flower offers exceptional quality at wholesale value pricing.',
      compliance_statement: 'All Hemp Life Farmers products are derived from hemp and contain \u22640.3% \u03949-THC on a dry-weight basis in compliance with the 2018 Farm Bill.',
      coc_cultivation_origin: 'Western MD Highlands - Licensed Greenhouse',
      coc_processor: 'HLF Processing Facility',
      coc_handler: 'Hemp Life Farmers Distribution',
      coc_storage_facility: 'Climate-controlled warehouse - Western MD',
      coc_last_audit_date: '2025-10-01',
      restricted_states: 'ID,OR,SD'
    },
    {
      sku: 'HLF-CB-001',
      product_name: 'CBD Hemp Flower',
      product_type: 'CBD Flower',
      product_category: 'Flower',
      status: 'active',
      cultivation_method: 'Outdoor',
      cultivation_location: 'Southern MD Farmland',
      harvest_date: '2025-09-15',
      delta9_thc_pct: '0.12',
      thca_pct: '0.45',
      cbd_pct: '16.80',
      cbg_pct: '0.22',
      cbn_pct: '0.08',
      total_cannabinoids_pct: '17.67',
      terpene_1_name: 'Myrcene', terpene_1_pct: '0.92',
      terpene_2_name: 'Bisabolol', terpene_2_pct: '0.48',
      terpene_3_name: 'Humulene', terpene_3_pct: '0.35',
      total_terpenes_pct: '2.12',
      appearance: 'Fluffy light-green buds with amber trichomes',
      aroma_profile: 'Diesel and citrus with earthy finish',
      moisture_content_pct: '11.50',
      trim_type: 'Hand-trimmed',
      density: 'Light-Medium',
      coa_batch_number: 'BN-CB001-20251001',
      coa_test_date: '2025-10-01',
      coa_lab_name: 'ACS Laboratory',
      coa_lab_accreditation: 'ISO 17025',
      coa_pdf_filename: 'HLF-CB-001-COA.pdf',
      heavy_metals_pass: 'TRUE', pesticides_pass: 'TRUE', microbials_pass: 'TRUE',
      mycotoxins_pass: 'TRUE', residual_solvents_pass: 'TRUE', foreign_matter_pass: 'TRUE',
      farm_bill_compliant: 'TRUE',
      price_per_lb: '600.00', price_5lb: '550.00', price_10lb: '500.00',
      min_order_lbs: '1',
      inventory_lbs_available: '200.00', inventory_status: 'in_stock',
      packaging_type: 'Vacuum-sealed mylar', shelf_life_days: '365',
      storage_requirements: 'Cool dry place away from light',
      ships_from_state: 'MD',
      display_order: '3', featured: 'FALSE',
      short_description: 'Outdoor-grown CBD hemp flower. 16.8% CBD with classic diesel-citrus profile.',
      long_description: 'Sun-grown on Southern Maryland farmland our CBD Hemp Flower delivers consistent quality.',
      compliance_statement: 'All Hemp Life Farmers products are derived from hemp and contain \u22640.3% \u03949-THC on a dry-weight basis in compliance with the 2018 Farm Bill.',
      coc_cultivation_origin: 'Southern MD Farmland - Licensed Hemp Farm',
      coc_processor: 'HLF Processing Facility',
      coc_handler: 'Hemp Life Farmers Distribution',
      coc_storage_facility: 'Climate-controlled warehouse - Southern MD',
      coc_last_audit_date: '2025-10-05',
      restricted_states: 'ID,SD'
    },
    {
      sku: 'HLF-EX-001',
      product_name: 'Hemp-Derived Extract Concentrate',
      product_type: 'Extract',
      product_category: 'Concentrates',
      status: 'active',
      cultivation_method: 'Indoor',
      cultivation_location: 'Eastern Shore MD',
      harvest_date: '2025-10-01',
      delta9_thc_pct: '0.28',
      thca_pct: '25.10',
      cbd_pct: '2.40',
      cbg_pct: '0.35',
      cbn_pct: '0.10',
      total_cannabinoids_pct: '28.23',
      terpene_1_name: 'Myrcene', terpene_1_pct: '1.10',
      terpene_2_name: 'Limonene', terpene_2_pct: '0.88',
      terpene_3_name: 'Caryophyllene', terpene_3_pct: '0.72',
      total_terpenes_pct: '3.25',
      appearance: 'Golden amber concentrate with glass-like clarity',
      aroma_profile: 'Rich terpene-forward with sweet and spicy notes',
      moisture_content_pct: '0.50',
      trim_type: 'N/A',
      density: 'N/A',
      coa_batch_number: 'BN-EX001-20251105',
      coa_test_date: '2025-11-05',
      coa_lab_name: 'ProVerde Laboratories',
      coa_lab_accreditation: 'ISO 17025',
      coa_pdf_filename: 'HLF-EX-001-COA.pdf',
      heavy_metals_pass: 'TRUE', pesticides_pass: 'TRUE', microbials_pass: 'TRUE',
      mycotoxins_pass: 'TRUE', residual_solvents_pass: 'TRUE', foreign_matter_pass: 'TRUE',
      farm_bill_compliant: 'TRUE',
      price_per_lb: '2400.00', price_5lb: '2200.00', price_10lb: '2000.00',
      min_order_lbs: '1',
      inventory_lbs_available: '40.00', inventory_status: 'in_stock',
      packaging_type: 'Glass jar in sealed container', shelf_life_days: '180',
      storage_requirements: 'Refrigerate for long-term storage',
      ships_from_state: 'MD',
      display_order: '4', featured: 'TRUE',
      short_description: 'Premium hemp-derived extract concentrate. 25.1% THCA with full-spectrum terpene profile.',
      long_description: 'Our Hemp-Derived Extract Concentrate represents the pinnacle of compliant hemp processing.',
      compliance_statement: 'All Hemp Life Farmers products are derived from hemp and contain \u22640.3% \u03949-THC on a dry-weight basis in compliance with the 2018 Farm Bill.',
      coc_cultivation_origin: 'Eastern Shore MD - Licensed Hemp Farm',
      coc_processor: 'HLF Extraction Lab - ISO Certified',
      coc_handler: 'Hemp Life Farmers Distribution',
      coc_storage_facility: 'Climate-controlled vault - Eastern Shore MD',
      coc_last_audit_date: '2025-10-25',
      restricted_states: 'ID,OR,SD'
    }
  ];
}

/* ----------------------------------------------------------
   18. UTILITY FUNCTIONS
   ---------------------------------------------------------- */
function formatCurrency(amount) {
  var num = parseFloat(amount);
  if (isNaN(num)) return '$0.00';
  return '$' + num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function formatDate(dateStr) {
  if (!dateStr) return '\u2014';
  var d = new Date(dateStr);
  if (isNaN(d.getTime())) return dateStr;
  return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
}

/**
 * Escape HTML entities for safe DOM insertion.
 */
/* ----------------------------------------------------------
   19. SUPER ADMIN DASHBOARD
   ---------------------------------------------------------- */

/* Demo data stores */
var adminMembers = [
  { id: 'MEM-001', name: 'Demo Member', business: 'Demo Business LLC', email: 'demo@hemplifefarmers.com', state: 'MD', inviteCode: 'HLF-INV-7742', applied: '2025-01-10', status: 'active', appFeePaid: true, monthlyActive: true },
  { id: 'MEM-002', name: 'Jane Rodriguez', business: 'Green Leaf Retail', email: 'jane@greenleaf.com', state: 'CA', inviteCode: 'HLF-INV-8821', applied: '2025-02-20', status: 'active', appFeePaid: true, monthlyActive: true },
  { id: 'MEM-003', name: 'Robert Chen', business: 'Pacific Hemp Co', email: 'robert@pacifichemp.com', state: 'WA', inviteCode: 'HLF-INV-3321', applied: '2025-03-05', status: 'pending', appFeePaid: true, monthlyActive: false },
  { id: 'MEM-004', name: 'Sarah Williams', business: 'Midwest Botanicals', email: 'sarah@mwbotanicals.com', state: 'IL', inviteCode: 'HLF-INV-4456', applied: '2025-03-12', status: 'pending', appFeePaid: false, monthlyActive: false },
  { id: 'MEM-005', name: 'Mike Thompson', business: 'Mountain Wellness', email: 'mike@mountainwell.com', state: 'CO', inviteCode: 'HLF-INV-5567', applied: '2025-01-25', status: 'suspended', appFeePaid: true, monthlyActive: false }
];

var adminOrders = [
  { id: 'HLF-0001', memberId: 'MEM-001', memberName: 'Demo Member', products: 'Premium THCA Flower (Indoor)', qty: '5 lb', total: 8250, payment: 'ACH', date: '2025-02-15', status: 'shipped' },
  { id: 'HLF-0002', memberId: 'MEM-001', memberName: 'Demo Member', products: 'CBD Hemp Flower (Outdoor)', qty: '10 lb', total: 5000, payment: 'CashApp', date: '2025-03-01', status: 'processing' },
  { id: 'HLF-0003', memberId: 'MEM-001', memberName: 'Demo Member', products: 'THCA Flower (Greenhouse)', qty: '3 lb', total: 3600, payment: 'ACH', date: '2025-03-10', status: 'pending_review' },
  { id: 'HLF-0004', memberId: 'MEM-002', memberName: 'Jane Rodriguez', products: 'Hemp Extract Concentrate', qty: '2 lb', total: 4800, payment: 'Wire', date: '2025-03-08', status: 'approved' },
  { id: 'HLF-0005', memberId: 'MEM-002', memberName: 'Jane Rodriguez', products: 'Premium THCA Flower (Indoor)', qty: '1 lb', total: 1800, payment: 'Zelle', date: '2025-03-15', status: 'pending_review' }
];

function adminLogout() {
  memberLogout();
}

function switchAdminTab(tabName, btn) {
  var tabs = document.querySelectorAll('#page-admin .admin-tab-content');
  for (var i = 0; i < tabs.length; i++) tabs[i].style.display = 'none';
  var target = document.getElementById('admin-tab-' + tabName);
  if (target) target.style.display = 'block';
  var btns = document.querySelectorAll('#page-admin .dash-tabs .dash-tab-btn');
  for (var j = 0; j < btns.length; j++) btns[j].classList.remove('active');
  if (btn) btn.classList.add('active');
}

function populateAdminDashboard() {
  renderAdminMembers();
  renderAdminOrders();
  renderAdminProducts();
  renderAdminInviteCodes();
  // Show first tab on load (CSS :first-of-type doesn't work due to sibling divs)
  switchAdminTab('members');
  var firstBtn = document.querySelector('#page-admin .dash-tabs .dash-tab-btn');
  if (firstBtn) firstBtn.classList.add('active');
}

/* --- Members Management --- */
function renderAdminMembers(filter, search) {
  filter = filter || 'all';
  search = (search || '').toLowerCase();
  var tbody = document.getElementById('admin-members-tbody');
  if (!tbody) return;
  var filtered = adminMembers.filter(function(m) {
    if (filter !== 'all' && m.status !== filter) return false;
    if (search && m.name.toLowerCase().indexOf(search) === -1 && m.email.toLowerCase().indexOf(search) === -1 && m.business.toLowerCase().indexOf(search) === -1) return false;
    return true;
  });
  var html = '';
  for (var i = 0; i < filtered.length; i++) {
    var m = filtered[i];
    var origIdx = adminMembers.indexOf(m);
    var statusBadge = m.status === 'active' ? 'badge-green' : (m.status === 'pending' ? 'badge-gold' : (m.status === 'suspended' ? 'badge-red' : 'badge-red'));
    html += '<tr>';
    html += '<td>' + escHtml(m.name) + '</td>';
    html += '<td>' + escHtml(m.business) + '</td>';
    html += '<td style="font-size:12px;">' + escHtml(m.email) + '</td>';
    html += '<td>' + escHtml(m.state) + '</td>';
    html += '<td style="font-family:monospace;font-size:12px;">' + escHtml(m.inviteCode) + '</td>';
    html += '<td>' + escHtml(m.applied) + '</td>';
    html += '<td><span class="badge ' + statusBadge + '">' + m.status + '</span></td>';
    html += '<td style="white-space:nowrap;">';
    if (m.status === 'pending') {
      html += '<button class="btn btn-sm btn-primary" onclick="adminApproveMember(' + origIdx + ')" style="padding:4px 10px;font-size:11px;">Approve</button> ';
      html += '<button class="btn btn-sm btn-danger" onclick="adminDenyMember(' + origIdx + ')" style="padding:4px 10px;font-size:11px;">Deny</button>';
    } else if (m.status === 'active') {
      html += '<button class="btn btn-sm btn-danger" onclick="adminSuspendMember(' + origIdx + ')" style="padding:4px 10px;font-size:11px;">Suspend</button> ';
      html += '<button class="btn btn-sm btn-secondary" onclick="adminRemoveMember(' + origIdx + ')" style="padding:4px 10px;font-size:11px;">Remove</button>';
    } else if (m.status === 'suspended') {
      html += '<button class="btn btn-sm btn-primary" onclick="adminReactivateMember(' + origIdx + ')" style="padding:4px 10px;font-size:11px;">Reactivate</button> ';
      html += '<button class="btn btn-sm btn-secondary" onclick="adminRemoveMember(' + origIdx + ')" style="padding:4px 10px;font-size:11px;">Remove</button>';
    }
    html += '</td></tr>';
  }
  tbody.innerHTML = html || '<tr><td colspan="8" class="text-center text-muted" style="padding:24px;">No members found.</td></tr>';
  var countEl = document.getElementById('admin-members-count');
  if (countEl) countEl.textContent = filtered.length;
}

function filterAdminMembers() {
  var filter = document.getElementById('admin-member-filter');
  var search = document.getElementById('admin-member-search');
  renderAdminMembers(filter ? filter.value : 'all', search ? search.value : '');
}

function adminApproveMember(idx) {
  if (confirm('Approve ' + adminMembers[idx].name + ' for active membership?')) {
    adminMembers[idx].status = 'active';
    adminMembers[idx].monthlyActive = true;
    renderAdminMembers();
  }
}
function adminDenyMember(idx) {
  if (confirm('Deny application for ' + adminMembers[idx].name + '?')) {
    adminMembers[idx].status = 'denied';
    renderAdminMembers();
  }
}
function adminSuspendMember(idx) {
  if (confirm('Suspend membership for ' + adminMembers[idx].name + '? They will lose wholesale access.')) {
    adminMembers[idx].status = 'suspended';
    adminMembers[idx].monthlyActive = false;
    renderAdminMembers();
  }
}
function adminReactivateMember(idx) {
  if (confirm('Reactivate membership for ' + adminMembers[idx].name + '?')) {
    adminMembers[idx].status = 'active';
    adminMembers[idx].monthlyActive = true;
    renderAdminMembers();
  }
}
function adminRemoveMember(idx) {
  if (confirm('Permanently remove ' + adminMembers[idx].name + '? This cannot be undone.')) {
    adminMembers.splice(idx, 1);
    renderAdminMembers();
  }
}

/* --- Orders Management --- */
function renderAdminOrders(filter, search) {
  filter = filter || 'all';
  search = (search || '').toLowerCase();
  var tbody = document.getElementById('admin-orders-tbody');
  if (!tbody) return;
  var filtered = adminOrders.filter(function(o) {
    if (filter !== 'all' && o.status !== filter) return false;
    if (search && o.id.toLowerCase().indexOf(search) === -1 && o.memberName.toLowerCase().indexOf(search) === -1) return false;
    return true;
  });
  var statusLabels = { pending_review: 'Pending Review', approved: 'Approved', processing: 'Processing', shipped: 'Shipped', delivered: 'Delivered', canceled: 'Canceled' };
  var statusBadges = { pending_review: 'badge-blue', approved: 'badge-gold', processing: 'badge-gold', shipped: 'badge-green', delivered: 'badge-green', canceled: 'badge-red' };
  var html = '';
  for (var i = 0; i < filtered.length; i++) {
    var o = filtered[i];
    var origIdx = adminOrders.indexOf(o);
    html += '<tr>';
    html += '<td style="font-family:monospace;font-size:12px;">' + escHtml(o.id) + '</td>';
    html += '<td>' + escHtml(o.memberName) + '</td>';
    html += '<td>' + escHtml(o.products) + '</td>';
    html += '<td>' + escHtml(o.qty) + '</td>';
    html += '<td>' + formatCurrency(o.total) + '</td>';
    html += '<td>' + escHtml(o.payment) + '</td>';
    html += '<td>' + escHtml(o.date) + '</td>';
    html += '<td><span class="badge ' + (statusBadges[o.status] || 'badge-gold') + '">' + (statusLabels[o.status] || o.status) + '</span></td>';
    html += '<td style="white-space:nowrap;">';
    html += '<select class="admin-status-select" onchange="adminUpdateOrderStatus(' + origIdx + ', this.value)">';
    var allStatuses = ['pending_review','approved','processing','shipped','delivered','canceled'];
    for (var s = 0; s < allStatuses.length; s++) {
      html += '<option value="' + allStatuses[s] + '"' + (o.status === allStatuses[s] ? ' selected' : '') + '>' + (statusLabels[allStatuses[s]] || allStatuses[s]) + '</option>';
    }
    html += '</select>';
    html += '</td></tr>';
  }
  tbody.innerHTML = html || '<tr><td colspan="9" class="text-center text-muted" style="padding:24px;">No orders found.</td></tr>';
  var countEl = document.getElementById('admin-orders-count');
  if (countEl) countEl.textContent = filtered.length;
}

function filterAdminOrders() {
  var filter = document.getElementById('admin-order-filter');
  var search = document.getElementById('admin-order-search');
  renderAdminOrders(filter ? filter.value : 'all', search ? search.value : '');
}

function adminUpdateOrderStatus(idx, newStatus) {
  adminOrders[idx].status = newStatus;
  renderAdminOrders();
}

/* --- Products Management --- */
function renderAdminProducts() {
  var container = document.getElementById('admin-products-list');
  if (!container) return;
  if (productData.length === 0) {
    container.innerHTML = '<p class="text-muted">No products loaded. Upload a CSV or wait for data to load.</p>';
    return;
  }
  var html = '';
  for (var i = 0; i < productData.length; i++) {
    var p = productData[i];
    var bgClass = (p.product_category || '').toLowerCase() === 'flower' ? 'flower-bg' : 'extract-bg';
    var statusColor = p.status === 'active' ? 'var(--green-mid)' : 'var(--barn-red)';
    html += '<div class="admin-product-card">';
    html += '<div class="admin-product-thumb product-img ' + bgClass + '" style="border-radius:6px;font-size:20px;">' + (p.product_type === 'Extract' ? '&#129514;' : '&#127807;') + '</div>';
    html += '<div class="admin-product-info">';
    html += '<h4>' + escHtml(p.product_name) + '</h4>';
    html += '<p><strong>SKU:</strong> ' + escHtml(p.sku) + ' &middot; <strong>Type:</strong> ' + escHtml(p.product_type) + ' &middot; <span style="color:' + statusColor + ';font-weight:700;">' + escHtml(p.status || 'active') + '</span></p>';
    html += '<p><strong>Price:</strong> $' + escHtml(p.price_per_lb) + '/lb &middot; $' + escHtml(p.price_5lb) + '/5lb &middot; $' + escHtml(p.price_10lb) + '/10lb</p>';
    html += '<p><strong>Inventory:</strong> ' + escHtml(p.inventory_lbs_available) + ' lbs &middot; <strong>THC:</strong> ' + escHtml(p.delta9_thc_pct) + '% &middot; <strong>THCA:</strong> ' + escHtml(p.thca_pct) + '%</p>';
    html += '</div>';
    html += '<div class="admin-product-actions">';
    html += '<button class="btn btn-sm btn-primary" onclick="editProduct(' + i + ')">Edit</button>';
    html += '<button class="btn btn-sm btn-danger" onclick="deleteProduct(' + i + ')">Delete</button>';
    html += '</div>';
    html += '</div>';
  }
  container.innerHTML = html;
}

function editProduct(idx) {
  var p = productData[idx];
  document.getElementById('edit-product-index').value = idx;
  document.getElementById('edit-product-title').textContent = 'Edit: ' + p.product_name;
  document.getElementById('edit-sku').value = p.sku || '';
  document.getElementById('edit-product-name').value = p.product_name || '';
  document.getElementById('edit-product-type').value = p.product_type || '';
  document.getElementById('edit-product-category').value = p.product_category || '';
  document.getElementById('edit-status').value = p.status || 'active';
  document.getElementById('edit-featured').value = p.featured || 'FALSE';
  document.getElementById('edit-price-lb').value = p.price_per_lb || '';
  document.getElementById('edit-price-5lb').value = p.price_5lb || '';
  document.getElementById('edit-price-10lb').value = p.price_10lb || '';
  document.getElementById('edit-inventory').value = p.inventory_lbs_available || '';
  document.getElementById('edit-product-image').value = p.product_image_filename || '';
  document.getElementById('edit-img-size').value = p.product_img_size || '';
  document.getElementById('edit-short-desc').value = p.short_description || '';
  document.getElementById('edit-long-desc').value = p.long_description || '';
  document.getElementById('edit-thc').value = p.delta9_thc_pct || '';
  document.getElementById('edit-thca').value = p.thca_pct || '';
  document.getElementById('edit-cbd').value = p.cbd_pct || '';
  document.getElementById('edit-coa-batch').value = p.coa_batch_number || '';
  document.getElementById('edit-restricted').value = p.restricted_states || '';
  document.getElementById('edit-product-modal').style.display = 'block';
}

function showAddProductModal() {
  document.getElementById('edit-product-index').value = '-1';
  document.getElementById('edit-product-title').textContent = 'Add New Product';
  var fields = ['edit-sku','edit-product-name','edit-product-type','edit-product-category','edit-price-lb','edit-price-5lb','edit-price-10lb','edit-inventory','edit-product-image','edit-img-size','edit-short-desc','edit-long-desc','edit-thc','edit-thca','edit-cbd','edit-coa-batch','edit-restricted'];
  for (var i = 0; i < fields.length; i++) {
    var el = document.getElementById(fields[i]);
    if (el) el.value = '';
  }
  document.getElementById('edit-status').value = 'active';
  document.getElementById('edit-featured').value = 'FALSE';
  document.getElementById('edit-product-modal').style.display = 'block';
}

function closeEditProductModal() {
  document.getElementById('edit-product-modal').style.display = 'none';
}

function saveProductEdit() {
  var idx = parseInt(document.getElementById('edit-product-index').value);
  var sku = document.getElementById('edit-sku').value.trim();
  var name = document.getElementById('edit-product-name').value.trim();
  if (!sku || !name) { alert('SKU and Product Name are required.'); return; }
  var thcVal = parseFloat(document.getElementById('edit-thc').value);
  if (!isNaN(thcVal) && thcVal > 0.3) { alert('COMPLIANCE BLOCK: Delta-9 THC cannot exceed 0.3%.'); return; }

  var data = {
    sku: sku,
    product_name: name,
    product_type: document.getElementById('edit-product-type').value.trim(),
    product_category: document.getElementById('edit-product-category').value.trim(),
    status: document.getElementById('edit-status').value,
    featured: document.getElementById('edit-featured').value,
    price_per_lb: document.getElementById('edit-price-lb').value,
    price_5lb: document.getElementById('edit-price-5lb').value,
    price_10lb: document.getElementById('edit-price-10lb').value,
    inventory_lbs_available: document.getElementById('edit-inventory').value,
    product_image_filename: document.getElementById('edit-product-image').value.trim(),
    product_img_size: document.getElementById('edit-img-size').value,
    short_description: document.getElementById('edit-short-desc').value.trim(),
    long_description: document.getElementById('edit-long-desc').value.trim(),
    delta9_thc_pct: document.getElementById('edit-thc').value,
    thca_pct: document.getElementById('edit-thca').value,
    cbd_pct: document.getElementById('edit-cbd').value,
    coa_batch_number: document.getElementById('edit-coa-batch').value.trim(),
    restricted_states: document.getElementById('edit-restricted').value.trim(),
    farm_bill_compliant: 'TRUE',
    compliance_statement: 'All Hemp Life Farmers products are derived from hemp and contain \u22640.3% \u03949-THC on a dry-weight basis in compliance with the 2018 Farm Bill.'
  };

  if (idx >= 0 && idx < productData.length) {
    /* Update existing — merge to preserve fields not in the edit form */
    for (var key in data) { productData[idx][key] = data[key]; }
  } else {
    /* Add new product — set defaults for missing fields */
    data.inventory_status = 'in_stock';
    data.min_order_lbs = '1';
    data.coa_test_date = new Date().toISOString().slice(0,10);
    data.coa_lab_name = 'TBD';
    data.coa_lab_accreditation = 'ISO 17025';
    data.coa_pdf_filename = 'TBD';
    data.heavy_metals_pass = 'TRUE'; data.pesticides_pass = 'TRUE'; data.microbials_pass = 'TRUE';
    data.mycotoxins_pass = 'TRUE'; data.residual_solvents_pass = 'TRUE'; data.foreign_matter_pass = 'TRUE';
    data.date_added = new Date().toISOString().slice(0,10);
    data.last_updated = new Date().toISOString().slice(0,10);
    data.display_order = String(productData.length + 1);
    productData.push(data);
  }

  closeEditProductModal();
  renderAllProductViews();
  renderAdminProducts();
  alert('Product saved successfully.');
}

function deleteProduct(idx) {
  if (confirm('Delete "' + productData[idx].product_name + '"? This cannot be undone.')) {
    productData.splice(idx, 1);
    renderAllProductViews();
    renderAdminProducts();
  }
}

/* ----------------------------------------------------------
   20. CLIENT ORDER SYSTEM
   ---------------------------------------------------------- */
var clientOrders = [];

function showPlaceOrderForm() {
  if (!sessionStorage.getItem('memberLoggedIn')) {
    alert('You must be a logged-in member to place orders.');
    navigate('login');
    return;
  }
  if (sessionStorage.getItem('memberStatus') !== 'active') {
    alert('Your membership must be active to place orders. Contact us for assistance.');
    return;
  }
  document.getElementById('place-order-form').style.display = 'block';
  document.getElementById('client-orders-table').style.display = 'none';
  /* Set shipping state from member profile */
  var stateField = document.getElementById('order-ship-state');
  if (stateField) stateField.value = 'MD';
  /* Add first product row */
  var rows = document.getElementById('order-product-rows');
  if (rows && rows.children.length === 0) addOrderProductRow();
}

function hidePlaceOrderForm() {
  document.getElementById('place-order-form').style.display = 'none';
  document.getElementById('client-orders-table').style.display = 'block';
}

function addOrderProductRow() {
  var container = document.getElementById('order-product-rows');
  if (!container) return;
  var rowIdx = container.children.length;
  var options = '<option value="">Select product...</option>';
  for (var i = 0; i < productData.length; i++) {
    var p = productData[i];
    if (p.status !== 'active' || p.farm_bill_compliant !== 'TRUE') continue;
    options += '<option value="' + i + '" data-price="' + (p.price_per_lb || 0) + '">' + escHtml(p.product_name) + ' ($' + escHtml(p.price_per_lb) + '/lb)</option>';
  }
  var rowHtml = '<div class="order-product-row" data-row="' + rowIdx + '">';
  rowHtml += '<div class="form-group" style="margin:0;"><label style="font-size:11px;">Product</label><select class="order-product-select" onchange="recalcOrderTotal()">' + options + '</select></div>';
  rowHtml += '<div class="form-group" style="margin:0;"><label style="font-size:11px;">Quantity (lbs)</label><input type="number" class="order-qty-input" min="1" value="1" onchange="recalcOrderTotal()" oninput="recalcOrderTotal()"></div>';
  rowHtml += '<div class="form-group" style="margin:0;"><label style="font-size:11px;">Subtotal</label><input type="text" class="order-subtotal" readonly style="background:var(--cream);font-weight:700;" value="$0.00"></div>';
  rowHtml += '<div style="padding-top:18px;"><button class="btn btn-sm btn-danger" onclick="removeOrderProductRow(this)" style="padding:6px 10px;">&times;</button></div>';
  rowHtml += '</div>';
  container.insertAdjacentHTML('beforeend', rowHtml);
  recalcOrderTotal();
}

function removeOrderProductRow(btn) {
  var row = btn.closest('.order-product-row');
  if (row) row.remove();
  recalcOrderTotal();
}

function recalcOrderTotal() {
  var rows = document.querySelectorAll('.order-product-row');
  var summaryLines = '';
  var total = 0;
  for (var i = 0; i < rows.length; i++) {
    var select = rows[i].querySelector('.order-product-select');
    var qtyInput = rows[i].querySelector('.order-qty-input');
    var subtotalInput = rows[i].querySelector('.order-subtotal');
    if (!select || !qtyInput || !subtotalInput) continue;
    var prodIdx = parseInt(select.value);
    var qty = parseInt(qtyInput.value) || 0;
    if (isNaN(prodIdx) || prodIdx < 0 || !productData[prodIdx]) {
      subtotalInput.value = '$0.00';
      continue;
    }
    var p = productData[prodIdx];
    var price = parseFloat(p.price_per_lb) || 0;
    if (qty >= 10 && p.price_10lb) price = parseFloat(p.price_10lb);
    else if (qty >= 5 && p.price_5lb) price = parseFloat(p.price_5lb);
    var sub = price * qty;
    subtotalInput.value = formatCurrency(sub);
    total += sub;
    summaryLines += '<div style="display:flex;justify-content:space-between;font-size:14px;"><span>' + escHtml(p.product_name) + ' x ' + qty + ' lb</span><span>' + formatCurrency(sub) + '</span></div>';
  }
  var summaryEl = document.getElementById('order-summary-lines');
  if (summaryEl) summaryEl.innerHTML = summaryLines || '<p class="text-muted" style="font-size:13px;">No products selected.</p>';
  var totalEl = document.getElementById('order-total-display');
  if (totalEl) totalEl.textContent = 'Total: ' + formatCurrency(total);
}

function submitClientOrder() {
  if (!sessionStorage.getItem('memberLoggedIn') || sessionStorage.getItem('memberStatus') !== 'active') {
    alert('Active membership required to place orders.');
    return;
  }
  /* Validate at least one product */
  var rows = document.querySelectorAll('.order-product-row');
  var orderItems = [];
  var total = 0;
  for (var i = 0; i < rows.length; i++) {
    var select = rows[i].querySelector('.order-product-select');
    var qtyInput = rows[i].querySelector('.order-qty-input');
    var prodIdx = parseInt(select.value);
    var qty = parseInt(qtyInput.value) || 0;
    if (isNaN(prodIdx) || qty < 1) continue;
    var p = productData[prodIdx];
    var price = parseFloat(p.price_per_lb) || 0;
    if (qty >= 10 && p.price_10lb) price = parseFloat(p.price_10lb);
    else if (qty >= 5 && p.price_5lb) price = parseFloat(p.price_5lb);
    orderItems.push({ product: p.product_name, sku: p.sku, qty: qty, price: price, subtotal: price * qty });
    total += price * qty;
  }
  if (orderItems.length === 0) { alert('Please select at least one product.'); return; }

  var agreeBox = document.getElementById('order-agree-terms');
  if (!agreeBox || !agreeBox.checked) { alert('You must agree to the order terms.'); return; }

  /* Create order */
  var orderId = 'HLF-' + String(Math.floor(1000 + Math.random() * 9000));
  var today = new Date().toISOString().slice(0,10);
  var paymentMethod = document.getElementById('order-payment-method').value;
  var productNames = orderItems.map(function(it) { return it.product + ' (' + it.qty + ' lb)'; }).join(', ');
  var totalQty = orderItems.reduce(function(s, it) { return s + it.qty; }, 0);

  /* Add to client's view */
  var ordersTbody = document.getElementById('orders-tbody');
  if (ordersTbody) {
    var newRow = '<tr style="background:var(--green-pale);">';
    newRow += '<td>' + orderId + '</td>';
    newRow += '<td>' + today + '</td>';
    newRow += '<td>' + escHtml(productNames) + '</td>';
    newRow += '<td>' + totalQty + ' lb</td>';
    newRow += '<td>' + formatCurrency(total) + '</td>';
    newRow += '<td><span class="badge badge-blue">Pending Review</span></td>';
    newRow += '<td><button class="btn btn-sm btn-danger" onclick="cancelClientOrder(\'' + orderId + '\', this)" style="padding:4px 10px;font-size:11px;">Cancel</button></td>';
    newRow += '</tr>';
    ordersTbody.insertAdjacentHTML('afterbegin', newRow);
  }

  /* Add to admin view */
  adminOrders.unshift({
    id: orderId,
    memberId: 'MEM-001',
    memberName: sessionStorage.getItem('memberName') || 'Member',
    products: productNames,
    qty: totalQty + ' lb',
    total: total,
    payment: paymentMethod,
    date: today,
    status: 'pending_review'
  });

  hidePlaceOrderForm();
  document.getElementById('order-product-rows').innerHTML = '';
  alert('Order ' + orderId + ' submitted for review!\n\nTotal: ' + formatCurrency(total) + '\nPayment: ' + paymentMethod + '\n\nYou will receive payment instructions once the order is approved.');
}

function cancelClientOrder(orderId, btn) {
  if (confirm('Cancel order ' + orderId + '? This action cannot be undone.')) {
    var row = btn.closest('tr');
    if (row) {
      row.style.background = 'var(--barn-red-pale)';
      row.querySelector('td:nth-child(6)').innerHTML = '<span class="badge badge-red">Canceled</span>';
      row.querySelector('td:last-child').innerHTML = '<span class="text-muted" style="font-size:12px;">Canceled</span>';
    }
    /* Update admin orders */
    for (var i = 0; i < adminOrders.length; i++) {
      if (adminOrders[i].id === orderId) {
        adminOrders[i].status = 'canceled';
        break;
      }
    }
  }
}

/* ----------------------------------------------------------
   21. MEMBERSHIP ENFORCEMENT
   ---------------------------------------------------------- */
/* Products page wall — toggle catalog vs wall based on login */
function updateProductsWall() {
  var wall = document.getElementById('products-wall');
  var catalog = document.getElementById('products-catalog-section');
  if (!wall || !catalog) return;
  if (sessionStorage.getItem('memberLoggedIn') && sessionStorage.getItem('memberStatus') === 'active') {
    wall.style.display = 'none';
    catalog.style.display = 'block';
  } else {
    wall.style.display = 'block';
    catalog.style.display = 'none';
  }
}

/* Products page "Request Invoice" buttons check membership */
function requestInvoice(sku) {
  if (!sessionStorage.getItem('memberLoggedIn')) {
    alert('You must be a member to request an invoice.\n\nPlease log in or apply for membership.');
    navigate('login');
    return;
  }
  if (sessionStorage.getItem('memberStatus') !== 'active') {
    alert('Your membership must be active to place orders.');
    return;
  }
  navigate('dashboard');
  setTimeout(function() { showPlaceOrderForm(); }, 100);
}

/* ----------------------------------------------------------
   22. ADMIN INVITE CODE MANAGEMENT
   ---------------------------------------------------------- */
var adminInviteCodes = [
  { code: 'HLF-INV-7742', created: '2024-12-01', status: 'Used', usedBy: 'Demo Member' },
  { code: 'HLF-INV-8821', created: '2025-01-15', status: 'Used', usedBy: 'Jane Rodriguez' },
  { code: 'HLF-INV-3321', created: '2025-02-10', status: 'Used', usedBy: 'Robert Chen' },
  { code: 'HLF-INV-4456', created: '2025-02-20', status: 'Used', usedBy: 'Sarah Williams' },
  { code: 'HLF-INV-5567', created: '2025-01-05', status: 'Used', usedBy: 'Mike Thompson' },
  { code: 'HLF-INV-9934', created: '2025-03-01', status: 'Available', usedBy: '' }
];

function adminGenerateCodes() {
  var qty = parseInt(document.getElementById('admin-code-qty').value) || 1;
  var newCodes = [];
  var today = new Date().toISOString().slice(0,10);
  for (var i = 0; i < qty; i++) {
    var code = 'HLF-INV-' + Math.floor(1000 + Math.random() * 9000);
    adminInviteCodes.push({ code: code, created: today, status: 'Available', usedBy: '' });
    newCodes.push(code);
  }
  renderAdminInviteCodes();
  var codesDisplay = document.getElementById('admin-generated-codes');
  if (codesDisplay) {
    var html = '<div style="background:var(--green-pale);border:1px solid var(--green-mid);border-radius:8px;padding:16px;">';
    html += '<strong style="color:var(--green-dark);">Generated ' + qty + ' new code(s):</strong><br>';
    for (var j = 0; j < newCodes.length; j++) {
      html += '<code style="display:inline-block;background:#fff;padding:4px 12px;border-radius:4px;margin:4px;font-size:14px;font-weight:700;letter-spacing:1px;">' + newCodes[j] + '</code> ';
    }
    html += '<p class="text-muted mt-2" style="font-size:12px;">Share these codes with prospective members. Each code can be used once.</p>';
    html += '</div>';
    codesDisplay.innerHTML = html;
  }
}

function renderAdminInviteCodes() {
  var tbody = document.getElementById('admin-invite-codes-tbody');
  if (!tbody) return;
  var html = '';
  for (var i = adminInviteCodes.length - 1; i >= 0; i--) {
    var c = adminInviteCodes[i];
    var badge = c.status === 'Used' ? 'badge-green' : 'badge-gold';
    html += '<tr>';
    html += '<td style="font-family:monospace;font-weight:700;letter-spacing:.5px;">' + escHtml(c.code) + '</td>';
    html += '<td>' + escHtml(c.created) + '</td>';
    html += '<td><span class="badge ' + badge + '">' + c.status + '</span></td>';
    html += '<td>' + (c.usedBy || '&mdash;') + '</td>';
    html += '</tr>';
  }
  tbody.innerHTML = html;
}

/* ----------------------------------------------------------
   23. RESTRICTED STATES — HARD LIST
   ---------------------------------------------------------- */
/* Explicit list of states where we CANNOT deliver.
   These are checked on signup AND on order placement. */
var RESTRICTED_STATES = ['ID','OR','SD'];

var RESTRICTED_STATE_NAMES = {
  ID: 'Idaho', OR: 'Oregon', SD: 'South Dakota'
};

/* Override buildRestrictedStatesSet to use the hard list */
var _origBuildRestricted = typeof buildRestrictedStatesSet === 'function' ? buildRestrictedStatesSet : null;
function buildRestrictedStatesSet() {
  restrictedStatesSet = new Set(RESTRICTED_STATES);
  /* Also add any from product data */
  for (var i = 0; i < productData.length; i++) {
    var rs = productData[i].restricted_states;
    if (rs) {
      var parts = rs.split(',');
      for (var j = 0; j < parts.length; j++) {
        var s = parts[j].trim().toUpperCase();
        if (s) restrictedStatesSet.add(s);
      }
    }
  }
}

/* Gradient for product type images */
function getProductGradient(type, category) {
  var gradients = {
    'THCA Flower': 'linear-gradient(135deg,#2d5016 0%,#4a7c28 50%,#6ba33c 100%)',
    'CBD Flower': 'linear-gradient(135deg,#1a5276 0%,#2e86c1 50%,#5dade2 100%)',
    'Extract': 'linear-gradient(135deg,#7d5a00 0%,#d4a017 50%,#f0c040 100%)',
    'Concentrates': 'linear-gradient(135deg,#7d5a00 0%,#d4a017 50%,#f0c040 100%)',
    'Pre-Roll': 'linear-gradient(135deg,#5b2c6f 0%,#8e44ad 50%,#bb8fce 100%)'
  };
  return gradients[type] || gradients[category] || 'linear-gradient(135deg,#2d5016 0%,#4a7c28 50%,#6ba33c 100%)';
}

function escHtml(str) {
  if (!str) return '';
  return String(str)
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}

/**
 * Escape a string for use inside an HTML attribute value.
 */
function escAttr(str) {
  return escHtml(str);
}

</script>
<!-- API client — connects to Neon/Express backend when available, falls back to demo mode -->
<script src="api-client.js"></script>
<!-- Geo-blocker — whitelist-only IP geolocation check -->
<script src="geo-blocker.js"></script>
</body>
</html>
